<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="baidu-site-verification" content="093lY4ziMu" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="A hexo theme">
    <meta name="keyword"  content="eternal0918, ZXP">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!--<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>-->
    <title>
        
          Docker 学习 - Eternal
        
    </title>

    <link rel="canonical" href="https://dusign.net/2021/08/04/Docker-学习/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
        
<link rel="stylesheet" href="/css/dusign-light.css">

        
<link rel="stylesheet" href="/css/dusign-common-light.css">

        
<link rel="stylesheet" href="/css/font-awesome.css">

        
<link rel="stylesheet" href="/css/toc.css">

        <!-- background effects end -->
    
    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/fonts.googleapis.css">


    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

    <!-- photography -->
    
<link rel="stylesheet" href="/css/photography.css">


    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- background effects start -->
    
    <!-- background effects end -->

	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            
                background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('docker.jpg')
                /*post*/
            
        
    }
    
    #signature{
        background-image: url('/img/signature/dusign.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Dcoker" title="Dcoker">Dcoker</a>
                            
                        </div>
                        <h1>Docker 学习</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by Eternal on
                            2021-08-04
                        </span>

                        

                    </div>
                

                </div>
            </div>
        </div>      
    </div>

    
    <div class="waveWrapper">
        <div class="wave wave_before" style="background-image: url('/img/wave-light.png')"></div>
        <div class="wave wave_after" style="background-image: url('/img/wave-light.png')"></div>
    </div>
    
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Eternal</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/photography/">Photography</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/categories/">Categories</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="Docker-学习"><a href="#Docker-学习" class="headerlink" title="Docker 学习"></a>Docker 学习</h1><h1 id="1-Docker-概述"><a href="#1-Docker-概述" class="headerlink" title="1.Docker 概述"></a>1.Docker 概述</h1><h2 id="Docker为什么出现？"><a href="#Docker为什么出现？" class="headerlink" title="Docker为什么出现？"></a>Docker为什么出现？</h2><p>一款产品：</p>
<p>开发——上线  两套环境  应用环境  应用配置</p>
<p>开发——运维  问题：我在我的电脑上可以允许！版本更新，导致服务不可用！对于运维来说考验十分大？</p>
<p>环境配置是十分的麻烦，每一个及其都要部署环境(集群Redis、ES、Hadoop…) !费事费力。</p>
<p>发布一个项目( jar + (Redis MySQL JDK ES) ),项目能不能带上环境安装打包！</p>
<p>之前在服务器配置一个应用的环境 Redis MySQL JDK ES Hadoop 配置超麻烦了，不能够跨平台。</p>
<p>开发环境Windows，最后发布到Linux！</p>
<p>传统：开发jar，运维来做！</p>
<p>现在：开发打包部署上线，一套流程做完！</p>
<p>安卓流程：java — apk —发布（应用商店）一 张三使用apk一安装即可用！</p>
<p>docker流程： java-jar（环境） — 打包项目帯上环境（镜像） — ( Docker仓库：商店）——-</p>
<p>Docker给以上的问题，提出了解决方案！</p>
<h2 id="Docker的基本组成"><a href="#Docker的基本组成" class="headerlink" title="Docker的基本组成"></a>Docker的基本组成</h2><p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/src=http___image.mamicode.com_info_201807_20180715122259940087.png&amp;refer=http___image.mamicode.jpg" alt="src=http___image.mamicode.com_info_201807_20180715122259940087.png&amp;refer=http___image.mamicode"></p>
<blockquote>
<p>镜像（image）</p>
</blockquote>
<p>docker镜像就好比是一个模板，可以通过这个模板来创建容器服务。</p>
<p>tomcat镜像 ==&gt; run ==&gt; tomcat容器（提供服务）</p>
<p>通过这个镜像可以创建多个容器（最终运行或者项目运行都是在容器中的）。</p>
<blockquote>
<p>容器（container）</p>
</blockquote>
<p>Docker利用容器技术，独立运行一个或者一组应用，是通过镜像来创建的。</p>
<p>有启动，停止，删除等Linux基本指令！</p>
<p>目前就可以把这个容器理解为一个简易的Linux系统</p>
<blockquote>
<p>仓库（repository）</p>
</blockquote>
<p>仓库就是存放镜像的地方，分为私有仓库和公有仓库；</p>
<p>Docker Hub（默认是国外的）</p>
<p>阿里云…都有容器服务器（配置镜像加速！）</p>
<h1 id="2-安装Docker"><a href="#2-安装Docker" class="headerlink" title="2.安装Docker"></a>2.安装Docker</h1><blockquote>
<p>Linux（CentOS7）</p>
</blockquote>
<h2 id="可视化界面安装"><a href="#可视化界面安装" class="headerlink" title="可视化界面安装"></a>可视化界面安装</h2><p>当你安装centOS7服务器版本的时候，系统默认是不会安装GUI的图形界面程序，这个需要手动安装CentOS7 Gnome GUI包。</p>
<p>1.检查安装源yum是否正常</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list</span><br></pre></td></tr></table></figure>
<p>2.下载可视化图形界面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">"X Window System"</span></span><br><span class="line"><span class="comment">#一系列操作结束后，输入以下命令</span></span><br><span class="line">yum groupinstall <span class="string">"GNOME Desktop"</span></span><br></pre></td></tr></table></figure>
<p>3.进入可视化界面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#方式1</span></span><br><span class="line">init 5</span><br><span class="line"><span class="comment">#方式2</span></span><br><span class="line">startx</span><br></pre></td></tr></table></figure>
<p>4.设置开机自动进入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先查看当前模式</span></span><br><span class="line">systemctl get-default</span><br><span class="line"><span class="comment">#图形界面</span></span><br><span class="line">systemctl <span class="built_in">set</span>-default graphical.target</span><br><span class="line"><span class="comment">#重启系统</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<p>5.设置启动命令行界面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#字符界面</span></span><br><span class="line">systemctl <span class="built_in">set</span>-default multi-user.target</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<p>6.卸载图形化界面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum groupremove <span class="string">"GNOME Desktop"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#系统内核查看</span></span><br><span class="line">uname -r</span><br><span class="line">3.10.0-1160.el7.x86_64</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#系统版本</span></span><br><span class="line">cat /etc/os-release </span><br><span class="line"></span><br><span class="line">NAME=<span class="string">"CentOS Linux"</span></span><br><span class="line">VERSION=<span class="string">"7 (Core)"</span></span><br><span class="line">ID=<span class="string">"centos"</span></span><br><span class="line">ID_LIKE=<span class="string">"rhel fedora"</span></span><br><span class="line">VERSION_ID=<span class="string">"7"</span></span><br><span class="line">PRETTY_NAME=<span class="string">"CentOS Linux 7 (Core)"</span></span><br><span class="line">ANSI_COLOR=<span class="string">"0;31"</span></span><br><span class="line">CPE_NAME=<span class="string">"cpe:/o:centos:centos:7"</span></span><br><span class="line">HOME_URL=<span class="string">"https://www.centos.org/"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://bugs.centos.org/"</span></span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=<span class="string">"CentOS-7"</span></span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=<span class="string">"7"</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT=<span class="string">"centos"</span></span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=<span class="string">"7"</span></span><br></pre></td></tr></table></figure>
<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><blockquote>
<p>安装</p>
</blockquote>
<p>帮助文档：<a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener">https://docs.docker.com/engine/install/centos/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、卸载旧的版本</span></span><br><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line">                  </span><br><span class="line"><span class="comment"># 2、需要的安装包</span></span><br><span class="line">sudo yum install -y yum-utils</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、设置镜像的仓库</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新yum软件包索引</span></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、安装docker相关的源 docker-ce 社区 ee 企业版</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、启动docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、查看是否安装成功</span></span><br><span class="line">docker version </span><br><span class="line"></span><br><span class="line"><span class="comment"># 7、</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8、查看下载的这个 hello-world 镜像</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>
<blockquote>
<p>卸载</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、依赖卸载</span></span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、删除资源</span></span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># /var/lib/docker 是docker的默认工作路径</span></span><br></pre></td></tr></table></figure>
<h2 id="阿里云镜像加速"><a href="#阿里云镜像加速" class="headerlink" title="阿里云镜像加速"></a>阿里云镜像加速</h2><p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728111552898.png" alt="image-20210728111552898"></p>
<p>配置镜像加速</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://68zgn28t.mirror.aliyuncs.com"</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<h1 id="3-Docker原理"><a href="#3-Docker原理" class="headerlink" title="3.Docker原理"></a>3.Docker原理</h1><h2 id="run的执行流程"><a href="#run的执行流程" class="headerlink" title="run的执行流程"></a>run的执行流程</h2><p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728113033416.png" alt="image-20210728113033416"></p>
<h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><blockquote>
<p><strong>Docker工作原理</strong></p>
</blockquote>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上，通过Socket从客户端访问！</p>
<p>DockerServer接收到Docker-Client的指令，就会执行这个命令！</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728113546538.png" alt="image-20210728113546538"></p>
<blockquote>
<p><strong>Docker为什么比VM快？</strong></p>
</blockquote>
<ul>
<li>Docker有着比虚拟机更少的抽象层</li>
<li>Docker利用的是宿主机的内核，VM需要的是Guest OS（重新搭建一个环境）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728114156812.png" alt="image-20210728114156812"></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728114121592.png" alt="image-20210728114121592"></p>
<p>所以说，新建一个容器的时候，docker不需要像虚拟机一样重新加载一个操作系统内核，避免引导。虚拟机是加载Guset OS , 分钟级别的，而docker是利用宿主机的操作系统，省略了这个复杂的过程，秒级。</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728114430818.png" alt="image-20210728114430818"></p>
<h1 id="4-Docker常用命令"><a href="#4-Docker常用命令" class="headerlink" title="4.Docker常用命令"></a>4.Docker常用命令</h1><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><p>帮助文档的地址：<a href="https://docs.docker.com/reference/" target="_blank" rel="noopener">https://docs.docker.com/reference/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version      <span class="comment"># 显示docker的版本信息</span></span><br><span class="line">docker info         <span class="comment"># 显示docker的系统信息，包括镜像和容器的数量</span></span><br><span class="line">docker 命令 --<span class="built_in">help</span>   <span class="comment"># 帮助命令</span></span><br></pre></td></tr></table></figure>
<h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><blockquote>
<p><strong>docker images 查看所有本地主机上的镜像</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[eternal@192 ~]$ sudo docker images</span><br><span class="line">[sudo] eternal 的密码：</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    d1165f221234   4 months ago   13.3kB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解释</span></span><br><span class="line">REPOSITORY  镜像的仓库源</span><br><span class="line">TAG         镜像的标签</span><br><span class="line">IMAGE ID    镜像的id</span><br><span class="line">CREATED     镜像的创建时间</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选项</span></span><br><span class="line">	-a, --all      <span class="comment"># 列出所有的镜像</span></span><br><span class="line">	-q, --quiet    <span class="comment"># 只显示镜像的id</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>docker search 搜索镜像</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[eternal@192 ~]$ sudo docker  search mysql</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   11175     [OK]       </span><br><span class="line">mariadb                           MariaDB Server is a high performing open sou…   4243      [OK]       </span><br><span class="line">mysql/mysql-server                Optimized MySQL Server Docker images. Create…   833                  [OK]</span><br><span class="line">percona                           Percona Server is a fork of the MySQL relati…   548       [OK]       </span><br><span class="line">phpmyadmin                        phpMyAdmin - A web interface <span class="keyword">for</span> MySQL and M…   281       [OK]       </span><br><span class="line">centos/mysql-57-centos7           MySQL 5.7 SQL database server                   90                   </span><br><span class="line">mysql/mysql-cluster               Experimental MySQL Cluster Docker images. Cr…   88                   </span><br><span class="line">centurylink/mysql                 Image containing mysql. Optimized to be link…   59                   [OK]</span><br><span class="line">databack/mysql-backup             Back up mysql databases to... anywhere!         45                   </span><br><span class="line">deitch/mysql-backup               REPLACED! Please use http://hub.docker.com/r…   41                   [OK]</span><br><span class="line">prom/mysqld-exporter                                                              40                   [OK]</span><br><span class="line">tutum/mysql                       Base docker image to run a MySQL database se…   35                   </span><br><span class="line">linuxserver/mysql                 A Mysql container, brought to you by LinuxSe…   30                   </span><br><span class="line">schickling/mysql-backup-s3        Backup MySQL to S3 (supports periodic backup…   29                   [OK]</span><br><span class="line">mysql/mysql-router                MySQL Router provides transparent routing be…   21                   </span><br><span class="line">centos/mysql-56-centos7           MySQL 5.6 SQL database server                   20                   </span><br><span class="line">arey/mysql-client                 Run a MySQL client from a docker container      18                   [OK]</span><br><span class="line">fradelg/mysql-cron-backup         MySQL/MariaDB database backup using cron tas…   15                   [OK]</span><br><span class="line">openshift/mysql-55-centos7        DEPRECATED: A Centos7 based MySQL v5.5 image…   6                    </span><br><span class="line">devilbox/mysql                    Retagged MySQL, MariaDB and PerconaDB offici…   3                    </span><br><span class="line">jelastic/mysql                    An image of the MySQL database server mainta…   2                    </span><br><span class="line">ansibleplaybookbundle/mysql-apb   An APB <span class="built_in">which</span> deploys RHSCL MySQL                2                    [OK]</span><br><span class="line">widdpim/mysql-client              Dockerized MySQL Client (5.7) including Curl…   1                    [OK]</span><br><span class="line">centos/mysql-80-centos7           MySQL 8.0 SQL database server                   1                    </span><br><span class="line">vitess/mysqlctld                  vitess/mysqlctld                                1                    [OK]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选项</span></span><br><span class="line">--filter , -f		<span class="comment">#根据提供的条件过滤输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#过滤出的mysql版本</span></span><br><span class="line">[eternal@192 ~]$ sudo docker search mysql -f=stars=5000</span><br><span class="line">[sudo] eternal 的密码：</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   11175     [OK]     </span><br><span class="line"></span><br><span class="line">[eternal@192 ~]$ sudo docker search mysql -f=stars=3000</span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   11175     [OK]       </span><br><span class="line">mariadb   MariaDB Server is a high performing open sou…   4243      [OK]</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>docker pull 下载镜像</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载镜像 docker pull 镜像名[:tag]</span></span><br><span class="line">[eternal@192 ~]$ sudo docker pull mysql</span><br><span class="line">Using default tag: latest <span class="comment"># 如果不写tag,默认就是latest</span></span><br><span class="line">latest: Pulling from library/mysql </span><br><span class="line">bf5952930446: Pull complete <span class="comment"># 分层下载，docker image的核心 联合文件系统</span></span><br><span class="line">8254623a9871: Pull complete </span><br><span class="line">938e3e06dac4: Pull complete </span><br><span class="line">ea28ebf28884: Pull complete </span><br><span class="line">f3cef38785c2: Pull complete </span><br><span class="line">894f9792565a: Pull complete </span><br><span class="line">1d8a57523420: Pull complete </span><br><span class="line">6c676912929f: Pull complete </span><br><span class="line">ff39fdb566b4: Pull complete </span><br><span class="line">fff872988aba: Pull complete </span><br><span class="line">4d34e365ae68: Pull complete </span><br><span class="line">7886ee20621e: Pull complete </span><br><span class="line">Digest: sha256:c358e72e100ab493a0304bda35e6f239db2ec8c9bb836d8a427ac34307d074ed <span class="comment"># 签名</span></span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:latest</span><br><span class="line">docker.io/library/mysql:latest <span class="comment"># 真实地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两条命令等价</span></span><br><span class="line">docker pull mysql</span><br><span class="line">docker.io/library/mysql:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定版本下载</span></span><br><span class="line">docker pull mysql:8.0</span><br><span class="line"></span><br><span class="line">[eternal@192 ~]$ sudo docker pull mysql:8.0</span><br><span class="line">[sudo] eternal 的密码：</span><br><span class="line">8.0: Pulling from library/mysql</span><br><span class="line">33847f680f63: Pull complete </span><br><span class="line">5cb67864e624: Pull complete </span><br><span class="line">1a2b594783f5: Pull complete </span><br><span class="line">b30e406dd925: Pull complete </span><br><span class="line">48901e306e4c: Pull complete </span><br><span class="line">603d2b7147fd: Pull complete </span><br><span class="line">802aa684c1c4: Pull complete </span><br><span class="line">715d3c143a06: Pull complete </span><br><span class="line">6978e1b7a511: Pull complete </span><br><span class="line">f0d78b0ac1be: Pull complete </span><br><span class="line">35a94d251ed1: Pull complete </span><br><span class="line">36f75719b1a9: Pull complete </span><br><span class="line">Digest: sha256:8b928a5117cf5c2238c7a09cd28c2e801ac98f91c3f8203a8938ae51f14700fd</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:8.0</span><br><span class="line">docker.io/library/mysql:8.0</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>docker rmi 删除镜像</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mysql         8.0       c60d96bd2b77   5 days ago     514MB</span><br><span class="line">hello-world   latest    d1165f221234   4 months ago   13.3kB</span><br><span class="line"> </span><br><span class="line"><span class="comment">#根据IMAGE ID 来删除指定的镜像</span></span><br><span class="line">[root@AlibabaECS ~]<span class="comment"># docker rmi -f 镜像id                # 删除指定的镜像</span></span><br><span class="line">[root@AlibabaECS ~]<span class="comment"># docker rmi -f  镜像id 镜像id 镜像id  # 删除多个镜像</span></span><br><span class="line">[root@AlibabaECS ~]<span class="comment"># docker rmi -f $(docker images -aq) # 删除全部镜像</span></span><br></pre></td></tr></table></figure>
<h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><p><strong>说明：我们有了镜像才可以创建容器，linux，下载一个centos镜像来测试学习</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>新建容器并启动</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数说明</span></span><br><span class="line">--name = <span class="string">"Name"</span>    容器名字  tomcat01，tomcat02,用来区分容器</span><br><span class="line">-d                 后台方式运行</span><br><span class="line">-it                使用交互方式运行，进入容器查看区分</span><br><span class="line">-p                 指定容器的端口 -p 8080：8080</span><br><span class="line">    -p ip:主机端口：容器端口</span><br><span class="line">    -p 主机端口：容器端口(常用)</span><br><span class="line">    -p 容器端口</span><br><span class="line">    容器端口</span><br><span class="line">-p                 随机指定端口</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试，启动并进入容器</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">centos       latest    300e315adb2f   7 months ago   209MB</span><br><span class="line"></span><br><span class="line">[root@192 eternal]<span class="comment"># docker run -it centos /bin/bash</span></span><br><span class="line"><span class="comment">#进入容器，名称已发生改变</span></span><br><span class="line">[root@f337b5c89a38 /]<span class="comment"># ls		#查看容器内的centos 基础版本，很多命令都是不完善的！</span></span><br><span class="line">bin  home   lost+found	opt   run   sys  var</span><br><span class="line">dev  lib    media	proc  sbin  tmp</span><br><span class="line">etc  lib64  mnt		root  srv   usr</span><br><span class="line">[root@f337b5c89a38 /]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从容器中退回主机</span></span><br><span class="line">[root@f337b5c89a38 /]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@192 eternal]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>列出所有的运行的容器</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker ps 命令</span></span><br><span class="line">			 <span class="comment"># 列出当前正在运行的容器</span></span><br><span class="line">	-a   <span class="comment"># 列出当前正在运行的容器+带出历史运行过的容器</span></span><br><span class="line">  -n=? <span class="comment"># 显示最近创建的容器</span></span><br><span class="line">  -q   <span class="comment"># 只显示容器的编号</span></span><br><span class="line">  </span><br><span class="line">[root@192 eternal]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS                            PORTS     NAMES</span><br><span class="line">f337b5c89a38   centos         <span class="string">"/bin/bash"</span>   4 minutes ago   Exited (130) About a minute ago             quirky_knuth</span><br><span class="line">263278b1e98e   d1165f221234   <span class="string">"/hello"</span>      2 hours ago     Exited (0) 2 hours ago                      elegant_gagarin</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>退出容器</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span>            <span class="comment"># 直接容器停止并退出</span></span><br><span class="line">Ctrl + P + Q    <span class="comment"># 容器不停止退出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动容器</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker start f337b5c89a38 </span></span><br><span class="line">f337b5c89a38</span><br><span class="line">[root@192 eternal]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS         PORTS     NAMES</span><br><span class="line">f337b5c89a38   centos    <span class="string">"/bin/bash"</span>   15 minutes ago   Up 6 seconds             quirky_knuth</span><br><span class="line"><span class="comment">#进入容器</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker run -it centos /bin/bash</span></span><br><span class="line"><span class="comment">#退出容器且不停止运行</span></span><br><span class="line">[root@0ded8a91e9c6 /]<span class="comment"># [root@192 eternal]# docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">0ded8a91e9c6   centos    <span class="string">"/bin/bash"</span>   27 seconds ago   Up 26 seconds             naughty_chatterjee</span><br><span class="line">f337b5c89a38   centos    <span class="string">"/bin/bash"</span>   18 minutes ago   Up 3 minutes              quirky_knuth</span><br><span class="line"><span class="comment">#可以看到容器还在运行</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>删除容器</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id                  <span class="comment"># 删除指定容器，不能删除正在运行的容器，如果要强制删除 rm -f</span></span><br><span class="line">docker rm -f $(docker ps -aq)    <span class="comment"># 删除所有的容器</span></span><br><span class="line">docker ps -aq|xargs docker rm    <span class="comment"># 删除所有的容器</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>启动和停止容器的操作</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id        <span class="comment"># 启动容器</span></span><br><span class="line">docker restart 容器id      <span class="comment"># 重启容器</span></span><br><span class="line">docker stop 容器id         <span class="comment"># 停止当前正在运行的容器</span></span><br><span class="line">docker <span class="built_in">kill</span> 容器id         <span class="comment"># 强制停止当前容器</span></span><br></pre></td></tr></table></figure>
<h2 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h2><blockquote>
<p><strong>后台启动容器</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令 docker run -d 镜像名</span></span><br><span class="line">docker run -d centos</span><br><span class="line"><span class="comment"># 问题docker ps, 发现 centos 停止了</span></span><br><span class="line"><span class="comment"># 常见的坑, docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止</span></span><br><span class="line"><span class="comment"># nginx,容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>查看日志</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker logs -f -t --tail 容器，没有日志</span><br><span class="line"><span class="comment"># 自己编写一段shell脚本</span></span><br><span class="line">docker run -d centos /bin/sh -c <span class="string">"while true;do echo kuangshen;sleep 1;done"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示日志</span></span><br><span class="line">-tf                <span class="comment"># 显示日志</span></span><br><span class="line">--tail number      <span class="comment"># 要显示的日志条数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker logs -ft --tail f1178d5b0bd8</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>查看容器中的进程信息ps</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令 docker top 容器id</span></span><br><span class="line"></span><br><span class="line">[root@192 eternal]<span class="comment"># docker top fcfb1d878478</span></span><br><span class="line">UID                 PID                 PPID                C              STIME          TTY  </span><br><span class="line">root                13589               13564               0              13:22          ?  </span><br><span class="line">root                14172               13589               0              13:27          ?</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>查看镜像源数据</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect f1178d5b0bd8</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                 </span><br><span class="line">d19b9013d986   centos         <span class="string">"/bin/bash"</span>              11 minutes ago   Up 11 minutes           </span><br><span class="line"><span class="comment">#查看源数据</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker inspect d19b9013d986</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"d19b9013d986f9952d28eb554748868a386f5dbd22026d7ac843606ca30eca43"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2021-07-28T05:19:12.629578742Z"</span>,</span><br><span class="line">        <span class="string">"Path"</span>: <span class="string">"/bin/bash"</span>,</span><br><span class="line">        <span class="string">"Args"</span>: [],</span><br><span class="line">        <span class="string">"State"</span>: &#123;</span><br><span class="line">            <span class="string">"Status"</span>: <span class="string">"running"</span>,</span><br><span class="line">            <span class="string">"Running"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Paused"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Restarting"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"OOMKilled"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Dead"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"Pid"</span>: 13175,</span><br><span class="line">            <span class="string">"ExitCode"</span>: 0,</span><br><span class="line">            <span class="string">"Error"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"StartedAt"</span>: <span class="string">"2021-07-28T05:19:12.948018217Z"</span>,</span><br><span class="line">            <span class="string">"FinishedAt"</span>: <span class="string">"0001-01-01T00:00:00Z"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Image"</span>: <span class="string">"sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55"</span>,</span><br><span class="line">        <span class="string">"ResolvConfPath"</span>: <span class="string">"/var/lib/docker/containers/d19b9013d986f9952d28eb554748868a386f5dbd22026d7ac843606ca30eca43/resolv.conf"</span>,</span><br><span class="line">        <span class="string">"HostnamePath"</span>: <span class="string">"/var/lib/docker/containers/d19b9013d986f9952d28eb554748868a386f5dbd22026d7ac843606ca30eca43/hostname"</span>,</span><br><span class="line">        <span class="string">"HostsPath"</span>: <span class="string">"/var/lib/docker/containers/d19b9013d986f9952d28eb554748868a386f5dbd22026d7ac843606ca30eca43/hosts"</span>,</span><br><span class="line">        <span class="string">"LogPath"</span>: <span class="string">"/var/lib/docker/containers/d19b9013d986f9952d28eb554748868a386f5dbd22026d7ac843606ca30eca43/d19b9013d986f9952d28eb554748868a386f5dbd22026d7ac843606ca30eca43-json.log"</span>,</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"/happy_khayyam"</span>,</span><br><span class="line">        <span class="string">"RestartCount"</span>: 0,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"overlay2"</span>,</span><br><span class="line">        <span class="string">"Platform"</span>: <span class="string">"linux"</span>,</span><br><span class="line">        <span class="string">"MountLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"ProcessLabel"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"AppArmorProfile"</span>: <span class="string">""</span>,</span><br><span class="line">        <span class="string">"ExecIDs"</span>: null,</span><br><span class="line">        <span class="string">"HostConfig"</span>: &#123;</span><br><span class="line">            <span class="string">"Binds"</span>: null,</span><br><span class="line">            <span class="string">"ContainerIDFile"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"LogConfig"</span>: &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"json-file"</span>,</span><br><span class="line">                <span class="string">"Config"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"NetworkMode"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"PortBindings"</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">"RestartPolicy"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"no"</span>,</span><br><span class="line">                <span class="string">"MaximumRetryCount"</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"AutoRemove"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"VolumeDriver"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"VolumesFrom"</span>: null,</span><br><span class="line">            <span class="string">"CapAdd"</span>: null,</span><br><span class="line">            <span class="string">"CapDrop"</span>: null,</span><br><span class="line">            <span class="string">"CgroupnsMode"</span>: <span class="string">"host"</span>,</span><br><span class="line">            <span class="string">"Dns"</span>: [],</span><br><span class="line">            <span class="string">"DnsOptions"</span>: [],</span><br><span class="line">            <span class="string">"DnsSearch"</span>: [],</span><br><span class="line">            <span class="string">"ExtraHosts"</span>: null,</span><br><span class="line">            <span class="string">"GroupAdd"</span>: null,</span><br><span class="line">            <span class="string">"IpcMode"</span>: <span class="string">"private"</span>,</span><br><span class="line">            <span class="string">"Cgroup"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Links"</span>: null,</span><br><span class="line">            <span class="string">"OomScoreAdj"</span>: 0,</span><br><span class="line">            <span class="string">"PidMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Privileged"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"PublishAllPorts"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"ReadonlyRootfs"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"SecurityOpt"</span>: null,</span><br><span class="line">            <span class="string">"UTSMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"UsernsMode"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"ShmSize"</span>: 67108864,</span><br><span class="line">            <span class="string">"Runtime"</span>: <span class="string">"runc"</span>,</span><br><span class="line">            <span class="string">"ConsoleSize"</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Isolation"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"CpuShares"</span>: 0,</span><br><span class="line">            <span class="string">"Memory"</span>: 0,</span><br><span class="line">            <span class="string">"NanoCpus"</span>: 0,</span><br><span class="line">            <span class="string">"CgroupParent"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"BlkioWeight"</span>: 0,</span><br><span class="line">            <span class="string">"BlkioWeightDevice"</span>: [],</span><br><span class="line">            <span class="string">"BlkioDeviceReadBps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceWriteBps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceReadIOps"</span>: null,</span><br><span class="line">            <span class="string">"BlkioDeviceWriteIOps"</span>: null,</span><br><span class="line">            <span class="string">"CpuPeriod"</span>: 0,</span><br><span class="line">            <span class="string">"CpuQuota"</span>: 0,</span><br><span class="line">            <span class="string">"CpuRealtimePeriod"</span>: 0,</span><br><span class="line">            <span class="string">"CpuRealtimeRuntime"</span>: 0,</span><br><span class="line">            <span class="string">"CpusetCpus"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"CpusetMems"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Devices"</span>: [],</span><br><span class="line">            <span class="string">"DeviceCgroupRules"</span>: null,</span><br><span class="line">            <span class="string">"DeviceRequests"</span>: null,</span><br><span class="line">            <span class="string">"KernelMemory"</span>: 0,</span><br><span class="line">            <span class="string">"KernelMemoryTCP"</span>: 0,</span><br><span class="line">            <span class="string">"MemoryReservation"</span>: 0,</span><br><span class="line">            <span class="string">"MemorySwap"</span>: 0,</span><br><span class="line">            <span class="string">"MemorySwappiness"</span>: null,</span><br><span class="line">            <span class="string">"OomKillDisable"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"PidsLimit"</span>: null,</span><br><span class="line">            <span class="string">"Ulimits"</span>: null,</span><br><span class="line">            <span class="string">"CpuCount"</span>: 0,</span><br><span class="line">            <span class="string">"CpuPercent"</span>: 0,</span><br><span class="line">            <span class="string">"IOMaximumIOps"</span>: 0,</span><br><span class="line">            <span class="string">"IOMaximumBandwidth"</span>: 0,</span><br><span class="line">            <span class="string">"MaskedPaths"</span>: [</span><br><span class="line">                <span class="string">"/proc/asound"</span>,</span><br><span class="line">                <span class="string">"/proc/acpi"</span>,</span><br><span class="line">                <span class="string">"/proc/kcore"</span>,</span><br><span class="line">                <span class="string">"/proc/keys"</span>,</span><br><span class="line">                <span class="string">"/proc/latency_stats"</span>,</span><br><span class="line">                <span class="string">"/proc/timer_list"</span>,</span><br><span class="line">                <span class="string">"/proc/timer_stats"</span>,</span><br><span class="line">                <span class="string">"/proc/sched_debug"</span>,</span><br><span class="line">                <span class="string">"/proc/scsi"</span>,</span><br><span class="line">                <span class="string">"/sys/firmware"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"ReadonlyPaths"</span>: [</span><br><span class="line">                <span class="string">"/proc/bus"</span>,</span><br><span class="line">                <span class="string">"/proc/fs"</span>,</span><br><span class="line">                <span class="string">"/proc/irq"</span>,</span><br><span class="line">                <span class="string">"/proc/sys"</span>,</span><br><span class="line">                <span class="string">"/proc/sysrq-trigger"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"GraphDriver"</span>: &#123;</span><br><span class="line">            <span class="string">"Data"</span>: &#123;</span><br><span class="line">                <span class="string">"LowerDir"</span>: <span class="string">"/var/lib/docker/overlay2/dd2564cfba071204f422704e6415b7ca5c5a8491e1eaffea52b71b923263af08-init/diff:/var/lib/docker/overlay2/092e6798349c035a360bc973f7d3a2c6d41252e68b6067fa775278441904685a/diff"</span>,</span><br><span class="line">                <span class="string">"MergedDir"</span>: <span class="string">"/var/lib/docker/overlay2/dd2564cfba071204f422704e6415b7ca5c5a8491e1eaffea52b71b923263af08/merged"</span>,</span><br><span class="line">                <span class="string">"UpperDir"</span>: <span class="string">"/var/lib/docker/overlay2/dd2564cfba071204f422704e6415b7ca5c5a8491e1eaffea52b71b923263af08/diff"</span>,</span><br><span class="line">                <span class="string">"WorkDir"</span>: <span class="string">"/var/lib/docker/overlay2/dd2564cfba071204f422704e6415b7ca5c5a8491e1eaffea52b71b923263af08/work"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"Name"</span>: <span class="string">"overlay2"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Mounts"</span>: [],</span><br><span class="line">        <span class="string">"Config"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"d19b9013d986"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Tty"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"OpenStdin"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"StdinOnce"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"Env"</span>: [</span><br><span class="line">                <span class="string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Cmd"</span>: [</span><br><span class="line">                <span class="string">"/bin/bash"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">"Image"</span>: <span class="string">"centos"</span>,</span><br><span class="line">            <span class="string">"Volumes"</span>: null,</span><br><span class="line">            <span class="string">"WorkingDir"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Entrypoint"</span>: null,</span><br><span class="line">            <span class="string">"OnBuild"</span>: null,</span><br><span class="line">            <span class="string">"Labels"</span>: &#123;</span><br><span class="line">                <span class="string">"org.label-schema.build-date"</span>: <span class="string">"20201204"</span>,</span><br><span class="line">                <span class="string">"org.label-schema.license"</span>: <span class="string">"GPLv2"</span>,</span><br><span class="line">                <span class="string">"org.label-schema.name"</span>: <span class="string">"CentOS Base Image"</span>,</span><br><span class="line">                <span class="string">"org.label-schema.schema-version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">                <span class="string">"org.label-schema.vendor"</span>: <span class="string">"CentOS"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"NetworkSettings"</span>: &#123;</span><br><span class="line">            <span class="string">"Bridge"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"SandboxID"</span>: <span class="string">"6a005fd0ac7cf3b331c0908689c1bf4bd72833bd6a0568c40884a71e83f35bfe"</span>,</span><br><span class="line">            <span class="string">"HairpinMode"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"LinkLocalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"LinkLocalIPv6PrefixLen"</span>: 0,</span><br><span class="line">            <span class="string">"Ports"</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">"SandboxKey"</span>: <span class="string">"/var/run/docker/netns/6a005fd0ac7c"</span>,</span><br><span class="line">            <span class="string">"SecondaryIPAddresses"</span>: null,</span><br><span class="line">            <span class="string">"SecondaryIPv6Addresses"</span>: null,</span><br><span class="line">            <span class="string">"EndpointID"</span>: <span class="string">"d15226e38017f4581b48d07956a95a59ac8144489eef214ccfb73d532e22f013"</span>,</span><br><span class="line">            <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">            <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">            <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.2"</span>,</span><br><span class="line">            <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">            <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:02"</span>,</span><br><span class="line">            <span class="string">"Networks"</span>: &#123;</span><br><span class="line">                <span class="string">"bridge"</span>: &#123;</span><br><span class="line">                    <span class="string">"IPAMConfig"</span>: null,</span><br><span class="line">                    <span class="string">"Links"</span>: null,</span><br><span class="line">                    <span class="string">"Aliases"</span>: null,</span><br><span class="line">                    <span class="string">"NetworkID"</span>: <span class="string">"1e9815b8c590e452bececb0f3f9d4dcf4cd91d40780944f960a3668d658455a6"</span>,</span><br><span class="line">                    <span class="string">"EndpointID"</span>: <span class="string">"d15226e38017f4581b48d07956a95a59ac8144489eef214ccfb73d532e22f013"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span>,</span><br><span class="line">                    <span class="string">"IPAddress"</span>: <span class="string">"172.17.0.2"</span>,</span><br><span class="line">                    <span class="string">"IPPrefixLen"</span>: 16,</span><br><span class="line">                    <span class="string">"IPv6Gateway"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6Address"</span>: <span class="string">""</span>,</span><br><span class="line">                    <span class="string">"GlobalIPv6PrefixLen"</span>: 0,</span><br><span class="line">                    <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:02"</span>,</span><br><span class="line">                    <span class="string">"DriverOpts"</span>: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>进入当前正在运行的容器</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 我们通常都是使用后台方式运行的，需要进入容器，修改一些配置</span></span><br><span class="line"><span class="comment"># 命令</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 容器id baseShell</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">fcfb1d878478   centos    <span class="string">"/bin/sh -c 'while t…"</span>   16 minutes ago   Up 16 minutes             nostalgic_chatelet</span><br><span class="line">d19b9013d986   centos    <span class="string">"/bin/bash"</span>              19 minutes ago   Up 19 minutes             happy_khayyam</span><br><span class="line"></span><br><span class="line">[root@192 eternal]<span class="comment"># docker exec -it fcfb1d878478 /bin/bash</span></span><br><span class="line"></span><br><span class="line">[root@fcfb1d878478 /]<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line">[root@fcfb1d878478 /]<span class="comment"># ps -ef</span></span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 05:22 ?        00:00:00 /bin/sh -c <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span> <span class="built_in">echo</span> zhuxiaopeng;sleep 1;<span class="keyword">done</span></span><br><span class="line">root       1004      0  0 05:39 pts/0    00:00:00 /bin/bash</span><br><span class="line">root       1030      1  0 05:39 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sle</span><br><span class="line">root       1031   1004  0 05:39 pts/0    00:00:00 ps -ef</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式二</span></span><br><span class="line">docker attach 容器id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="comment"># docker attach fcfb1d878478 </span></span><br><span class="line">正在执行当前代码。。。</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker exec        # 进入容器后开启一个新的终端，可以在里面操作(常用)</span></span><br><span class="line"><span class="comment"># docker attach      # 进入容器正在执行的终端，不会启动新的进程</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>从容器内拷贝到主机上</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令</span></span><br><span class="line">docker cp [r] 容器id :容器内路径 目的地主机路径</span><br><span class="line"><span class="comment"># 参数r : 递归拷贝</span></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker cp a485a9d900b4:/home/test.java /home</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前运行的容器</span></span><br><span class="line">[root@192 home]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">d19b9013d986   centos    <span class="string">"/bin/bash"</span>   36 minutes ago   Up 36 minutes             happy_khayyam</span><br><span class="line"><span class="comment">#进入容器</span></span><br><span class="line">[root@192 home]<span class="comment"># docker attach d19b9013d986</span></span><br><span class="line"><span class="comment">#在容器中home目录下创建java文件</span></span><br><span class="line">[root@d19b9013d986 /]<span class="comment"># cd /home</span></span><br><span class="line">[root@d19b9013d986 home]<span class="comment"># ls</span></span><br><span class="line">[root@d19b9013d986 home]<span class="comment"># touch test.java</span></span><br><span class="line"><span class="comment">#退出容器</span></span><br><span class="line">[root@d19b9013d986 home]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"><span class="comment">#容器没有运行</span></span><br><span class="line">[root@192 home]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="comment">#查询历史运行</span></span><br><span class="line">[root@192 home]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED             STATUS                       PORTS     NAMES</span><br><span class="line">3ea2748d7593   centos         <span class="string">"/bin/bash"</span>              5 minutes ago       Exited (127) 3 minutes ago             vigorous_shaw</span><br><span class="line">fcfb1d878478   centos         <span class="string">"/bin/sh -c 'while t…"</span>   34 minutes ago      Exited (137) 6 minutes ago             nostalgic_chatelet</span><br><span class="line">d19b9013d986   centos         <span class="string">"/bin/bash"</span>              37 minutes ago      Exited (0) 15 seconds ago              happy_khayyam</span><br><span class="line">4188e7491ced   centos         <span class="string">"/bin/bash"</span>              42 minutes ago      Exited (0) 42 minutes ago              tender_ellis</span><br><span class="line">0ded8a91e9c6   centos         <span class="string">"/bin/bash"</span>              47 minutes ago      Exited (0) 43 minutes ago              naughty_chatterjee</span><br><span class="line">f337b5c89a38   centos         <span class="string">"/bin/bash"</span>              About an hour ago   Exited (0) 44 minutes ago              quirky_knuth</span><br><span class="line">263278b1e98e   d1165f221234   <span class="string">"/hello"</span>                 3 hours ago         Exited (0) 3 hours ago                 elegant_gagarin</span><br><span class="line"><span class="comment">#将容器中的java文件拷贝到主机home目录下</span></span><br><span class="line">[root@192 home]<span class="comment"># docker cp d19b9013d986:/home/test.java /home</span></span><br><span class="line"><span class="comment">#查看，已成功复制test.java</span></span><br><span class="line">[root@192 home]<span class="comment"># ls</span></span><br><span class="line">eternal  springboot  test.java  www  zhuxiaopeng.java</span><br></pre></td></tr></table></figure>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728145612058.png" alt="image-20210728145612058"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">attach    Attach to a running container  #当前shell下attach连接指定运行镜像</span><br><span class="line"></span><br><span class="line">build     Build an image from a Dockerfile  #通过Dockerfile定制镜像</span><br><span class="line"></span><br><span class="line">commit    Create a new image from a containers changes  #提交当前容器为新的镜像</span><br><span class="line"></span><br><span class="line">cp    Copy files/folders from a container to a HOSTDIR or to STDOUT  #从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line"></span><br><span class="line">create    Create a new container  #创建一个新的容器，同run 但不启动容器</span><br><span class="line"></span><br><span class="line">diff    Inspect changes on a containers filesystem  #查看docker容器变化</span><br><span class="line"></span><br><span class="line">events    Get real time events from the server#从docker服务获取容器实时事件</span><br><span class="line"></span><br><span class="line">exec    Run a command in a running container#在已存在的容器上运行命令</span><br><span class="line"></span><br><span class="line">export    Export a containers filesystem as a tar archive  #导出容器的内容流作为一个tar归档文件(对应import)</span><br><span class="line"></span><br><span class="line">history    Show the history of an image  #展示一个镜像形成历史</span><br><span class="line"></span><br><span class="line">images    List images  #列出系统当前镜像</span><br><span class="line"></span><br><span class="line">import    Import the contents from a tarball to create a filesystem image  #从tar包中的内容创建一个新的文件系统映像(对应export)</span><br><span class="line"></span><br><span class="line">info    Display system-wide information  #显示系统相关信息</span><br><span class="line"></span><br><span class="line">inspect    Return low-level information on a container or image  #查看容器详细信息</span><br><span class="line"></span><br><span class="line">kill    Kill a running container  #kill指定docker容器</span><br><span class="line"></span><br><span class="line">load    Load an image from a tar archive or STDIN  #从一个tar包中加载一个镜像(对应save)</span><br><span class="line"></span><br><span class="line">login    Register or log in to a Docker registry#注册或者登陆一个docker源服务器</span><br><span class="line"></span><br><span class="line">logout    Log out from a Docker registry  #从当前Docker registry退出</span><br><span class="line"></span><br><span class="line">logs    Fetch the logs of a container  #输出当前容器日志信息</span><br><span class="line"></span><br><span class="line">pause    Pause all processes within a container#暂停容器</span><br><span class="line"></span><br><span class="line">port    List port mappings or a specific mapping for the CONTAINER  #查看映射端口对应的容器内部源端口</span><br><span class="line"></span><br><span class="line">ps    List containers  #列出容器列表</span><br><span class="line"></span><br><span class="line">pull    Pull an image or a repository from a registry  #从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line"></span><br><span class="line">push    Push an image or a repository to a registry  #推送指定镜像或者库镜像至docker源服务器</span><br><span class="line"></span><br><span class="line">rename    Rename a container  #重命名容器</span><br><span class="line"></span><br><span class="line">restart    Restart a running container  #重启运行的容器</span><br><span class="line"></span><br><span class="line">rm    Remove one or more containers  #移除一个或者多个容器</span><br><span class="line"></span><br><span class="line">rmi    Remove one or more images  #移除一个或多个镜像(无容器使用该镜像才可以删除，否则需要删除相关容器才可以继续或者-f强制删除)</span><br><span class="line"></span><br><span class="line">run    Run a command in a new container  #创建一个新的容器并运行一个命令</span><br><span class="line"></span><br><span class="line">save    Save an image(s) to a tar archive#保存一个镜像为一个tar包(对应load)</span><br><span class="line"></span><br><span class="line">search    Search the Docker Hub for images  #在docker</span><br><span class="line"></span><br><span class="line">hub中搜索镜像</span><br><span class="line">start    Start one or more stopped containers#启动容器</span><br><span class="line"></span><br><span class="line">stats    Display a live stream of container(s) resource usage statistics  #统计容器使用资源</span><br><span class="line"></span><br><span class="line">stop    Stop a running container  #停止容器</span><br><span class="line"></span><br><span class="line">tag         Tag an image into a repository  #给源中镜像打标签</span><br><span class="line"></span><br><span class="line">top       Display the running processes of a container #查看容器中运行的进程信息</span><br><span class="line"></span><br><span class="line">unpause    Unpause all processes within a container  #取消暂停容器</span><br><span class="line"></span><br><span class="line">version    Show the Docker version information#查看容器版本号</span><br><span class="line"></span><br><span class="line">wait         Block until a container stops, then print its exit code  #截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure>
<h2 id="作业练习"><a href="#作业练习" class="headerlink" title="作业练习"></a>作业练习</h2><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><blockquote>
<p><strong>使用Docker 安装 Nginx</strong></p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728180401165.png" alt="image-20210728180401165"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、搜索镜像</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker pull nginx</span></span><br><span class="line"><span class="comment"># 2、开启一个端口</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker run -d --name nginx01 -p 3344:80 nginx</span></span><br><span class="line">07e8c16c1f84cbb020b53f16bb7c0a25ae82c10d129b1f0c29c5e82b76a86888</span><br><span class="line"><span class="comment"># 3、查看当前运行</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                                   NAMES</span><br><span class="line">07e8c16c1f84   nginx     <span class="string">"/docker-entrypoint.…"</span>   5 seconds ago   Up 2 seconds   0.0.0.0:3344-&gt;80/tcp, :::3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="comment"># 4、测试访问（主机可以通过浏览器访问）</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># curl localhost:3344</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">......</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、进入容器</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker exec -it nginx01 /bin/bash</span></span><br><span class="line"><span class="comment"># 6、寻找nginx</span></span><br><span class="line">root@07e8c16c1f84:/<span class="comment"># whereis nginx</span></span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line"><span class="comment"># 7、nginx的路径</span></span><br><span class="line">root@07e8c16c1f84:/<span class="comment"># cd /usr/share/nginx</span></span><br><span class="line">root@07e8c16c1f84:/usr/share/nginx<span class="comment"># ls</span></span><br><span class="line">html</span><br><span class="line"><span class="comment"># 8、首页的位置</span></span><br><span class="line">root@07e8c16c1f84:/usr/share/nginx<span class="comment"># cd html</span></span><br><span class="line">root@07e8c16c1f84:/usr/share/nginx/html<span class="comment"># ls</span></span><br><span class="line">50x.html  index.html</span><br><span class="line"><span class="comment"># 9、进去查看</span></span><br><span class="line">root@07e8c16c1f84:/usr/share/nginx/html<span class="comment"># cat index.html</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">......</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                   NAMES</span><br><span class="line">07e8c16c1f84   nginx     <span class="string">"/docker-entrypoint.…"</span>   22 minutes ago   Up 22 minutes   0.0.0.0:3344-&gt;80/tcp, :::3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="comment"># 10、停止nginx</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker stop 07e8c16c1f84</span></span><br><span class="line">07e8c16c1f84</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>centos7关闭防火墙</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看防火墙状态</span></span><br><span class="line">systemctl status firewalld.service</span><br><span class="line"><span class="comment"># 执行后可以看到绿色字样标注的“active（running）”，说明防火墙是开启状态</span></span><br><span class="line"><span class="comment"># 关闭运行的防火墙</span></span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"><span class="comment"># 查看防火墙状态</span></span><br><span class="line">systemctl status firewalld.service		<span class="comment">#disavtive（dead）的字样，说明防火墙已经关闭</span></span><br><span class="line"><span class="comment"># 每次开机都要关闭防火墙 麻烦那就把防火墙禁用</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>重新打开刚刚关闭的端口</strong></p>
</blockquote>
<p>直接对端口进行删除操作之后，创建一个同名的端口会报错</p>
<p>Error response from daemon: driver failed programming external connectivity on endpoint</p>
<p><strong>错误展示</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost eternal]<span class="comment"># docker ps -l</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">07e8c16c1f84   nginx     <span class="string">"/docker-entrypoint.…"</span>   38 minutes ago   Exited (0) 15 minutes ago             nginx01</span><br><span class="line">[root@localhost eternal]<span class="comment"># docker rm 07e8c16c1f84</span></span><br><span class="line">07e8c16c1f84</span><br><span class="line">[root@localhost eternal]<span class="comment"># docker run -d --name nginx01 -p 3344:80 nginx</span></span><br><span class="line">90e868c7c07dc025f0bb4449d481397b415a5c1f87c4f0043dea0bb4f144ced8</span><br><span class="line">docker: Error response from daemon: driver failed programming external connectivity on endpoint nginx01</span><br></pre></td></tr></table></figure>
<p>Docker容器做端口映射报错，docker服务启动时定义的自定义链DOCKER被清除；重启即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<p><strong>解决方案</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启docker服务</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># systemctl restart docker</span></span><br><span class="line"><span class="comment">#打开关闭的端口</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker run -d --name nginx01 -p 3344:80 nginx</span></span><br><span class="line">docker: Error response from daemon: Conflict. The container name <span class="string">"/nginx01"</span> is already <span class="keyword">in</span> use by container <span class="string">"90e868c7c07dc025f0bb4449d481397b415a5c1f87c4f0043dea0bb4f144ced8"</span>. You have to remove (or rename) that container to be able to reuse that name.  </span><br><span class="line"><span class="comment">#您必须删除(或重命名)该容器才能重用该名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#顾名思义就是让我们删除掉该容器，重新创建一个</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看当前运行的容器</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="comment">#查看历史运行</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker ps -l</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS    PORTS     NAMES</span><br><span class="line">90e868c7c07d   nginx     <span class="string">"/docker-entrypoint.…"</span>   3 minutes ago   Created             nginx01</span><br><span class="line"><span class="comment">#删除所要打开的端口</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker rm 90e868c7c07d   </span></span><br><span class="line">90e868c7c07d</span><br><span class="line"><span class="comment">#重新打开</span></span><br><span class="line">[root@localhost eternal]<span class="comment"># docker run -d --name nginx01 -p 3344:80 nginx</span></span><br><span class="line">b61e0caa7a821a97c7c9e0688efd72fa3bc09b899fb93d98072919ed0b7ebc8a</span><br></pre></td></tr></table></figure>
<ul>
<li>当关闭一个端口后，需要再次打开。</li>
<li>先重启docker服务</li>
<li>在遍历查询历史运行，找到之前关闭的那个端口</li>
<li>对端口进行删除操作</li>
<li>重新打开端口（重新创建一个）</li>
</ul>
<h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><blockquote>
<p><strong>使用docker安装 tomcat</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 官方文档解释</span></span><br><span class="line"><span class="comment"># -it ：交互模式</span></span><br><span class="line"><span class="comment"># --rm：容器启动成功并退出以后容器就自动移除，一般在测试情况下使用！</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="comment"># 1、下载tomcat镜像</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"><span class="comment"># 2、启动</span></span><br><span class="line">docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line"><span class="comment">#通过网页打开3355端口，出现404，表明里面没有找到页面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、进入tomcat</span></span><br><span class="line">docker <span class="built_in">exec</span> -it tomcat01 /bin/bash</span><br><span class="line"><span class="comment"># linux命令少了，没有webapps 阿里云镜像的原因，最精简化</span></span><br><span class="line"></span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># ls			#查看当前目录</span></span><br><span class="line">BUILDING.txt	 NOTICE		RUNNING.txt  lib	     temp	   work</span><br><span class="line">CONTRIBUTING.md  README.md	bin	     logs	     webapps</span><br><span class="line">LICENSE		 RELEASE-NOTES	conf	     native-jni-lib  webapps.dist</span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps		#进入webapps</span></span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls		#发现什么都没有</span></span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># cd ..</span></span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps.dist</span></span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat/webapps.dist<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat/webapps.dist<span class="comment"># cd ..</span></span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cp -r webapps.dist/* wbapps		#将dist里面的内容复制到webapps</span></span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@e73511afd63d:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls		#重新查看</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line"></span><br><span class="line"><span class="comment">#这时候，通过网页打开3355端口，就可以看到tomcat的欢迎页</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、思考：我们以后要部署项目，还需要进入容器中，是不是十分麻烦，要是有一种技术，可以将容器内和我们Linux进行映射挂载就好了？我们后面会将数据卷技术来进行挂载操作，也是一个核心内容，这里大家先听听名词就好，我们很快就会讲到！</span></span><br></pre></td></tr></table></figure>
<h3 id="es-kibana"><a href="#es-kibana" class="headerlink" title="es+kibana"></a><strong>es+kibana</strong></h3><blockquote>
<p><strong>使用docker 部署 es + kibana</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># es 暴露的端口很多！</span></span><br><span class="line"><span class="comment"># es 的数据一般需要放置到安全目录！挂载</span></span><br><span class="line"><span class="comment"># --net somenetwork ? 网络配置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动elasticsearch</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e <span class="string">"discovery.type=single-node"</span> elasticsearch:7.6.2</span><br><span class="line"><span class="comment"># 测试一下es是否成功启动</span></span><br><span class="line">curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"bbe65dfe0dbf"</span>,</span><br><span class="line">  <span class="string">"cluster_name"</span> : <span class="string">"docker-cluster"</span>,</span><br><span class="line">  <span class="string">"cluster_uuid"</span> : <span class="string">"oDk8zmm9Tc2B1QH6wtkpLg"</span>,</span><br><span class="line">  <span class="string">"version"</span> : &#123;</span><br><span class="line">    <span class="string">"number"</span> : <span class="string">"7.6.2"</span>,</span><br><span class="line">    <span class="string">"build_flavor"</span> : <span class="string">"default"</span>,</span><br><span class="line">    <span class="string">"build_type"</span> : <span class="string">"docker"</span>,</span><br><span class="line">    <span class="string">"build_hash"</span> : <span class="string">"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"</span>,</span><br><span class="line">    <span class="string">"build_date"</span> : <span class="string">"2020-03-26T06:34:37.794943Z"</span>,</span><br><span class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"lucene_version"</span> : <span class="string">"8.4.0"</span>,</span><br><span class="line">    <span class="string">"minimum_wire_compatibility_version"</span> : <span class="string">"6.8.0"</span>,</span><br><span class="line">    <span class="string">"minimum_index_compatibility_version"</span> : <span class="string">"6.0.0-beta1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#查看所占用内存</span></span><br><span class="line">docker stats</span><br><span class="line"><span class="comment">#由于我配置的虚拟机内存8GB所以一切很流畅</span></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT    MEM %     NET I/O         BLOCK I/O     PIDS</span><br><span class="line">bbe65dfe0dbf   elasticsearch   0.43%     1.263GiB / 7.62GiB   16.58%    1.18kB / 942B   0B / 1.67MB   46</span><br><span class="line"><span class="comment">#关闭es，修改内存限制</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS                                                                                  NAMES</span><br><span class="line">bbe65dfe0dbf   elasticsearch:7.6.2   <span class="string">"/usr/local/bin/dock…"</span>   5 minutes ago   Up 5 minutes   0.0.0.0:9200-&gt;9200/tcp, :::9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp, :::9300-&gt;9300/tcp   elasticsearch</span><br><span class="line">[root@192 eternal]<span class="comment"># docker stop bbe65dfe0dbf</span></span><br><span class="line">bbe65dfe0dbf</span><br><span class="line"></span><br><span class="line"><span class="comment">#elasticsearch十分占用内存,需要修改配置文件 -e 限制其启动的内存</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e ES_JAVA_OPTS=<span class="string">"-Xms64m -Xmx 512m"</span>  elasticsearch:7.6.2</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210728215452469.png" alt="image-20210728215452469"></p>
<h2 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h2><ul>
<li>portainer</li>
</ul>
<ul>
<li>Rancher(CI/CD再用)</li>
</ul>
<p><strong>什么是portainer?</strong></p>
<p>Docker图形化界面管理工具! 提供一个后台面板供我们操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 \--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=<span class="literal">true</span> portainer/portainer</span><br></pre></td></tr></table></figure>
<p><strong>查看linux端口</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"><span class="comment">#找到ens33的ip地址，直接在window浏览器输入ip+端口号即可打开网页</span></span><br></pre></td></tr></table></figure>
<p>访问测试: 外网: 8088 <a href="http://外网ip:8088/" target="_blank" rel="noopener">http://外网ip:8088/</a></p>
<p><strong>界面展示</strong></p>
<p>第一次注册用户后，选择连接方式</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729092936856.png" alt="image-20210729092936856"></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729093804324.png" alt="image-20210729093804324"></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729093718131.png" alt="image-20210729093718131"></p>
<h1 id="5-Docker镜像"><a href="#5-Docker镜像" class="headerlink" title="5.Docker镜像"></a>5.Docker镜像</h1><h2 id="镜像是什么"><a href="#镜像是什么" class="headerlink" title="镜像是什么"></a>镜像是什么</h2><p>镜像就是一个轻量级的,可执行的独立软件包,用来打包软件运行环境和基于运行环境开发的软件,它包含运行某个软件所需的所有内容,包括代码,运行时,库,环境变量和配置文件。</p>
<p>所有的应用,直接打包docker镜像,就可以直接跑起来!</p>
<p><strong>如何得到镜像:</strong></p>
<ul>
<li>从远程仓库下载</li>
<li>朋友拷贝给你</li>
<li>自己制作一个镜像 DockerFile</li>
</ul>
<h2 id="Docker镜像加载原理"><a href="#Docker镜像加载原理" class="headerlink" title="Docker镜像加载原理"></a>Docker镜像加载原理</h2><blockquote>
<p><strong>UnionFs(联合文件系统查询)</strong></p>
</blockquote>
<p>我们下载的时候看到的一层一层就是这个</p>
<p><strong>UnionFs(联合文件系统):</strong> Union文件系统(UnionFS)是一种分层,轻量级并且高性能的文件系统,它支持对文件系统的修改作为一次提交来一层层的叠加,同时可以将不同目录挂载到同一个虚拟文件系统下,Union文件系统是Docker镜像的基础,镜像可以通过分层来进行继承,基于基础镜像(没有父镜像),可以制作各种具体的应用镜像</p>
<p><strong>特性:</strong> 一次同时加载多个文件系统,但从外面看起来,只能看到一个文件系统,联合加载会把各层文件系统叠加起来,这样最终的文件系统会包含所有底层的文件和目录结构</p>
<blockquote>
<p><strong>Docker镜像加载原理</strong></p>
</blockquote>
<p>docker的镜像实际上由一层一层的文件系统组成,这种层级的文件系统UnionFS</p>
<p><strong>bootfs(boot file system)</strong>主要包含bootlloader和kernel,bootfs主要是引导加载kernel,Linux刚启动时会加载bootfs文件系统,在docker镜像的最底层是bootfs,这一层与我们典型的Linux/Unix系统是一样的,包含boot加载器和内核,当boot加载完成之后整个内核就在内存中了,此时内存的使用权已由bootfa转交给内核,此时系统也会卸载bootfs</p>
<p>rootfs(root file system),在bootfs之上,包含的就是典型Linux系统中的/dev, /proc,/bin, /etc等标准目录和文件,rootfs就是各种不同的操作系统发行版,比如Ubuntu, CentOS等等</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729094559761.png" alt="image-20210729094559761"></p>
<p>平时我们安装进虚拟机的CentOS都是好几个G,为什么Docker这里才200M?</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># docker images</span></span><br><span class="line"></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat                9.0       46cfbf1293b1   5 days ago      668MB</span><br><span class="line">tomcat                latest    46cfbf1293b1   5 days ago      668MB</span><br><span class="line">nginx                 latest    08b152afcfae   6 days ago      133MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   4 months ago    79.1MB</span><br><span class="line">centos                latest    300e315adb2f   7 months ago    209MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   16 months ago   791MB</span><br></pre></td></tr></table></figure>
<p>对于一个精简的OS,rootfs可以很小,只需要包含基本的命令,工具和程序库就可以了,因为底层直接用Host的kernel,自己只需要提供rootFS就可以了。由此可见对于不同的linux发行版,bootfs基本是一致的,rootfs会有差别,因此不同的发行版可以共用bootfs</p>
<h2 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h2><blockquote>
<p><strong>分层镜像</strong></p>
</blockquote>
<p>我们可以去下载一个镜像,注意观察下载的日志输出,可以看到是一层一层的在下载!</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729101847597.png" alt="image-20210729101847597"></p>
<p>思考: 为什么Docker镜像要采用这种分层的结构呢?</p>
<p>最大好处,我觉得莫过于资源共享了!比如有多个镜像都从相同的Base镜像构建而来,那么宿主机</p>
<p>只需在磁盘上保留一份base镜像,同时内存中也只需要加载一份base镜像,这样就可以为所有的容器服务了,而且镜像的每一层都可以被共享</p>
<p>查看镜像分层的方式可以通过<code>docker image inspect</code> 命令!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># docker pull redis</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/redis</span><br><span class="line">33847f680f63: Already exists </span><br><span class="line">26a746039521: Pull complete </span><br><span class="line">18d87da94363: Pull complete </span><br><span class="line">5e118a708802: Pull complete </span><br><span class="line">ecf0dbe7c357: Pull complete </span><br><span class="line">46f280ba52da: Pull complete </span><br><span class="line">Digest: sha256:cd0c68c5479f2db4b9e2c5fbfdb7a8acb77625322dd5b474578515422d3ddb59</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> redis:latest</span><br><span class="line">docker.io/library/redis:latest</span><br><span class="line">[root@192 eternal]<span class="comment"># docker image inspect redis</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"RootFS"</span>: &#123;</span><br><span class="line">            <span class="string">"Type"</span>: <span class="string">"layers"</span>,</span><br><span class="line">            <span class="string">"Layers"</span>: [</span><br><span class="line">                <span class="string">"sha256:814bff7343242acfd20a2c841e041dd57c50f0cf844d4abd2329f78b992197f4"</span>,</span><br><span class="line">                <span class="string">"sha256:dd1ebb1f5319785e34838c7332a71e5255bda9ccf61d2a0bf3bff3d2c3f4cdb4"</span>,</span><br><span class="line">                <span class="string">"sha256:11f99184504048b93dc2bdabf1999d6bc7d9d9ded54d15a5f09e36d8c571c32d"</span>,</span><br><span class="line">                <span class="string">"sha256:e461360755916af80821289b1cbc503692cf63e4e93f09b35784d9f7a819f7f2"</span>,</span><br><span class="line">                <span class="string">"sha256:45f6df6342536d948b07e9df6ad231bf17a73e5861a84fc3c9ee8a59f73d0f9f"</span>,</span><br><span class="line">                <span class="string">"sha256:262de04acb7e0165281132c876c0636c358963aa3e0b99e7fbeb8aba08c06935"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>理解:</p>
<p>所有的镜像都起始于一个基础镜像层,当进行修改或增加新的内容时,就会在当前镜像层之上,创建一个新的镜像层,</p>
<p>举一个简单的例子,假如基于Ubuntu Linux 16.64创建一个新的镜像,这就是新镜像的第一层,如果在该镜像中添加python包,就会在该镜像之上创建第二个镜像层; 如果继续添加一个安全补丁,就会创建第三个镜像层</p>
<p>该镜像已经包含3个镜像层,如下图所示(这只是一个简单的例子)<br><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729102349446.png" alt="image-20210729102349446"></p>
<p>在添加额外的镜像层的同时,镜像始终保持是当前所有镜像的组合,理解这一点非常重要,下图举了一个简单的例子,每个镜像层包含3个文件,而镜像包含了两个镜像层的6个文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729102414546.png" alt="image-20210729102414546"></p>
<p>上图中的镜像层跟之前图中的略有区别,主要是便于展示文件</p>
<p>下图中展示了一个稍微复杂的三层镜像,在外部看来整个镜像只有6个文件,这是因为最上层的文件7是文件5的一个更新版本</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729102456662.png" alt="image-20210729102456662"></p>
<p>这种情况下,上层镜像层中的文件覆盖了底层镜像层中的文件,这样就使得文件的更新版本作为一个新镜像层添加到镜像当中</p>
<p>Docker通过存储引擎(新版本采用快照机制)的方式来实现镜像层堆栈,并保证多层镜像层对外展示为统一的文件系统</p>
<p>Lunux上可用的存储引擎有AUFS,Overlay2,Device Mapper,Btrfs以及ZFS,顾名思义,每种存储引擎都是基于Linux对应的文件系统或者块设备技术,并且每种存储引擎都有其独有的性能特点</p>
<p>Docker在Windows上仅支持windosfilter一种存储引擎,该引擎基于NTFS文件系统之上实现了分层和CoW[1]</p>
<p>下图展示了与系统显示相同的三层镜像,所有的镜像层堆叠合并,对外提供统一的视图层</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729102624657.png" alt="image-20210729102624657"></p>
<blockquote>
<p><strong>特点</strong></p>
</blockquote>
<p>Docker镜像都是只读的,当容器启动时,一个新的可写层被加载到镜像的顶部!</p>
<p>这一层就是我们通常所说的容器层,容器之下的都叫镜像层</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/20200619183036853.png" alt="img"></p>
<p>如何提交一个自己的镜像</p>
<h2 id="commit镜像"><a href="#commit镜像" class="headerlink" title="commit镜像"></a>commit镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的镜像</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令和git原理类似</span></span><br><span class="line">docker commit -m=<span class="string">"提交的描述信息"</span> -a=<span class="string">"作者"</span> 容器ID 目标镜像名:[tag]</span><br></pre></td></tr></table></figure>
<p>测试tomcat</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、从Docker Hub 下载tomcat镜像到本地并运行 -it 交互终端 -p 端口映射</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat</span><br><span class="line"><span class="comment"># 注意：坑爹：docker启动官方tomcat镜像的容器，发现404是因为使用了加速器，而加速器里的tomcat的webapps下没有root等文件！</span></span><br><span class="line"><span class="comment"># 下载tomcat官方镜像，就是这个镜像（阿里云里的tomcat的webapps下没有任何文件）</span></span><br><span class="line"><span class="comment"># 进入tomcat查看cd到webapps下发现全部空的，反而有个webapps.dist里有对应文件，cp -r到webapps下！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、复制内容</span></span><br><span class="line"><span class="comment">#启动tomcat，并进入webapps目录</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker run -d -p 3355:8080 --name tomcat01 tomcat</span></span><br><span class="line">7b5dbb35aed317ea494c5875d8268f52ebfecc84e5e3862047b55a8c2379da91</span><br><span class="line">[root@192 eternal]<span class="comment"># docker exec -it tomcat01 /bin/bash</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># cd ..</span></span><br><span class="line"><span class="comment">#使webapps里面有内容</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cp -r webapps.dist/* webapps</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、删除镜像产生的tomcat容器文档</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker exec -it tomcat01 /bin/bash</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line"><span class="comment">#可以看到docs存在</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># curl localhost:8080/docs/</span></span><br><span class="line"><span class="comment">#成功进入</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># rm -rf docs	#删除docs</span></span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  examples	host-manager  manager</span><br><span class="line">root@7b5dbb35aed3:/usr/<span class="built_in">local</span>/tomcat/webapps<span class="comment"># curl localhost:8080/docs/	#再次访问就是404</span></span><br><span class="line">&lt;!doctype html&gt;&lt;html lang=<span class="string">"en"</span>&gt;&lt;head&gt;&lt;title&gt;HTTP Status 404 – Not Found&lt;/title&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、当前运行的tomcat实例就是一个没有docs的容器，我们使用它为模板commit一个没有docs的tomcat新镜像， tomcat02</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                                       NAMES</span><br><span class="line">7b5dbb35aed3   tomcat    <span class="string">"catalina.sh run"</span>   14 minutes ago   Up 14 minutes   0.0.0.0:3355-&gt;8080/tcp, :::3355-&gt;8080/tcp   tomcat01</span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：commit的时候，容器的名字不能有大写，否则报错：invalid reference format</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker commit -a="eternal" -m="no tomcat docs" 7b5dbb35aed3 tomcat02:2.1</span></span><br><span class="line">sha256:e06f510955ba2d0f47e571dcb19faec62a83130483de35a756286572efb03849</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看提交的镜像 tomcat02</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat02              2.1       e06f510955ba   6 seconds ago   670MB</span><br><span class="line">tomcat                9.0       46cfbf1293b1   5 days ago      668MB</span><br><span class="line">[root@192 eternal]<span class="comment"># </span></span><br><span class="line"><span class="comment"># 这样我们自己就创建了一个镜像，使用修改过的镜像</span></span><br></pre></td></tr></table></figure>
<p> 如果你想要保存你当前的状态，可以通过commit，来提交镜像，方便使用，类似于 VM 中的快照！</p>
<h1 id="6-容器数据卷"><a href="#6-容器数据卷" class="headerlink" title="6.容器数据卷"></a>6.容器数据卷</h1><h2 id="什么是容器数据卷"><a href="#什么是容器数据卷" class="headerlink" title="什么是容器数据卷"></a>什么是容器数据卷</h2><p><strong>docker的理念回顾</strong>：</p>
<p>将应用和运行的环境打包形成容器运行，运行可以伴随着容器，但是我们对于数据的要求，是希望能够 持久化的！将应用和环境打包成一个镜像!</p>
<p><strong>问题</strong></p>
<ul>
<li><p>数据都在容器中,那么我们容器删除,数据就会丢失! <strong>需求: 数据可以持久化</strong></p>
</li>
<li><p>MYSQL, 容器删了,删库跑路! <strong>需求: mysql数据可以存储在本地!</strong></p>
</li>
</ul>
<p>所以我们希望容器之间有可能可以共享数据，Docker容器产生的数据，如果不通过docker commit 生成 新的镜像，使得数据作为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了！这样是行 不通的！</p>
<p>为了能保存数据在Docker中我们就可以使用卷！让数据挂载到我们本地！这样数据就不会因为容器删除 而丢失了！容器之间可以有一个数据共享的技术! Docker 容器中产生的数据,同步到本地!</p>
<p>这就是卷技术! 目录的挂载,将容器内的目录挂载到Linux上面!</p>
<p><strong>作用：</strong></p>
<p>卷就是目录或者文件，存在一个或者多个容器中，由docker挂载到容器，但不属于联合文件系统，因此 能够绕过 Union File System ， 提供一些用于持续存储或共享数据的特性：</p>
<p> 卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂 载的数据卷。</p>
<p><strong>特点：</strong></p>
<p>1、数据卷可在容器之间共享或重用数据 </p>
<p>2、卷中的更改可以直接生效 </p>
<p>3、数据卷中的更改不会包含在镜像的更新中 </p>
<p>4、数据卷的生命周期一直持续到没有容器使用它为止</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729205225518.png" alt="image-20210729205225518"></p>
<p><strong>总结一句话： 就是容器的持久化，以及容器间的继承和数据共享！</strong></p>
<h2 id="使用数据卷"><a href="#使用数据卷" class="headerlink" title="使用数据卷"></a>使用数据卷</h2><blockquote>
<p>方式一: 直接使用命令来挂载 -v</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录: 容器内目录  -p 主机端口: 容器端口</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动起来我们可以使用 docker inspect 容器id</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># cd /home</span></span><br><span class="line">[root@192 home]<span class="comment"># ls</span></span><br><span class="line">eternal  springboot  www  </span><br><span class="line"><span class="comment"># 挂载</span></span><br><span class="line">[root@192 home]<span class="comment"># docker run -it -v /home/ceshi:/home centos /bin/bash</span></span><br><span class="line">[root@bc24b5930880 /]<span class="comment"># ls</span></span><br><span class="line">bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line">[root@bc24b5930880 /]<span class="comment"># cd /home</span></span><br><span class="line">[root@bc24b5930880 home]<span class="comment"># ls</span></span><br><span class="line">[root@bc24b5930880 home]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看是否挂在成功</span></span><br><span class="line">[root@bc24b5930880 home]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@192 home]<span class="comment"># ls</span></span><br><span class="line">ceshi  eternal  springboot  www</span><br><span class="line">[root@192 home]<span class="comment"># docker ps -l</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS       </span><br><span class="line">bc24b5930880   centos    <span class="string">"/bin/bash"</span>   13 minutes ago   Exited (0) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看挂载信息</span></span><br><span class="line">[root@192 home]<span class="comment"># docker inspect bc24b5930880 </span></span><br><span class="line"> <span class="string">"Mounts"</span>: [		<span class="comment"># 挂载 -v 卷</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"bind"</span>,		</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/home/ceshi"</span>,		<span class="comment"># 主机内地址</span></span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/home"</span>,			<span class="comment"># docker容器内的地址</span></span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">"rprivate"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br></pre></td></tr></table></figure>
<p><strong>测试容器和宿主机之间数据共享：可以发现，在容器中，创建的会在宿主机中看到</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729205106638.png" alt="image-20210729205106638"></p>
<p>同步的过程，双向绑定，里面发生改变，外部也会发生改变</p>
<p><strong>测试容器停止退出后，主机修改数据是否会同步</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729205912699.png" alt="image-20210729205912699"></p>
<ul>
<li>停止容器</li>
<li>宿主机上修改文件</li>
<li>启动容器</li>
<li>查看文件（已被修改）</li>
</ul>
<p><strong>好处：</strong>我们以后修改只需要在本地修改即可，容器内会自动同步</p>
<h2 id="实战-安装Mysql"><a href="#实战-安装Mysql" class="headerlink" title="实战: 安装Mysql"></a>实战: 安装Mysql</h2><p>思考: mysql的数据持久化的问题, data目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除文件夹，删除容器</span></span><br><span class="line">[root@192 home]<span class="comment"># rm -rf ceshi</span></span><br><span class="line">[root@192 home]<span class="comment"># ls</span></span><br><span class="line">eternal  springboot  www</span><br><span class="line">[root@192 home]<span class="comment"># docker ps -l</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         </span><br><span class="line">8646e18386c8   centos    <span class="string">"/bin/bash"</span>   19 minutes ago   </span><br><span class="line">[root@192 home]<span class="comment"># docker rm 8646e18386c8</span></span><br><span class="line">8646e18386c8</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取mysql镜像</span></span><br><span class="line">[root@192 home]<span class="comment"># docker pull mysql:8.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行容器,需要做数据挂载! # 安装启动mysql,需要配置密码,这是官方的</span></span><br><span class="line"><span class="comment"># 官方测试: docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=密码 -d mysql:tag</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#启mysql</span></span><br><span class="line">-d  后台运行</span><br><span class="line">-p  端口暴露（将3306端口映射为3310）</span><br><span class="line">-v  数据挂载</span><br><span class="line">-e  环境配置</span><br><span class="line">--name 容器名</span><br><span class="line"></span><br><span class="line">[root@192 home]<span class="comment"># docker run  -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root --name mysql01 mysql:8.0</span></span><br><span class="line">88e95814f3c099498ee747a88c8343a4152e3e9200c16e93515bf96ee6569e9f</span><br></pre></td></tr></table></figure>
<h3 id="测试链接"><a href="#测试链接" class="headerlink" title="测试链接"></a><strong>测试链接</strong></h3><p>window下打开navcate创建新的连接，我们的端口是3310</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729212554797.png" alt="image-20210729212554797"></p>
<p>连接成功</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729212617525.png" alt="image-20210729212617525"></p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a><strong>创建数据库</strong></h3><p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210729213059778.png" alt="image-20210729213059778"></p>
<p>Linux查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#从主机中进行查看</span></span><br><span class="line">[root@192 home]<span class="comment"># cd /home</span></span><br><span class="line">[root@192 home]<span class="comment"># ls</span></span><br><span class="line">eternal  mysql  springboot  www</span><br><span class="line">[root@192 home]<span class="comment"># cd mysql</span></span><br><span class="line">[root@192 mysql]<span class="comment"># ls</span></span><br><span class="line">conf  data</span><br><span class="line">[root@192 mysql]<span class="comment"># cd data</span></span><br><span class="line"><span class="comment">#查看数据库</span></span><br><span class="line">[root@192 data]<span class="comment"># ls</span></span><br><span class="line">auto.cnf       client-cert.pem    ib_logfile0   performance_schema  undo_001</span><br><span class="line">binlog.000001  client-key.pem     ib_logfile1   private_key.pem     undo_002</span><br><span class="line">binlog.000002  <span class="comment">#ib_16384_0.dblwr  ibtmp1        public_key.pem</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#发现多了一个数据库 vmlinux</span></span><br><span class="line">[root@192 data]<span class="comment"># ls</span></span><br><span class="line">auto.cnf       client-cert.pem    ib_logfile0   performance_schema  undo_001</span><br><span class="line">binlog.000001  client-key.pem     ib_logfile1   private_key.pem     undo_002</span><br><span class="line">binlog.000002  <span class="comment">#ib_16384_0.dblwr  ibtmp1        public_key.pem      vmlinux</span></span><br></pre></td></tr></table></figure>
<h3 id="mysql容器删除"><a href="#mysql容器删除" class="headerlink" title="mysql容器删除"></a><strong>mysql容器删除</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># docker rm -f 88e95814f3c0 </span></span><br><span class="line">88e95814f3c0</span><br><span class="line"><span class="comment"># 发现数据库连接不上</span></span><br><span class="line"><span class="comment"># 进入主机目录，发现数据仍存在</span></span><br><span class="line">[root@192 home]<span class="comment"># ls</span></span><br><span class="line">eternal  mysql  springboot  www</span><br><span class="line">[root@192 home]<span class="comment"># cd mysql</span></span><br><span class="line">[root@192 mysql]<span class="comment"># ls</span></span><br><span class="line">conf  data</span><br><span class="line">[root@192 mysql]<span class="comment"># cd data</span></span><br><span class="line">[root@192 data]<span class="comment"># ls</span></span><br><span class="line">auto.cnf       ca.pem             ib_buffer_pool  <span class="comment">#innodb_temp        public_key.pem   undo_002</span></span><br><span class="line">binlog.000001  client-cert.pem    ibdata1         mysql               server-cert.pem  vmlinux</span><br><span class="line">binlog.000002  client-key.pem     ib_logfile0     mysql.ibd           server-key.pem</span><br><span class="line">binlog.index   <span class="comment">#ib_16384_0.dblwr  ib_logfile1     performance_schema  sys</span></span><br><span class="line">ca-key.pem     <span class="comment">#ib_16384_1.dblwr  ibtmp1          private_key.pem     undo_001</span></span><br></pre></td></tr></table></figure>
<p><strong>我们挂载到本地的数据卷依旧没有丢失,这就实现了容器数据持久化功能</strong></p>
<h2 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h2><p><strong>匿名挂载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内路径!</span><br><span class="line">docker -run -P -name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@192 eternal]<span class="comment"># docker run -d -P --name nginx01 -v /etc/nginx nginx</span></span><br><span class="line">d5193df71df3d0d44df820c7c32518bb7b40b59cae71dbf80230400dacb73740</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看所有的卷的情况</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     0d1fb64140bf04c25a894ccbae1c5b107bcdf2412e6d05143dbd89ded9738971</span><br><span class="line"><span class="built_in">local</span>     5efd0830872be316307c99067b8a246d733749850143a7dfc33c9ce8dec250bc</span><br><span class="line"><span class="built_in">local</span>     282269a3df525ed1056db51ab7042953057c96001180d44e746b2827f659e9a5</span><br><span class="line"><span class="built_in">local</span>     cb48bd0e6536c970fd23a2d7b47687e86b8a0a091a968502df7efb7b6c593a38</span><br><span class="line"><span class="comment">#这里发现,这种就是匿名挂载, 我们在 -v只写了容器内的路径,没有写容器外的路径</span></span><br></pre></td></tr></table></figure>
<p><strong>具名挂载</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过 -v 卷名:容器内路径</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span></span><br><span class="line">4aed18489886ddeb5be37bb73784caf8d10191220dac8dc850991eba8a106b7d</span><br><span class="line"><span class="comment">#查看挂载，juming-nginx</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     juming-nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看一下这个卷</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker volume inspect juming-nginx</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"CreatedAt"</span>: <span class="string">"2021-07-30T08:56:12+08:00"</span>,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="string">"Labels"</span>: null,</span><br><span class="line">        <span class="string">"Mountpoint"</span>: <span class="string">"/var/lib/docker/volumes/juming-nginx/_data"</span>,</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"juming-nginx"</span>,</span><br><span class="line">        <span class="string">"Options"</span>: null,</span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看该卷的配置文件</span></span><br><span class="line">[root@192 eternal]<span class="comment"># cd /var/lib/docker</span></span><br><span class="line">[root@192 docker]<span class="comment"># ls</span></span><br><span class="line">buildkit    image    overlay2  runtimes  tmp    volumes</span><br><span class="line">containers  network  plugins   swarm     trust</span><br><span class="line">[root@192 docker]<span class="comment"># cd volumes</span></span><br><span class="line">[root@192 volumes]<span class="comment"># ls</span></span><br><span class="line">0d1fb64140bf04c25a894ccbae1c5b107bcdf2412e6d05143dbd89ded9738971</span><br><span class="line">282269a3df525ed1056db51ab7042953057c96001180d44e746b2827f659e9a5</span><br><span class="line">5efd0830872be316307c99067b8a246d733749850143a7dfc33c9ce8dec250bc</span><br><span class="line">backingFsBlockDev</span><br><span class="line">cb48bd0e6536c970fd23a2d7b47687e86b8a0a091a968502df7efb7b6c593a38</span><br><span class="line">juming-nginx</span><br><span class="line">metadata.db</span><br><span class="line"><span class="comment">#进入juming-nginx卷内</span></span><br><span class="line">[root@192 volumes]<span class="comment"># cd juming-nginx</span></span><br><span class="line">[root@192 juming-nginx]<span class="comment"># ls</span></span><br><span class="line">_data</span><br><span class="line">[root@192 juming-nginx]<span class="comment"># cd _data</span></span><br><span class="line">[root@192 _data]<span class="comment"># ls</span></span><br><span class="line">conf.d          mime.types  nginx.conf   uwsgi_params</span><br><span class="line">fastcgi_params  modules     scgi_params</span><br><span class="line">[root@192 _data]<span class="comment"># cat nginx.conf</span></span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  auto;</span><br><span class="line">error_log  /var/<span class="built_in">log</span>/nginx/error.log notice;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line">    access_log  /var/<span class="built_in">log</span>/nginx/access.log  main;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有的docker容器内的卷,没有指定目录的情况下都是在/var/lib/docker/volumes/卷名/_data</p>
<p>我们通过具名挂载可以方便的找到一个卷,大多数情况在使用的’具名挂载’</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如何确定是具名挂载还是匿名挂载,还是指定路径挂载</span></span><br><span class="line">-v 容器内路径 <span class="comment">#匿名挂载</span></span><br><span class="line">-v 卷名:容器内路径 <span class="comment">#具名挂载</span></span><br><span class="line">-v 宿主机路径 : 容器内路径 <span class="comment">#指定路径挂载</span></span><br></pre></td></tr></table></figure>
<p><strong>扩展:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过 -v  容器内路径: ro rw 改变读写权限</span></span><br><span class="line">ro <span class="built_in">read</span> only</span><br><span class="line"><span class="built_in">read</span> and write</span><br><span class="line"></span><br><span class="line"><span class="comment">#一旦设置了容器权限,容器对挂载出来的内容就有限定了!</span></span><br><span class="line">docker -run -P -name nginx01 -v /etc/nginx:ro nginx</span><br><span class="line">docker -run -P -name nginx01 -v /etc/nginx:rw nginx</span><br><span class="line">ro : 只要看到ro就说明这个路径只能通过宿主机来改变,容器内部无法操作</span><br></pre></td></tr></table></figure>
<h1 id="7-Dockerfile"><a href="#7-Dockerfile" class="headerlink" title="7.Dockerfile"></a>7.Dockerfile</h1><p>大家想想，Nginx，tomcat，mysql 这些镜像都是哪里来的？官方能写，我们不能写吗？ </p>
<p>我们要研究自己如何做一个镜像，而且我们写的微服务项目以及springboot打包上云部署，Docker就是 最方便的。</p>
<p> 微服务打包成镜像，任何装了Docker的地方，都可以下载使用，极其的方便。</p>
<p> 流程：开发应用=&gt;DockerFile=&gt;打包为镜像=&gt;上传到仓库（私有仓库，公有仓库）=&gt; 下载镜像 =&gt; 启动 运行。 </p>
<p>还可以方便移植！</p>
<h2 id="初始DockerFile"><a href="#初始DockerFile" class="headerlink" title="初始DockerFile"></a>初始DockerFile</h2><p>Dockerfile就是用来构建Dockerfile镜像的文件! 命令脚本!</p>
<p>构建步骤：</p>
<ul>
<li>1、编写DockerFile文件</li>
<li>2、docker build 构建镜像 </li>
<li>3、docker run dockerfile文件我们刚才已经编写过了一次，这里我们继续使用 centos 来看！</li>
</ul>
<blockquote>
<p>方式二：构建Dockerfile镜像的文件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个dockerfile文件,名字可以随机 建议 dockerfile1</span></span><br><span class="line"><span class="comment"># 文件中的内容</span></span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [<span class="string">"volume01"</span>,<span class="string">"volume02"</span>]</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">"---end---"</span></span><br><span class="line">CMD /bin/<span class="built_in">hash</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行脚本</span></span><br><span class="line">[root@192 docker-test-volume]<span class="comment"># docker build -f /home/docker-test-volume/dockerfile1 -t zhuxiaopeng/centos:1.0 .</span></span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"> ---&gt; 300e315adb2f</span><br><span class="line">Step 2/4 : VOLUME [<span class="string">"volume01"</span>,<span class="string">"volume02"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> af4e9c6e304b</span><br><span class="line">Removing intermediate container af4e9c6e304b</span><br><span class="line"> ---&gt; 397719247d47</span><br><span class="line">Step 3/4 : CMD <span class="built_in">echo</span> <span class="string">"---end---"</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> df328b5b0425</span><br><span class="line">Removing intermediate container df328b5b0425</span><br><span class="line"> ---&gt; 56b3af086372</span><br><span class="line">Step 4/4 : CMD /bin/<span class="built_in">hash</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> effe5e4a78c1</span><br><span class="line">Removing intermediate container effe5e4a78c1</span><br><span class="line"> ---&gt; 90dbaef5253a</span><br><span class="line">Successfully built 90dbaef5253a</span><br><span class="line">Successfully tagged zhuxiaopeng/centos:1.0</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看镜像文件（发现刚刚创建的 zhuxiaopeng/centos ）</span></span><br><span class="line">[root@192 docker-test-volume]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">zhuxiaopeng/centos    1.0       90dbaef5253a   About a minute ago   209MB</span><br><span class="line">tomcat02              2.1       e06f510955ba   23 hours ago         670MB</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入自己写的镜像文件</span></span><br><span class="line">[root@192 docker-test-volume]<span class="comment"># docker run -it 90dbaef5253a /bin/bash</span></span><br><span class="line"></span><br><span class="line">[root@5ccdbc015f9f /]<span class="comment"># ls -l</span></span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root 360 Jul 30 01:50 dev</span><br><span class="line">drwxr-xr-x   1 root root  66 Jul 30 01:50 etc</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root   6 Dec  4  2020 lost+found</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x 290 root root   0 Jul 30 01:50 proc</span><br><span class="line">dr-xr-x---   2 root root 162 Dec  4  2020 root</span><br><span class="line">drwxr-xr-x  11 root root 163 Dec  4  2020 run</span><br><span class="line">lrwxrwxrwx   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x  13 root root   0 Jul 30 01:50 sys</span><br><span class="line">drwxrwxrwt   7 root root 145 Dec  4  2020 tmp</span><br><span class="line">drwxr-xr-x  12 root root 144 Dec  4  2020 usr</span><br><span class="line">drwxr-xr-x  20 root root 262 Dec  4  2020 var</span><br><span class="line">drwxr-xr-x   2 root root   6 Jul 30 01:50 volume01</span><br><span class="line">drwxr-xr-x   2 root root   6 Jul 30 01:50 volume02</span><br><span class="line"></span><br><span class="line"><span class="comment">#这个目录就是我们生成镜像的时候自动挂载的，数据卷目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在该卷内生成一个文件，通过外部进行查看是否同步</span></span><br><span class="line">[root@5ccdbc015f9f /]<span class="comment"># cd volume01</span></span><br><span class="line">[root@5ccdbc015f9f volume01]<span class="comment"># touch container.txt</span></span><br><span class="line">[root@5ccdbc015f9f volume01]<span class="comment"># ls</span></span><br><span class="line">container.txt</span><br></pre></td></tr></table></figure>
<p>这个卷和外部一定有一个同步的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看一下挂载路径</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker inspect 5ccdbc015f9f</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210730100010759.png" alt="image-20210730100010759"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># cd /var/lib/docker/volumes/9bfcf16d10087bbe08dc573d135a2e75cad232b9816813bbf00bb2258cdb115f/_data</span></span><br><span class="line">[root@192 _data]<span class="comment"># ls</span></span><br><span class="line">container.txt</span><br></pre></td></tr></table></figure>
<p>测试一下刚才的文件是否同步出去了</p>
<p>这种方式我们未来使用的十分多,因为我们通常会构建自己的镜像!</p>
<p>假设构建镜像时没有挂载卷,要手动镜像挂载 -v 卷名: 容器内路径</p>
<h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a><strong>数据卷容器</strong></h2><p>两个Mysql同步数据!</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210730184222649.png" alt="image-20210730184222649"></p>
<p><strong>容器1</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建一个容器</span></span><br><span class="line">docker run -it --name docker01 90dbaef5253a /bin/bash</span><br><span class="line"><span class="comment">#进入docker01容器</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker exec -it docker01 /bin/bash</span></span><br><span class="line">[root@7ae0bf32a9e6 /]<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01	volume02</span><br><span class="line"><span class="comment">#进入到volume01内创建一个文件夹docker01</span></span><br><span class="line">[root@7ae0bf32a9e6 /]<span class="comment"># cd volume01</span></span><br><span class="line">[root@7ae0bf32a9e6 volume01]<span class="comment"># ls</span></span><br><span class="line">[root@7ae0bf32a9e6 volume01]<span class="comment"># mkdir docker01</span></span><br><span class="line">[root@7ae0bf32a9e6 volume01]<span class="comment"># ls</span></span><br><span class="line">docker01</span><br></pre></td></tr></table></figure>
<p><strong>容器2（<code>--volumes-from</code>）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#新建一个容器docker02并与docker01进行挂载</span></span><br><span class="line">docker run -it --name docker02 --volumes-from docker01 90dbaef5253a /bin/bash</span><br><span class="line"><span class="comment">#进入docker02容器</span></span><br><span class="line">root@192 home]<span class="comment"># docker exec -it docker02 /bin/bash</span></span><br><span class="line">[root@d0e42082c423 /]<span class="comment"># ls</span></span><br><span class="line">bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var	   volume02</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</span><br><span class="line"><span class="comment">#进入volume01内进行查看</span></span><br><span class="line">[root@d0e42082c423 /]<span class="comment"># cd volume01</span></span><br><span class="line">[root@d0e42082c423 volume01]<span class="comment"># ls</span></span><br><span class="line">docker01</span><br></pre></td></tr></table></figure>
<p><strong>容器3（<code>--volumes-from</code>）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#再新建一个容器docker03与docker01进行挂载</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker run -it --name docker03 --volumes-from docker01 90dbaef5253a /bin/bash</span></span><br><span class="line">[root@1a04b5e427d3 /]<span class="comment"># cd volume01</span></span><br><span class="line">[root@1a04b5e427d3 volume01]<span class="comment"># ls</span></span><br><span class="line">docker01</span><br><span class="line"></span><br><span class="line"><span class="comment">#在docker03容器里创建一个文件夹，从容器1里面进行查看</span></span><br><span class="line">[root@1a04b5e427d3 volume01]<span class="comment"># mkdir docker03</span></span><br><span class="line"><span class="comment">#去容器docker01内进行查看</span></span><br><span class="line">[root@d0e42082c423 volume01]<span class="comment"># docker exec -it docker01 /bin/bash</span></span><br><span class="line">bash: docker: <span class="built_in">command</span> not found</span><br><span class="line">[root@d0e42082c423 volume01]<span class="comment"># read escape sequence</span></span><br><span class="line">[root@192 home]<span class="comment"># docker exec -it docker01 /bin/bash</span></span><br><span class="line">[root@7ae0bf32a9e6 /]<span class="comment"># cd volume01</span></span><br><span class="line">[root@7ae0bf32a9e6 volume01]<span class="comment"># ls</span></span><br><span class="line">docker01  docker03</span><br><span class="line"></span><br><span class="line"><span class="comment">#发现文件成功同步过来</span></span><br></pre></td></tr></table></figure>
<p><strong>删除一个容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除docker01</span></span><br><span class="line">[root@192 home]<span class="comment"># docker rm -f docker01</span></span><br><span class="line">docker01</span><br><span class="line"></span><br><span class="line"><span class="comment">#在docker03下查看</span></span><br><span class="line">[root@1a04b5e427d3 volume01]<span class="comment"># ls</span></span><br><span class="line">docker01  docker03</span><br><span class="line"></span><br><span class="line"><span class="comment">#docker01文件夹依旧存在</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210730204107880.png" alt="image-20210730204107880"></p>
<p><strong>结论:</strong></p>
<p>容器之间配置信息的传递,数据卷容器的生命周期一直持续到没有人使用为止</p>
<p>但是一旦你持久化到了本地,这个时候,本地的数据是不会删除的</p>
<p><strong>多个mysql实现数据共享</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#数据库1</span></span><br><span class="line">docker run  -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root --name mysql01 mysql:8.0</span><br><span class="line"><span class="comment">#数据库2（将1挂载到2上）</span></span><br><span class="line">docker run -d -p 3311:3306 -e MYSQL_ROOT_PASSWORD=root --name mysql02 --volumes-from mysql01 mysql:8.0</span><br><span class="line"><span class="comment">#两个数据库之间可以实现数据同步</span></span><br></pre></td></tr></table></figure>
<h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><p>DockerFile是用来构建docker镜像的文件!命令参数脚本!</p>
<p>构建步骤:</p>
<ol>
<li>编写一个dockerfile脚本</li>
<li>docker build 构建成为一个镜像</li>
<li>docker run 运行镜像</li>
<li>docker push发布镜像(Docker hub , 阿里云镜像仓库! )</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210730205523610.png" alt="image-20210730205523610"></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210730205549711.png" alt="image-20210730205549711"></p>
<p>很多官方镜像都是基础包, 很多功能没有,我们通常会自己搭建自己的镜像!</p>
<p>官方可以制作镜像,那么我们也可以!</p>
<h2 id="Dockerfile构建过程"><a href="#Dockerfile构建过程" class="headerlink" title="Dockerfile构建过程"></a>Dockerfile构建过程</h2><p>指令:</p>
<ol>
<li>每个保留关键字(指令)都是必须要大写</li>
<li>执行从上到下顺序执行</li>
<li>‘#’ 表示注释</li>
<li>每一个指令都会创建提交一个新的镜像层,并提交 !</li>
</ol>
<p>流程： </p>
<p>1、docker从基础镜像运行一个容器 </p>
<p>2、执行一条指令并对容器做出修改 </p>
<p>3、执行类似 docker commit 的操作提交一个新的镜像层 </p>
<p>4、Docker再基于刚提交的镜像运行一个新容器 </p>
<p>5、执行dockerfile中的下一条指令直到所有指令都执行完成！</p>
<p>说明： </p>
<p>从应用软件的角度来看，DockerFile，docker镜像与docker容器分别代表软件的三个不同阶段。</p>
<ul>
<li>DockerFile 是软件的原材料 （代码） </li>
<li>Docker 镜像则是软件的交付品 （.apk） </li>
<li>Docker 容器则是软件的运行状态 （客户下载安装执行） </li>
</ul>
<p>DockerFile 面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210730210304730.png" alt="image-20210730210304730"></p>
<ul>
<li><p><strong>DockerFile：</strong>需要定义一个DockerFile，DockerFile定义了进程需要的一切东西。DockerFile涉及的内容 包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进 程和内核进程（当引用进行需要和系统服务和内核进程打交道，这时需要考虑如何设计 namespace的权 限控制）等等。 </p>
</li>
<li><p><strong>Docker镜像：</strong>在DockerFile 定义了一个文件之后，Docker build 时会产生一个Docker镜像，当运行 Docker 镜像时，会真正开始提供服务； </p>
</li>
<li><strong>Docker容器：</strong>容器是直接提供服务的。</li>
</ul>
<h2 id="DockerFile指令"><a href="#DockerFile指令" class="headerlink" title="DockerFile指令"></a>DockerFile指令</h2><p>关键字：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM <span class="comment"># 基础镜像，当前新镜像是基于哪个镜像的</span></span><br><span class="line">MAINTAINER <span class="comment"># 镜像维护者的姓名混合邮箱地址</span></span><br><span class="line">RUN <span class="comment"># 容器构建时需要运行的命令</span></span><br><span class="line">EXPOSE <span class="comment"># 当前容器对外保留出的端口</span></span><br><span class="line">WORKDIR <span class="comment"># 指定在创建容器后，终端默认登录的进来工作目录，一个落脚点</span></span><br><span class="line">ENV <span class="comment"># 用来在构建镜像过程中设置环境变量</span></span><br><span class="line">ADD <span class="comment"># 将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包</span></span><br><span class="line">COPY <span class="comment"># 类似ADD，拷贝文件和目录到镜像中！</span></span><br><span class="line">VOLUME <span class="comment"># 容器数据卷，用于数据保存和持久化工作</span></span><br><span class="line">CMD <span class="comment"># 指定一个容器启动时要运行的命令，dockerFile中可以有多个CMD指令，但只有最</span></span><br><span class="line">后一个生效！</span><br><span class="line">ENTRYPOINT <span class="comment"># 指定一个容器启动时要运行的命令！和CMD一样</span></span><br><span class="line">ONBUILD <span class="comment"># 当构建一个被继承的DockerFile时运行命令，父镜像在被子镜像继承后，父镜像的ONBUILD被触发</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210730210754975.png" alt="image-20210730210754975"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM 	<span class="comment"># 基础镜像, 一切从这里开始构建</span></span><br><span class="line">MANTAINER <span class="comment"># 镜像是谁写的, 姓名+邮箱</span></span><br><span class="line">RUN <span class="comment">#镜像构建的时候需要运行的命令</span></span><br><span class="line">ADD <span class="comment"># 步骤, tomcat镜像,压缩包! 添加内容</span></span><br><span class="line">WORKDIR <span class="comment"># 镜像的工作目录</span></span><br><span class="line">VOLUME <span class="comment"># 挂载的目录</span></span><br><span class="line">EXPOSE <span class="comment"># 暴露端口配置</span></span><br><span class="line">RUN <span class="comment">#运行</span></span><br><span class="line">CMD <span class="comment"># 指定这个容器启动的时候要运行的命令,只有最后一个会生效,可被替代</span></span><br><span class="line">ENTRYPOINT <span class="comment"># 指定这个容器启动的时候要运行的命令,可以追加命令</span></span><br><span class="line">ONBUILD <span class="comment"># 当构建一个被继承 DockerFile 这个时候就会运行ONBUILD的指令,触发指令</span></span><br><span class="line">COPY	<span class="comment">#	类似ADD,将我们文件拷贝到镜像中</span></span><br><span class="line">ENV 	<span class="comment"># 构建的时候设置环境变量!</span></span><br></pre></td></tr></table></figure>
<h2 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h2><p>Docker Hub 中99%镜像都是从centos基础镜像过来的,然后配置需要的软件</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210730214113564.png" alt="image-20210730214113564"></p>
<h3 id="DIY-centos"><a href="#DIY-centos" class="headerlink" title="DIY centos"></a>DIY centos</h3><blockquote>
<p>创建一个自己的centos</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编写DockerFile文件</span></span><br><span class="line">[root@192 eternal]<span class="comment"># cd /home</span></span><br><span class="line">[root@192 home]<span class="comment"># ls</span></span><br><span class="line">docker-test-volume  eternal  mysql  springboot  www</span><br><span class="line">[root@192 home]<span class="comment"># mkdir dockerFile</span></span><br><span class="line">[root@192 home]<span class="comment"># cd dockerFile</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># ls</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># vim mydockerfile</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># cat mydockerfile</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER zxp-1728456478@qq.com</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/<span class="built_in">local</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">"----end----"</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#运行dockerfile文件</span></span><br><span class="line"><span class="comment"># 命令 docker build -f dockerfile文件路径 -t</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker build -f mydockerfile -t mycentos:0.1 .</span></span><br><span class="line">Successfully built abc6c8eefcc4</span><br><span class="line">Successfully tagged mycentos:0.1</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试运行</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run -it mycentos:0.1</span></span><br><span class="line">[root@ee05a8ea74dc <span class="built_in">local</span>]<span class="comment"># pwd			#进入工作目录（我们自己编写的）</span></span><br><span class="line">/usr/<span class="built_in">local</span></span><br><span class="line">[root@ee05a8ea74dc <span class="built_in">local</span>]<span class="comment"># ifconfig		#命令可以使用了（官方下载的centos里面不可以使用）</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 8  bytes 656 (656.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>
<h3 id="进程创建过程"><a href="#进程创建过程" class="headerlink" title="进程创建过程"></a>进程创建过程</h3><p><strong>可以列出本地进程的历史</strong>（我们平时拿到一个镜像,可以研究一下它是怎么做的）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看mycentos构建的过程</span></span><br><span class="line">[root@ee05a8ea74dc <span class="built_in">local</span>]<span class="comment"># [root@192 dockerFile]# docker history mycentos:0.1</span></span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">abc6c8eefcc4   5 minutes ago   /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/sh" "-c" "/bin…   0B        </span></span><br><span class="line">5d18f0c78c0d   5 minutes ago   /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/sh" "-c" "echo…   0B        </span></span><br><span class="line">a0aec60dea3e   5 minutes ago   /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/sh" "-c" "echo…   0B        </span></span><br><span class="line">da506ef06e4b   5 minutes ago   /bin/sh -c <span class="comment">#(nop)  EXPOSE 80                    0B        </span></span><br><span class="line">dd1886860ac4   5 minutes ago   /bin/sh -c yum -y install net-tools             27.8MB    </span><br><span class="line">e43edcfea773   6 minutes ago   /bin/sh -c yum -y install vim                   65.2MB    </span><br><span class="line">259b32ba10ee   6 minutes ago   /bin/sh -c <span class="comment">#(nop) WORKDIR /usr/local            0B        </span></span><br><span class="line">809bc8b60181   6 minutes ago   /bin/sh -c <span class="comment">#(nop)  ENV MYPATH=/usr/local        0B        </span></span><br><span class="line">b8b304c7e510   6 minutes ago   /bin/sh -c <span class="comment">#(nop)  MAINTAINER zxp-1728456478…   0B        </span></span><br><span class="line">300e315adb2f   7 months ago    /bin/sh -c <span class="comment">#(nop)  CMD ["/bin/bash"]            0B        </span></span><br><span class="line">&lt;missing&gt;      7 months ago    /bin/sh -c <span class="comment">#(nop)  LABEL org.label-schema.sc…   0B        </span></span><br><span class="line">&lt;missing&gt;      7 months ago    /bin/sh -c <span class="comment">#(nop) ADD file:bd7a2aed6ede423b7…   209MB     </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看mysql构建的过程</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker history mysql:8.0</span></span><br><span class="line">IMAGE          CREATED      CREATED BY                                      SIZE      COMMENT</span><br><span class="line">c60d96bd2b77   8 days ago   /bin/sh -c <span class="comment">#(nop)  CMD ["mysqld"]               0B        </span></span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c <span class="comment">#(nop)  EXPOSE 3306 33060            0B        </span></span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c <span class="comment">#(nop)  ENTRYPOINT ["docker-entry…   0B        </span></span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c ln -s usr/<span class="built_in">local</span>/bin/docker-entryp…   34B       </span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c <span class="comment">#(nop) COPY file:345a22fe55d3e678…   14.5kB    </span></span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c <span class="comment">#(nop) COPY dir:2e040acc386ebd23b…   1.12kB    </span></span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c <span class="comment">#(nop)  VOLUME [/var/lib/mysql]      0B        </span></span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c &#123;   <span class="built_in">echo</span> mysql-community-server m…   378MB     </span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c <span class="built_in">echo</span> <span class="string">'deb http://repo.mysql.com/a…   55B       </span></span><br><span class="line"><span class="string">&lt;missing&gt;      8 days ago   /bin/sh -c #(nop)  ENV MYSQL_VERSION=8.0.26-…   0B        </span></span><br><span class="line"><span class="string">&lt;missing&gt;      8 days ago   /bin/sh -c #(nop)  ENV MYSQL_MAJOR=8.0          0B        </span></span><br><span class="line"><span class="string">&lt;missing&gt;      8 days ago   /bin/sh -c set -ex;  key='</span>A4A9406876FCBD3C45…   1.84kB    </span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c apt-get update &amp;&amp; apt-get install…   52.2MB    </span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c mkdir /docker-entrypoint-initdb.d    0B        </span><br><span class="line">&lt;missing&gt;      8 days ago   /bin/sh -c <span class="built_in">set</span> -eux;  savedAptMark=<span class="string">"<span class="variable">$(apt-ma…   4.17MB    </span></span></span><br><span class="line"><span class="string"><span class="variable">&lt;missing&gt;      8 days ago   /bin/sh -c #(nop)</span>  ENV GOSU_VERSION=1.12        0B        </span></span><br><span class="line"><span class="string">&lt;missing&gt;      8 days ago   /bin/sh -c apt-get update &amp;&amp; apt-get install…   9.34MB    </span></span><br><span class="line"><span class="string">&lt;missing&gt;      8 days ago   /bin/sh -c groupadd -r mysql &amp;&amp; useradd -r -…   329kB     </span></span><br><span class="line"><span class="string">&lt;missing&gt;      8 days ago   /bin/sh -c #(nop)  CMD ["</span>bash<span class="string">"]                 0B        </span></span><br><span class="line"><span class="string">&lt;missing&gt;      8 days ago   /bin/sh -c #(nop) ADD file:45f5dfa135c848a34…   69.3MB    </span></span><br><span class="line"><span class="string">[root@192 dockerFile]#</span></span><br></pre></td></tr></table></figure>
<h3 id="CMD-和ENTRYPOINT"><a href="#CMD-和ENTRYPOINT" class="headerlink" title="CMD 和ENTRYPOINT"></a>CMD 和ENTRYPOINT</h3><blockquote>
<p>CMD 和ENTRYPOINT 的区别</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD <span class="comment"># 指定这个容器启动的时候要运行的命令,只有最后一个会生效,可被替代</span></span><br><span class="line">ENTRYPOINT <span class="comment"># 指定这个容器启动的时候要运行的命令,可以追加命令</span></span><br></pre></td></tr></table></figure>
<p>测试cmd命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编写</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># cat dockerfile-cmd-test</span></span><br><span class="line">FROM centos</span><br><span class="line">CMD [<span class="string">"ls"</span>,<span class="string">"-a"</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建镜像</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># vim dockerfile-cmd-test</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker build -f dockerfile-cmd-test -t cdmtest .</span></span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"> ---&gt; 300e315adb2f</span><br><span class="line">Step 2/2 : CMD [<span class="string">"ls"</span>,<span class="string">"-a"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 96180005c50b</span><br><span class="line">Removing intermediate container 96180005c50b</span><br><span class="line"> ---&gt; 43dafe2ff8d4</span><br><span class="line">Successfully built 43dafe2ff8d4</span><br><span class="line">Successfully tagged cdmtest:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># run 运行</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run 43dafe2ff8d4</span></span><br><span class="line"></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行ls命令正常</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run 43dafe2ff8d4 ls</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行 -l 命令失败</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run 43dafe2ff8d4 -l</span></span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: <span class="built_in">exec</span>: <span class="string">"-l"</span>: executable file not found <span class="keyword">in</span> <span class="variable">$PATH</span>: unknown.</span><br><span class="line"></span><br><span class="line"><span class="comment">#追加命令   追加一个命令 -l  </span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run 43dafe2ff8d4 ls -l</span></span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root 340 Jul 31 01:21 dev</span><br><span class="line">drwxr-xr-x   1 root root  66 Jul 31 01:21 etc</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root   6 Dec  4  2020 lost+found</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x 285 root root   0 Jul 31 01:21 proc</span><br><span class="line">dr-xr-x---   2 root root 162 Dec  4  2020 root</span><br><span class="line">drwxr-xr-x  11 root root 163 Dec  4  2020 run</span><br><span class="line">lrwxrwxrwx   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x  13 root root   0 Jul 30 01:51 sys</span><br><span class="line">drwxrwxrwt   7 root root 145 Dec  4  2020 tmp</span><br><span class="line">drwxr-xr-x  12 root root 144 Dec  4  2020 usr</span><br><span class="line">drwxr-xr-x  20 root root 262 Dec  4  2020 var</span><br><span class="line">[root@192 dockerFile]<span class="comment"># </span></span><br><span class="line"><span class="comment"># cmd的情况下 替换了CMD["ls","-a"]命令,-不是命令追加</span></span><br><span class="line"></span><br><span class="line">ENTRYPOINT是往命令之后追加</span><br></pre></td></tr></table></figure>
<p>测试ENTRYPOINT</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># vim dockerfile-entrypoint-test </span></span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [<span class="string">"ls"</span>,<span class="string">"-a"</span>]</span><br><span class="line"></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker build -f dockerfile-entrypoint-test -t entrypoint-test .</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#直接运行 -l命令</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run df3e6903aebf -l</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   1 root root   6 Jul 31 01:30 .</span><br><span class="line">drwxr-xr-x   1 root root   6 Jul 31 01:30 ..</span><br><span class="line">-rwxr-xr-x   1 root root   0 Jul 31 01:30 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root 340 Jul 31 01:30 dev</span><br><span class="line">drwxr-xr-x   1 root root  66 Jul 31 01:30 etc</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root   6 Dec  4  2020 lost+found</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x 284 root root   0 Jul 31 01:30 proc</span><br><span class="line">dr-xr-x---   2 root root 162 Dec  4  2020 root</span><br><span class="line">drwxr-xr-x  11 root root 163 Dec  4  2020 run</span><br><span class="line">lrwxrwxrwx   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x  13 root root   0 Jul 30 01:51 sys</span><br><span class="line">drwxrwxrwt   7 root root 145 Dec  4  2020 tmp</span><br><span class="line">drwxr-xr-x  12 root root 144 Dec  4  2020 usr</span><br><span class="line">drwxr-xr-x  20 root root 262 Dec  4  2020 var</span><br><span class="line"></span><br><span class="line">这个是直接追加的，不是替换</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat镜像"><a href="#Tomcat镜像" class="headerlink" title="Tomcat镜像"></a>Tomcat镜像</h3><ul>
<li>准备镜像文件. tomcat压缩包, jdk压缩包!</li>
<li>去官网下载，复制到指定目录下</li>
<li>编写Dockerfile文件, 官方命名 Dockerfile, build会自动寻找这个文件,就不需要 -f 指定了!</li>
</ul>
<blockquote>
<p>编写Dockerfile文件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># vim dockerfile-tomcat-test</span></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">MAINTAINER zxp&lt;1728456478@qq.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/<span class="built_in">local</span>/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u301-linux-x64.tar.gz /usr/<span class="built_in">local</span></span><br><span class="line">ADD apache-tomcat-8.0.50.tar.gz /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/<span class="built_in">local</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/<span class="built_in">local</span>/jdk1.8.0_301</span><br><span class="line">ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/<span class="built_in">local</span>/apache-tomcat-9.0.50</span><br><span class="line">ENV CATALINA_BASH /usr/<span class="built_in">local</span>/apache-tomcat-9.0.50</span><br><span class="line">ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/<span class="built_in">local</span>/apache-tomcat-9.0.50/bin/startup.sh &amp;&amp; tail -F /url/<span class="built_in">local</span>/apache-tomcat-9.0.50/bin/logs/cataline.out</span><br><span class="line"></span><br><span class="line"><span class="comment">#所需要的jdk和tomcat放在了dockerFile目录下（可放在除根目录以外的文件夹）</span></span><br></pre></td></tr></table></figure>
<p>出现的问题：</p>
<p>采用 ADD 将主机的文件拷贝到要构建的docker镜像的时候，报错：</p>
<p><code>file not found in build context or excluded by .dockerignore</code></p>
<p><strong>原因</strong><br>dockerfile 不能获取 父目录</p>
<p><strong>方案：</strong></p>
<ul>
<li>将dockerfile放到父目录</li>
<li>将文件copy到当前目录</li>
</ul>
<blockquote>
<p>构建镜像</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># docker build -f dockerfile-tomcat-test -t diytomcat .</span></span><br><span class="line">Sending build context to Docker daemon    157MB</span><br><span class="line">Step 1/15 : FROM centos</span><br><span class="line"> ---&gt; 300e315adb2f</span><br><span class="line">Step 2/15 : MAINTAINER zxp&lt;1728456478@qq.com&gt;</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; cd9f84267fa5</span><br><span class="line">Step 3/15 : COPY readme.txt /usr/<span class="built_in">local</span>/readme.txt</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 259e2e8766c1</span><br><span class="line">Step 4/15 : ADD jdk-8u301-linux-x64.tar.gz /usr/<span class="built_in">local</span></span><br><span class="line"> ---&gt; 18d8353bea3a</span><br><span class="line">Step 5/15 : ADD apache-tomcat-9.0.50.tar.gz /usr/<span class="built_in">local</span>/</span><br><span class="line"> ---&gt; 93660fe5065f</span><br><span class="line">Step 6/15 : RUN yum -y install vim</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 349ca61292c5</span><br><span class="line">CentOS Linux 8 - AppStream                      2.5 MB/s | 8.3 MB     00:03    </span><br><span class="line">CentOS Linux 8 - BaseOS                         2.8 MB/s | 4.5 MB     00:01    </span><br><span class="line">CentOS Linux 8 - Extras                          16 kB/s | 9.8 kB     00:00    </span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package             Arch        Version                   Repository      Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced        x86_64      2:8.0.1763-15.el8         appstream      1.4 M</span><br><span class="line">Installing dependencies:</span><br><span class="line"> gpm-libs            x86_64      1.20.7-17.el8             appstream       39 k</span><br><span class="line"> vim-common          x86_64      2:8.0.1763-15.el8         appstream      6.3 M</span><br><span class="line"> vim-filesystem      noarch      2:8.0.1763-15.el8         appstream       48 k</span><br><span class="line"> <span class="built_in">which</span>               x86_64      2.21-12.el8               baseos          49 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  5 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 7.8 M</span><br><span class="line">Installed size: 30 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/5): gpm-libs-1.20.7-17.el8.x86_64.rpm        346 kB/s |  39 kB     00:00    </span><br><span class="line">(2/5): vim-filesystem-8.0.1763-15.el8.noarch.rp 573 kB/s |  48 kB     00:00    </span><br><span class="line">(3/5): <span class="built_in">which</span>-2.21-12.el8.x86_64.rpm             130 kB/s |  49 kB     00:00    </span><br><span class="line">(4/5): vim-enhanced-8.0.1763-15.el8.x86_64.rpm  1.3 MB/s | 1.4 MB     00:01    </span><br><span class="line">(5/5): vim-common-8.0.1763-15.el8.x86_64.rpm    5.0 MB/s | 6.3 MB     00:01    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           3.3 MB/s | 7.8 MB     00:02     </span><br><span class="line">warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-17.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY</span><br><span class="line">CentOS Linux 8 - AppStream                      1.6 MB/s | 1.6 kB     00:00    </span><br><span class="line">Importing GPG key 0x8483C65D:</span><br><span class="line"> Userid     : <span class="string">"CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;"</span></span><br><span class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">Key imported successfully</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : <span class="built_in">which</span>-2.21-12.el8.x86_64                               1/5 </span><br><span class="line">  Installing       : vim-filesystem-2:8.0.1763-15.el8.noarch                2/5 </span><br><span class="line">  Installing       : vim-common-2:8.0.1763-15.el8.x86_64                    3/5 </span><br><span class="line">  Installing       : gpm-libs-1.20.7-17.el8.x86_64                          4/5 </span><br><span class="line">  Running scriptlet: gpm-libs-1.20.7-17.el8.x86_64                          4/5 </span><br><span class="line">  Installing       : vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-common-2:8.0.1763-15.el8.x86_64                    5/5 </span><br><span class="line">  Verifying        : gpm-libs-1.20.7-17.el8.x86_64                          1/5 </span><br><span class="line">  Verifying        : vim-common-2:8.0.1763-15.el8.x86_64                    2/5 </span><br><span class="line">  Verifying        : vim-enhanced-2:8.0.1763-15.el8.x86_64                  3/5 </span><br><span class="line">  Verifying        : vim-filesystem-2:8.0.1763-15.el8.noarch                4/5 </span><br><span class="line">  Verifying        : <span class="built_in">which</span>-2.21-12.el8.x86_64                               5/5 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  gpm-libs-1.20.7-17.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64    </span><br><span class="line">  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch</span><br><span class="line">  <span class="built_in">which</span>-2.21-12.el8.x86_64             </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 349ca61292c5</span><br><span class="line"> ---&gt; 11151a33bf3d</span><br><span class="line">Step 7/15 : ENV MYPATH /usr/<span class="built_in">local</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> d483e3ffe1b4</span><br><span class="line">Removing intermediate container d483e3ffe1b4</span><br><span class="line"> ---&gt; 6788abe51c15</span><br><span class="line">Step 8/15 : WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 918669437fa1</span><br><span class="line">Removing intermediate container 918669437fa1</span><br><span class="line"> ---&gt; 0f8405234184</span><br><span class="line">Step 9/15 : ENV JAVA_HOME /usr/<span class="built_in">local</span>/jdk1.8.0_301</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 302e45a16a54</span><br><span class="line">Removing intermediate container 302e45a16a54</span><br><span class="line"> ---&gt; 756d0aef6c72</span><br><span class="line">Step 10/15 : ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 253b5c414fc2</span><br><span class="line">Removing intermediate container 253b5c414fc2</span><br><span class="line"> ---&gt; cb54e5e6d926</span><br><span class="line">Step 11/15 : ENV CATALINA_HOME /usr/<span class="built_in">local</span>/apache-tomcat-9.0.50</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> f6e969f01dd5</span><br><span class="line">Removing intermediate container f6e969f01dd5</span><br><span class="line"> ---&gt; 924c802ef19c</span><br><span class="line">Step 12/15 : ENV CATALINA_BASH /usr/<span class="built_in">local</span>/apache-tomcat-9.0.50</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> c145ba688632</span><br><span class="line">Removing intermediate container c145ba688632</span><br><span class="line"> ---&gt; 8e41fc1ad24f</span><br><span class="line">Step 13/15 : ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 60273206b7e2</span><br><span class="line">Removing intermediate container 60273206b7e2</span><br><span class="line"> ---&gt; 8ffff2b8dd86</span><br><span class="line">Step 14/15 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 13a397feb304</span><br><span class="line">Removing intermediate container 13a397feb304</span><br><span class="line"> ---&gt; c777225473f2</span><br><span class="line">Step 15/15 : CMD /usr/<span class="built_in">local</span>/apache-tomcat-9.0.50/bin/startup.sh &amp;&amp; tail -F /url/<span class="built_in">local</span>/apache-tomcat-9.0.50/bin/logs/cataline.out</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> e7ab98389a44</span><br><span class="line">Removing intermediate container e7ab98389a44</span><br><span class="line"> ---&gt; 12a14f98db54</span><br><span class="line">Successfully built 12a14f98db54</span><br><span class="line">Successfully tagged diytomcat:latest</span><br></pre></td></tr></table></figure>
<blockquote>
<p>运行镜像</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">diytomcat             latest    12a14f98db54   3 hours ago     652MB</span><br><span class="line"></span><br><span class="line"><span class="comment">#将webapps里面的test挂载到根目录下的tomcat中的test</span></span><br><span class="line"><span class="comment">#将日志挂在懂啊根目录下的tomcat中的tomcatlogs</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run -d -p 3344:8080 --name zxpTomcat -v /home/tomcat/test:/url/local/apache-tomcat-9.0.50/webapps/test -v /home/tomcat/tomcatlogs/:/url/local/apache-tomcat-9.0.50/logs diytomcat</span></span><br><span class="line">49ee702e46f19a5b2ab859d734e43fcda5c3347bd1f0619ac465e7212b9a032e</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入容器内</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it zxpTomcat /bin/bash</span></span><br><span class="line">[root@49ee702e46f1 <span class="built_in">local</span>]<span class="comment"># ls -l</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 1 root  root   42 Jul 31 02:58 apache-tomcat-9.0.50</span><br><span class="line">drwxr-xr-x 2 root  root    6 Nov  3  2020 bin</span><br><span class="line">drwxr-xr-x 2 root  root    6 Nov  3  2020 etc</span><br><span class="line">drwxr-xr-x 2 root  root    6 Nov  3  2020 games</span><br><span class="line">drwxr-xr-x 2 root  root    6 Nov  3  2020 include</span><br><span class="line">drwxr-xr-x 8 10143 10143 273 Jun  9 13:58 jdk1.8.0_301</span><br><span class="line">drwxr-xr-x 2 root  root    6 Nov  3  2020 lib</span><br><span class="line">drwxr-xr-x 3 root  root   17 Dec  4  2020 lib64</span><br><span class="line">drwxr-xr-x 2 root  root    6 Nov  3  2020 libexec</span><br><span class="line">-rw-r--r-- 1 root  root    0 Jul 31 02:47 readme.txt</span><br><span class="line">drwxr-xr-x 2 root  root    6 Nov  3  2020 sbin</span><br><span class="line">drwxr-xr-x 5 root  root   49 Dec  4  2020 share</span><br><span class="line">drwxr-xr-x 2 root  root    6 Nov  3  2020 src</span><br><span class="line"></span><br><span class="line"><span class="comment">#去挂载地址查看</span></span><br><span class="line">[root@192 tomcat]<span class="comment"># ls</span></span><br><span class="line"><span class="built_in">test</span>  tomcatlogs</span><br><span class="line"></span><br><span class="line"><span class="comment">#内外网都可以进行访问</span></span><br><span class="line">[root@192 tomcat]<span class="comment"># curl localhost:3344</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731141835957.png" alt="image-20210731141835957"></p>
<blockquote>
<p>发布项目</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#直接从主机上进行发布（所挂载的文件夹）</span></span><br><span class="line">root@192 tomcat]<span class="comment"># cd test</span></span><br><span class="line">[root@192 <span class="built_in">test</span>]<span class="comment"># ls</span></span><br><span class="line">[root@192 <span class="built_in">test</span>]<span class="comment"># vim hello.jsp		#（核心，项目文件）</span></span><br><span class="line">[root@192 <span class="built_in">test</span>]<span class="comment"># mkdir WEB-INF</span></span><br><span class="line">root@192 <span class="built_in">test</span>]<span class="comment"># cd WEB-INF</span></span><br><span class="line">[root@192 WEB-INF]<span class="comment"># vim web.xml</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jsp内容</span></span><br><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Docker镜像Tomcat容器项目发布&lt;/h1&gt;</span><br><span class="line">&lt;%</span><br><span class="line">System.out.println(<span class="string">"这是一个jsp文件"</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731160147889.png" alt="image-20210731160147889"></p>
<blockquote>
<p>查看日志</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tomcat]<span class="comment"># cd tomcatlogs</span></span><br><span class="line">[root@192 tomcatlogs]<span class="comment"># ls</span></span><br><span class="line">catalina.2021-07-31.log      localhost.2021-07-31.log</span><br><span class="line">catalina.out                 localhost_access_log.2021-07-31.txt</span><br><span class="line">host-manager.2021-07-31.log  manager.2021-07-31.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入日志文件查看</span></span><br><span class="line">31-Jul-2021 06:51:48.889 SEVERE [main] org.apache.catalina.core.StandardContext.startInternal Context [/<span class="built_in">test</span>] startup failed due to previous errors</span><br><span class="line">31-Jul-2021 06:51:48.897 INFO [main] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/<span class="built_in">local</span>/apache-tomcat-9.0.50/webapps/<span class="built_in">test</span>] has finished <span class="keyword">in</span> [39] ms</span><br><span class="line">31-Jul-2021 06:51:48.901 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler [<span class="string">"http-nio-8080"</span>]</span><br><span class="line">31-Jul-2021 06:51:48.917 INFO [main] org.apache.catalina.startup.Catalina.start Server startup <span class="keyword">in</span> [961] milliseconds</span><br><span class="line">31-Jul-2021 06:56:08.980 INFO [Catalina-utility-1] org.apache.catalina.startup.HostConfig.reload Reloading context [/<span class="built_in">test</span>]</span><br><span class="line">31-Jul-2021 06:56:18.998 INFO [Catalina-utility-1] org.apache.catalina.startup.HostConfig.reload Reloading context [/<span class="built_in">test</span>]</span><br><span class="line">31-Jul-2021 06:56:18.998 INFO [Catalina-utility-1] org.apache.catalina.core.StandardContext.reload Reloading Context with name [/<span class="built_in">test</span>] has started</span><br><span class="line">31-Jul-2021 06:56:19.014 INFO [Catalina-utility-1] org.apache.catalina.core.StandardContext.reload Reloading Context with name [/<span class="built_in">test</span>] is completed</span><br><span class="line">????jsp??</span><br><span class="line">~</span><br></pre></td></tr></table></figure>
<h3 id="发布自己的镜像"><a href="#发布自己的镜像" class="headerlink" title="发布自己的镜像"></a>发布自己的镜像</h3><h4 id="DockerHub"><a href="#DockerHub" class="headerlink" title="DockerHub"></a>DockerHub</h4><blockquote>
<p>提交到DcokerHub</p>
</blockquote>
<ol>
<li>地址hub.docker.com 注册自己的账号!</li>
<li>确定这个账号可以登录</li>
<li>在服务器上提交自己的镜像</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看如何登陆docker</span></span><br><span class="line">[root@192 tomcat]<span class="comment"># docker login --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log <span class="keyword">in</span> to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br></pre></td></tr></table></figure>
<p>4.登陆完成即可提交镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@192 tomcat]<span class="comment"># docker login -u eternal0918</span></span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/<span class="comment">#credentials-store</span></span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>
<p>5.发布镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看镜像文件</span></span><br><span class="line">[root@192 tomcat]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">diytomcat             latest    12a14f98db54   5 hours ago     652MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择diytomcat这个镜像，并设置其 名称/版本号</span></span><br><span class="line">[root@192 tomcat]<span class="comment"># docker tag diytomcat eternal0918/tomcat:1.0 </span></span><br><span class="line">[root@192 tomcat]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">eternal0918/tomcat        1.0       12a14f98db54   5 hours ago     652MB</span><br><span class="line">diytomcat             latest    12a14f98db54   5 hours ago     652MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布</span></span><br><span class="line">[root@192 tomcat]<span class="comment"># docker push eternal0918/tomcat:1.0</span></span><br><span class="line">The push refers to repository [docker.io/eternal0918/tomcat]</span><br><span class="line">bf32a4702799: Preparing </span><br><span class="line">b81cc63219ca: Preparing </span><br><span class="line">9ef18089fa80: Preparing </span><br><span class="line">28023573d05f: Preparing </span><br><span class="line">2653d992f4ef: Preparing </span><br><span class="line"></span><br><span class="line"><span class="comment">#一定要是dockerhub的用户名，而不是自己随机起的名字，否则会拒绝请求</span></span><br><span class="line">denied: requested access to the resource is denied</span><br><span class="line"></span><br><span class="line"><span class="comment"># diytomcat 可以用id 后面的就是自己设置的版本号和作者名</span></span><br><span class="line">docker tag diytomcat eternal0918/tomcat:1.0  为容器添加一个版本</span><br><span class="line">docker push eternal0918/tomcat:1.0</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731200252678.png" alt="image-20210731200252678"></p>
<h4 id="阿里云"><a href="#阿里云" class="headerlink" title="阿里云"></a>阿里云</h4><blockquote>
<p>提交到阿里云镜像仓库</p>
</blockquote>
<p>1.登录阿里云</p>
<p>2.找到容器镜像服务</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731183716503.png" alt="image-20210731183716503"></p>
<p>3.创建命名空间</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731184059240.png" alt="image-20210731184059240"></p>
<p>4.创建仓库（本地仓库）</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731184153633.png" alt="image-20210731184153633"></p>
<p>5.操作指南</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731184334990.png" alt="image-20210731184334990"></p>
<p>6.发布镜像</p>
<ol>
<li>登录阿里云Docker Registry<br><code>$ sudo docker login --username=eternal秋凉 registry.cn-hangzhou.aliyuncs.com</code><br>用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。</li>
</ol>
<p>您可以在访问凭证页面修改凭证密码。</p>
<ol>
<li>从Registry中拉取镜像<br><code>$ sudo docker pull registry.cn-hangzhou.aliyuncs.com/eternal-zxp/eternalt-test:[镜像版本号]</code></li>
<li>将镜像推送到Registry<br><code>$ sudo docker login --username=eternal秋凉 registry.cn-hangzhou.aliyuncs.com</code><br><code>$ sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/eternal-zxp/eternalt-test:[镜像版本号]</code><br><code>$ sudo docker push registry.cn-hangzhou.aliyuncs.com/eternal-zxp/eternalt-test:[镜像版本号]</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># docker tag c4f190dbcf08 registry.cn-hangzhou.aliyuncs.com/eternal-zxp/eternalt-test:1.0</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker push registry.cn-hangzhou.aliyuncs.com/eternal-zxp/eternalt-test:1.0</span></span><br><span class="line">The push refers to repository [registry.cn-hangzhou.aliyuncs.com/eternal-zxp/eternalt-test]</span><br><span class="line">52754f6530b2: Pushed </span><br><span class="line">992b7b2e692a: Pushed </span><br><span class="line">be12cc774b61: Pushed </span><br><span class="line">7e883d3334b9: Pushed </span><br><span class="line">2653d992f4ef: Pushed </span><br><span class="line">1.0: digest: sha256:70ee5bb534495276b541fa2993206bf8981b4ece54f203a70d845213a6803fed size: 1373</span><br></pre></td></tr></table></figure>
<p>7.查看镜像</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731193340847.png" alt="image-20210731193340847"></p>
<h1 id="8-Docker网络"><a href="#8-Docker网络" class="headerlink" title="8.Docker网络"></a>8.Docker网络</h1><h2 id="理解Docker"><a href="#理解Docker" class="headerlink" title="理解Docker"></a>理解Docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询网络ip</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># ip addr</span></span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:7d:22:76 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.158.136/24 brd 192.168.158.255 scope global noprefixroute dynamic ens33</span><br><span class="line">       valid_lft 1329sec preferred_lft 1329sec</span><br><span class="line">    inet6 fe80::3784:30b0:4035:a581/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:c5:f3:53 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:c5:f3:53 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:5e:62:1a:da brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:5eff:fe62:1ada/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment">#除了自带的几个，没有多余的网卡</span></span><br></pre></td></tr></table></figure>
<p><strong>lo：</strong>本机回环地址</p>
<p><strong>ens33：</strong>虚拟机地址（云服务器地址）</p>
<p><strong>docker0：</strong>docker地址</p>
<blockquote>
<p>三个网络</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 问题：docker时如何处理容器网络访问的？</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># docker run -d -P --name tomcat01 tomcat:9.0.50</span></span><br><span class="line"><span class="comment">#查看容器内的网络地址 ip addr</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat01 ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">62: eth0@if63: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># linux ping 通容器</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># ping 172.17.0.2</span></span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=2.24 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.148 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.044 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.049 ms</span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">14 packets transmitted, 14 received, 0% packet loss, time 13013ms</span><br><span class="line">rtt min/avg/max/mdev = 0.040/0.220/2.243/0.562 ms</span><br></pre></td></tr></table></figure>
<blockquote>
<p>原理</p>
</blockquote>
<p>我们每启动一个docker容器,docker就会给docker容器分配一个ip,我们只要安装了docker,就会有一个网卡docker0,桥接模式,使用的技术是veth-pair技术!</p>
<p><strong>再测试一次</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:7d:22:76 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.158.136/24 brd 192.168.158.255 scope global noprefixroute dynamic ens33</span><br><span class="line">       valid_lft 1749sec preferred_lft 1749sec</span><br><span class="line">    inet6 fe80::3784:30b0:4035:a581/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:c5:f3:53 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:c5:f3:53 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:5e:62:1a:da brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:5eff:fe62:1ada/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">63: veth2de3706@if62: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 4e:a1:51:fe:c8:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::4ca1:51ff:fefe:c849/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment">#多了一个网卡 63</span></span><br></pre></td></tr></table></figure>
<p><strong>再开启一个容器，并测试</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建一个容器</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run -d -P --name tomcat02 tomcat:9.0.50</span></span><br><span class="line">de8cfaa5d40c5f3a347a23c765f82e613e6b0899d359c1a350e80a2dd15693e6</span><br><span class="line"></span><br><span class="line"><span class="comment">#再次进行测试</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:7d:22:76 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.158.136/24 brd 192.168.158.255 scope global noprefixroute dynamic ens33</span><br><span class="line">       valid_lft 1450sec preferred_lft 1450sec</span><br><span class="line">    inet6 fe80::3784:30b0:4035:a581/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:c5:f3:53 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:c5:f3:53 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:5e:62:1a:da brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:5eff:fe62:1ada/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">63: veth2de3706@if62: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 4e:a1:51:fe:c8:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::4ca1:51ff:fefe:c849/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">65: vethccc5d6e@if64: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 1e:a8:78:7f:53:98 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::1ca8:78ff:fe7f:5398/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="comment">#发现又多了一个 65</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat02 ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">64: eth0@if65: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<blockquote>
<p>现象</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 观察现象：</span></span><br><span class="line"><span class="comment"># tomcat --- linux主机 veth2de3706@if62  ---- 容器内 eth0@if63</span></span><br><span class="line"><span class="comment"># tomcat --- linux主机 vethccc5d6e@if64  ---- 容器内 eth0@if65</span></span><br><span class="line"><span class="comment"># 只要启动一个容器，就有一对网卡</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>结论</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># veth-pair 就是一对的虚拟设备接口，它都是成对出现的。一端连着协议栈，一端彼此相连着。</span></span><br><span class="line"><span class="comment"># 正因为有这个特性，它常常充当着一个桥梁，连接着各种虚拟网络设备!</span></span><br><span class="line"><span class="comment"># “Bridge、OVS 之间的连接”，“Docker 容器之间的连接” 等等，以此构建出非常复杂的虚拟网络结构，比如 OpenStack Neutron。</span></span><br></pre></td></tr></table></figure>
<p>两个容器之间进行ping测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 容器 tomcat02 ping tomcat01 的地址</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat02 ping 172.17.0.2</span></span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.459 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.052 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.065 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=5 ttl=64 time=0.053 ms</span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 6ms</span><br><span class="line">rtt min/avg/max/mdev = 0.051/0.136/0.459/0.161 ms</span><br><span class="line"></span><br><span class="line"><span class="comment">#成功 ping 通</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>原理</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731211638224.png" alt="image-20210731211638224"></p>
<p><strong>结论：</strong>tomcat1和tomcat2共用一个路由器，通过路由器进行桥接，并非是二者直连（相当于一个路由器）</p>
<p>他们使用的一个，就是docker0。任何一个容器启动 默认都是docker0网络。 docker默认会给容器分配一个可用ip</p>
<p>Docker 使用的是Linux的桥接,宿主机中是一个Docker容器的网桥,docker0</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据 Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网 关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的Container-IP直接 通信。</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731212402980.png" alt="image-20210731212402980"></p>
<p>Docker容器网络就很好的利用了Linux虚拟网络技术，在本地主机和容器内分别创建一个虚拟接口，并 让他们彼此联通（这样一对接口叫veth pair）； </p>
<p>Docker中的网络接口默认都是虚拟的接口。虚拟接口的优势就是转发效率极高（因为Linux是在内核中 进行数据的复制来实现虚拟接口之间的数据转发，无需通过外部的网络设备交换），对于本地系统和容 器系统来说，虚拟接口跟一个正常的以太网卡相比并没有区别，只是他的速度快很多。</p>
<p><strong>Docker中所有的网络接口都是虚拟的,虚拟的转发效率高</strong></p>
<p><strong>只要容器删除,对应网桥的一对就没了</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731214512111.png" alt="image-20210731214512111"></p>
<h2 id="—link"><a href="#—link" class="headerlink" title="—link"></a>—link</h2><blockquote>
<p>思考一个场景，我们编写一个微服务，数据库连接地址原来是使用ip的，如果ip变化就不行了，那我们 能不能使用服务名访问呢？ jdbc:mysql://mysql:3306，这样的话哪怕mysql重启，我们也不需要修改配置了！docker提供了 —link 的操作！</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tomcat01 ping tomcat02	发现失败，不可通过名字进行ping链接</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat01 ping tomcat02</span></span><br><span class="line">ping: tomcat02: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个新的容器tomcat03 通过 --link 与 tomcat02 进行绑定</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run -d -P --name tomcat03 --link tomcat02 tomcat:9.0.50</span></span><br><span class="line">f11b38d4209e59e7a08b848266536f3b873523898e874fa3affd0b8c1a0b4097</span><br><span class="line"><span class="comment"># tomcat03 ping tomcat02 直接ping通</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat03 ping tomcat02</span></span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.181 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=3 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=4 ttl=64 time=0.056 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat02 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 1002ms</span><br><span class="line">rtt min/avg/max/mdev = 0.051/0.084/0.181/0.056 ms</span><br><span class="line"></span><br><span class="line"><span class="comment">#反向ping 却无法ping成功</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat02 ping tomcat03</span></span><br><span class="line">ping: tomcat03: Name or service not known</span><br></pre></td></tr></table></figure>
<blockquote>
<p>探究</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#找到桥梁 bridge（docker0与三个容器之间的关系）</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">f5d4f5ae9c46   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">c3bd29cd9dcb   host      host      <span class="built_in">local</span></span><br><span class="line">da53b1d644b0   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network inspect f5d4f5ae9c46</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"f5d4f5ae9c46977108934854a7e41560a0181903d4a546193425b82b2bdd965d"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2021-07-31T10:40:28.611773097+08:00"</span>,</span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"EnableIPv6"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"IPAM"</span>: &#123;</span><br><span class="line">            <span class="string">"Driver"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"Options"</span>: null,</span><br><span class="line">            <span class="string">"Config"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"Subnet"</span>: <span class="string">"172.17.0.0/16"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Internal"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Attachable"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Ingress"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"ConfigFrom"</span>: &#123;</span><br><span class="line">            <span class="string">"Network"</span>: <span class="string">""</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"ConfigOnly"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Containers"</span>: &#123;</span><br><span class="line">            <span class="string">"5ec3db2989cd6f3dfb4590f843d483fd13bd6aa16f6c4194126f9edfd483aa06"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tomcat01"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"ac763134d7f921d9a54df9ab5bad1537b12360061a96eb964b228290ec317e16"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:02"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"172.17.0.2/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"de8cfaa5d40c5f3a347a23c765f82e613e6b0899d359c1a350e80a2dd15693e6"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tomcat02"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"189545c63552241c57a177b81cc5f66f7139c106c5a5adc095d5daea6dec1827"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:03"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"172.17.0.3/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"f11b38d4209e59e7a08b848266536f3b873523898e874fa3affd0b8c1a0b4097"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tomcat03"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"511d210a2d58eace084a087f3efee93a9a44d037ed9adedfa4dc69decc06f852"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:ac:11:00:04"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"172.17.0.4/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Options"</span>: &#123;</span><br><span class="line">            <span class="string">"com.docker.network.bridge.default_bridge"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.enable_icc"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.enable_ip_masquerade"</span>: <span class="string">"true"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.host_binding_ipv4"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.bridge.name"</span>: <span class="string">"docker0"</span>,</span><br><span class="line">            <span class="string">"com.docker.network.driver.mtu"</span>: <span class="string">"1500"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@192 dockerFile]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731214645372.png" alt="image-20210731214645372"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 tomcat03 的配置</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat03 cat /etc/hosts</span></span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	tomcat02 de8cfaa5d40c</span><br><span class="line">172.17.0.4	f11b38d4209e</span><br><span class="line"></span><br><span class="line"><span class="comment">#里面与tomcat02 写死绑定</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 所以这里其实就是配置了一个 hosts 地址而已！</span></span><br><span class="line"><span class="comment"># 原因：--link的时候，直接把需要link的主机的域名和ip直接配置到了hosts文件中了。</span></span><br></pre></td></tr></table></figure>
<p>本地探究 – link 就是我们在host配置中增加了一个 172.17.0.3    tomcat02 de8cfaa5d40c</p>
<p>我们现在玩Docker已经不建议使用–link了!</p>
<p>自定义网络,不使用docker0!</p>
<p>docker0问题: 它不支持容器名连接访问!</p>
<h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><blockquote>
<p>基本命令查看</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@192 dockerFile]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">f5d4f5ae9c46   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">c3bd29cd9dcb   host      host      <span class="built_in">local</span></span><br><span class="line">da53b1d644b0   none      null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<p><strong>网络模式</strong></p>
<p>bridge : 桥接 docker 大桥</p>
<p>none: 不配置网络</p>
<p>host: 和宿主机共享网络</p>
<p>container: 容器内网络联通!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接启动的命令 --net brodge,默认docker0</span></span><br><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker0的特点: 默认的,域名是不能访问的, --link可以打通连接（不建议使用）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义网络</span></span><br><span class="line">--driver bridge			<span class="comment">#自定义模式为桥接</span></span><br><span class="line">--subnet 192.168.0.0/16			<span class="comment">#子网</span></span><br><span class="line">--gateway 192.168.0.1 			<span class="comment">#网关</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义网络</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span></span><br><span class="line">16fb0a4680801ef7419ff408e4643e3bb9ba853a5da0343a25ab11c86eb4133c</span><br><span class="line"><span class="comment"># 查看网络</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">f5d4f5ae9c46   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">c3bd29cd9dcb   host      host      <span class="built_in">local</span></span><br><span class="line">16fb0a468080   mynet     bridge    <span class="built_in">local</span></span><br><span class="line">da53b1d644b0   none      null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>网络模式</th>
<th>说明</th>
<th>配置</th>
</tr>
</thead>
<tbody>
<tr>
<td>bridge模 式</td>
<td>—net=bridge</td>
<td>默认值，在Docker网桥docker0上为容器创建新的网络 栈</td>
</tr>
<tr>
<td>none模式</td>
<td>—net=none</td>
<td>不配置网络，用户可以稍后进入容器，自行配置</td>
</tr>
<tr>
<td>container 模式</td>
<td>— net=container:name/id</td>
<td>容器和另外一个容器共享Network namespace。 kubernetes中的pod就是多个容器共享一个Network namespace。</td>
</tr>
<tr>
<td>host模式</td>
<td>—net=host</td>
<td>容器和宿主机共享Network namespace</td>
</tr>
<tr>
<td>用户自定 义</td>
<td>—net=自定义网络</td>
<td>用户自己使用network相关命令定义网络，创建容器的 时候可以指定为自己定义的网络</td>
</tr>
</tbody>
</table>
</div>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看自己的网络</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"mynet"</span>,</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"16fb0a4680801ef7419ff408e4643e3bb9ba853a5da0343a25ab11c86eb4133c"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2021-07-31T22:06:45.634735004+08:00"</span>,</span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"EnableIPv6"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"IPAM"</span>: &#123;</span><br><span class="line">            <span class="string">"Driver"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"Options"</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">"Config"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"Subnet"</span>: <span class="string">"192.168.0.0/16"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"192.168.0.1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Internal"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Attachable"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Ingress"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"ConfigFrom"</span>: &#123;</span><br><span class="line">            <span class="string">"Network"</span>: <span class="string">""</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"ConfigOnly"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Containers"</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">"Options"</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment"># 我们自己配置的网络</span></span><br><span class="line"><span class="string">"Subnet"</span>: <span class="string">"192.168.0.0/16"</span>,</span><br><span class="line"><span class="string">"Gateway"</span>: <span class="string">"192.168.0.1"</span></span><br></pre></td></tr></table></figure>
<p><strong>创建容器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建一个容器1</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run -d -P --name tomcat-net-01 --net mynet tomcat:9.0.50</span></span><br><span class="line">2eb99835a3e24a4e68dd8f9e15cdafe31187f5d3182b45cf0e7aaaab6a39f912</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建一个容器2</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run -d -P --name tomcat-net-02 --net mynet tomcat:9.0.50</span></span><br><span class="line">a65a2b150415e4659c7e30ed8613aad601582c37db637fe1ead6f902fac14bfd</span><br><span class="line"></span><br><span class="line"><span class="comment">#再一次进入进行查看，发现多了两个配置</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"mynet"</span>,</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"16fb0a4680801ef7419ff408e4643e3bb9ba853a5da0343a25ab11c86eb4133c"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2021-07-31T22:06:45.634735004+08:00"</span>,</span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"EnableIPv6"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"IPAM"</span>: &#123;</span><br><span class="line">            <span class="string">"Driver"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"Options"</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">"Config"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"Subnet"</span>: <span class="string">"192.168.0.0/16"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"192.168.0.1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Internal"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Attachable"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Ingress"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"ConfigFrom"</span>: &#123;</span><br><span class="line">            <span class="string">"Network"</span>: <span class="string">""</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"ConfigOnly"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Containers"</span>: &#123;</span><br><span class="line">            <span class="string">"2eb99835a3e24a4e68dd8f9e15cdafe31187f5d3182b45cf0e7aaaab6a39f912"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tomcat-net-01"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"71c4e68884b0fe55917e106aaba06117e084d4a3050568c5b439b21e3b05bdbf"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:c0:a8:00:02"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"192.168.0.2/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"a65a2b150415e4659c7e30ed8613aad601582c37db637fe1ead6f902fac14bfd"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tomcat-net-02"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"ce66554ae7e88377409f7e6bab18d99dac181367e362a56b2b30bcc921f189c8"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:c0:a8:00:03"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"192.168.0.3/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Options"</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210731222009571.png" alt="image-20210731222009571"></p>
<p><strong>测试ping连接</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发现 ping 成功了，直接通过名称即可实现</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat-net-01 ping tomcat-net-02</span></span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.162 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.072 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=4 ttl=64 time=0.051 ms</span><br><span class="line">--- tomcat-net-02 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 5ms</span><br><span class="line">rtt min/avg/max/mdev = 0.051/0.085/0.162/0.045 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发现，我们自定义的网络docker都已经帮我们维护好了对应的关系</span></span><br><span class="line"><span class="comment"># 所以我们平时都可以这样使用网络，不使用--link效果一样，所有东西实时维护好，直接域名 ping通</span></span><br></pre></td></tr></table></figure>
<p>自定义网络docker已经帮我们维护好了对应的关系，推荐平时这样使用网络</p>
<p>优点：</p>
<ul>
<li>redis：不同的集群使用不同的网络，保证集群是安全和健康的</li>
<li>mysql：不同的集群使用不同的网络，保证集群时安全和健康的</li>
</ul>
<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><blockquote>
<p>两个网络之间是无法直接连通的：tomcat02 ping tomcat-net01 连接失败</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210801084528978.png" alt="image-20210801084528978"></p>
<p>docker0和自定义网络肯定不通，我们使用自定义网络的好处就是网络隔离： 大家公司项目部署的业务都非常多，假设我们有一个商城，我们会有订单业务（操作不同数据），会有 订单业务购物车业务（操作不同缓存）。如果在一个网络下，有的程序猿的恶意代码就不能防止了，所 以我们就在部署的时候网络隔离，创建两个桥接网卡，比如订单业务（里面的数据库，redis，mq，全 部业务 都在order-net网络下）其他业务在其他网络。 </p>
<p>那关键的问题来了，如何让 tomcat-net-01 访问 tomcat02？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试打通 tomcat02 到 tomcat-net-01</span></span><br><span class="line"><span class="comment"># 连通之后就是将 tomcat02 放到了mynet网络下</span></span><br><span class="line"><span class="comment"># 一个容器两个ip   阿里云: 公网ip 私网ip</span></span><br></pre></td></tr></table></figure>
<p><strong>帮助</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看下network帮助，发现一个命令 connect</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network --help</span></span><br><span class="line">Commands:</span><br><span class="line">connect Connect a container to a network <span class="comment"># 连接一个容器到一个网络</span></span><br><span class="line">create Create a network</span><br><span class="line">disconnect Disconnect a container from a network</span><br><span class="line">inspect Display detailed information on one or more networks</span><br><span class="line">ls List networks</span><br><span class="line">prune Remove all unused networks</span><br><span class="line">rm Remove one or more networks</span><br></pre></td></tr></table></figure>
<p><strong>操作</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 再创建一个容器（单独于mynet网络）</span></span><br><span class="line"><span class="comment"># docker network connect [OPTIONS] NETWORK CONTAINER</span></span><br><span class="line"></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker run -d -P --name tomcat02 tomcat:9.0.50</span></span><br><span class="line">b8d0b236f9ff4c382e3de6fab9784792897c0621eb2ed9cd2028de93cc2d2911</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将二者网络打通</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network connect mynet tomcat02</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进去查看一下mynet的配置</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"Name"</span>: <span class="string">"mynet"</span>,</span><br><span class="line">        <span class="string">"Id"</span>: <span class="string">"16fb0a4680801ef7419ff408e4643e3bb9ba853a5da0343a25ab11c86eb4133c"</span>,</span><br><span class="line">        <span class="string">"Created"</span>: <span class="string">"2021-07-31T22:06:45.634735004+08:00"</span>,</span><br><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span>,</span><br><span class="line">        <span class="string">"Driver"</span>: <span class="string">"bridge"</span>,</span><br><span class="line">        <span class="string">"EnableIPv6"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"IPAM"</span>: &#123;</span><br><span class="line">            <span class="string">"Driver"</span>: <span class="string">"default"</span>,</span><br><span class="line">            <span class="string">"Options"</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">"Config"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">"Subnet"</span>: <span class="string">"192.168.0.0/16"</span>,</span><br><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"192.168.0.1"</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Internal"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Attachable"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Ingress"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"ConfigFrom"</span>: &#123;</span><br><span class="line">            <span class="string">"Network"</span>: <span class="string">""</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"ConfigOnly"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"Containers"</span>: &#123;</span><br><span class="line">            <span class="string">"2eb99835a3e24a4e68dd8f9e15cdafe31187f5d3182b45cf0e7aaaab6a39f912"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tomcat-net-01"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"71c4e68884b0fe55917e106aaba06117e084d4a3050568c5b439b21e3b05bdbf"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:c0:a8:00:02"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"192.168.0.2/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"a65a2b150415e4659c7e30ed8613aad601582c37db637fe1ead6f902fac14bfd"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tomcat-net-02"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"ce66554ae7e88377409f7e6bab18d99dac181367e362a56b2b30bcc921f189c8"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:c0:a8:00:03"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"192.168.0.3/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"b8d0b236f9ff4c382e3de6fab9784792897c0621eb2ed9cd2028de93cc2d2911"</span>: &#123;</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"tomcat02"</span>,</span><br><span class="line">                <span class="string">"EndpointID"</span>: <span class="string">"97f144269f2728f3318aedde38332a1fe549eea58b1904a8d38798844856aa9f"</span>,</span><br><span class="line">                <span class="string">"MacAddress"</span>: <span class="string">"02:42:c0:a8:00:04"</span>,</span><br><span class="line">                <span class="string">"IPv4Address"</span>: <span class="string">"192.168.0.4/16"</span>,</span><br><span class="line">                <span class="string">"IPv6Address"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"Options"</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">"Labels"</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">#可以看到。下面多了一个容器，添加进去 tomcat02</span></span><br></pre></td></tr></table></figure>
<p><strong>测试</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tomcat-net-01 ping tomcat02</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat-net-01 ping tomcat02</span></span><br><span class="line">PING tomcat02 (192.168.0.4) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.4): icmp_seq=1 ttl=64 time=0.085 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.4): icmp_seq=2 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.4): icmp_seq=3 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.4): icmp_seq=4 ttl=64 time=0.051 ms</span><br><span class="line">--- tomcat02 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 4ms</span><br><span class="line">rtt min/avg/max/mdev = 0.050/0.060/0.085/0.015 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># tomcat02 ping tomcat-net-01</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker exec -it tomcat02 ping tomcat-net-01</span></span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.161 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.068 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.051 ms</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 5ms</span><br><span class="line">rtt min/avg/max/mdev = 0.051/0.093/0.161/0.048 ms</span><br><span class="line"></span><br><span class="line"><span class="comment">#两者之间可以互相ping命令</span></span><br></pre></td></tr></table></figure>
<h1 id="9-实战"><a href="#9-实战" class="headerlink" title="9.实战"></a>9.实战</h1><h2 id="Redis集群搭建"><a href="#Redis集群搭建" class="headerlink" title="Redis集群搭建"></a>Redis集群搭建</h2><p>分片 + 高可用 + 负载均衡</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210801085335516.png" alt="image-20210801085335516"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个网卡</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network create redis --subnet 172.38.0.0/16</span></span><br><span class="line">142157bc75cc5941cb3d44d8ac0878132884975c355f0bdc8e1555ea650aa3e7</span><br><span class="line">[root@192 dockerFile]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">......</span><br><span class="line">142157bc75cc   redis     bridge    <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过脚本创建6个redis配置</span></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> $(seq 1 6); \</span><br><span class="line"><span class="keyword">do</span> \</span><br><span class="line">mkdir -p /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf</span><br><span class="line">touch /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1<span class="variable">$&#123;port&#125;</span></span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看创建的6个节点</span></span><br><span class="line">[root@192 dockerFile]<span class="comment"># cd /mydata</span></span><br><span class="line">[root@192 mydata]<span class="comment"># ls</span></span><br><span class="line">redis</span><br><span class="line">[root@192 mydata]<span class="comment"># cd redis</span></span><br><span class="line">[root@192 redis]<span class="comment"># ls</span></span><br><span class="line">node-1  node-2  node-3  node-4  node-5  node-6</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过脚本运行六个redis</span></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> $(seq 1 6);\</span><br><span class="line"><span class="keyword">do</span> \</span><br><span class="line">docker run -p 637<span class="variable">$&#123;port&#125;</span>:6379 -p 1637<span class="variable">$&#123;port&#125;</span>:16379 --name redis-<span class="variable">$&#123;port&#125;</span> \</span><br><span class="line">-v /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/data:/data \</span><br><span class="line">-v /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1<span class="variable">$&#123;port&#125;</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf </span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载redis，并开启6个服务</span></span><br><span class="line">Unable to find image <span class="string">'redis:5.0.9-alpine3.11'</span> locally</span><br><span class="line">5.0.9-alpine3.11: Pulling from library/redis</span><br><span class="line">cbdbe7a5bc2a: Pull complete </span><br><span class="line">dc0373118a0d: Pull complete </span><br><span class="line">cfd369fe6256: Pull complete </span><br><span class="line">3e45770272d9: Pull complete </span><br><span class="line">558de8ea3153: Pull complete </span><br><span class="line">a2c652551612: Pull complete </span><br><span class="line">Digest: sha256:83a3af36d5e57f2901b4783c313720e5fa3ecf0424ba86ad9775e06a9a5e35d0</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> redis:5.0.9-alpine3.11</span><br><span class="line">6cc61a64f5e0f840b103117cafbb32bceb128795c6a4e5670720901bb6d466eb</span><br><span class="line">d5fd711d29114df4f7cdaa0bfd8264b869f8d45f42507c4731aed2d5da756e0b</span><br><span class="line">c4fb14ae595714f8512726e57a1a836be9194f497fee048048ab50a315f1ad65</span><br><span class="line">cbb2e3c66827b6d8b17e6ebbe98320b6a0bf8ae5a2f15750f13c1c37dfe0cec4</span><br><span class="line">c8e494d04e589891e7428adca5cee4d8c09e5e29654bc6b6fdacfdcfc8a2aedc</span><br><span class="line">b46d3282e0631418369a18eaeb27d5088bf872bda20d5c2db7c9214c73e65a89</span><br></pre></td></tr></table></figure>
<p><strong>查看开启的服务</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210801104329851.png" alt="image-20210801104329851"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#停止redis并删除容器</span></span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> $(seq 1 6);\</span><br><span class="line"><span class="keyword">do</span> \</span><br><span class="line">docker stop redis-<span class="variable">$&#123;port&#125;</span>; \</span><br><span class="line">docker rm redis-<span class="variable">$&#123;port&#125;</span>;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入一个redis， /bin/bash 发现进不去</span></span><br><span class="line">[root@192 conf]<span class="comment"># docker exec -it redis-1 /bin/bash</span></span><br><span class="line">OCI runtime <span class="built_in">exec</span> failed: <span class="built_in">exec</span> failed: container_linux.go:380: starting container process caused: <span class="built_in">exec</span>: <span class="string">"/bin/bash"</span>: <span class="built_in">stat</span> /bin/bash: no such file or directory: unknown</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入一个redis， /bin/sh	正常进入</span></span><br><span class="line">docker <span class="built_in">exec</span> -it redis-1 /bin/sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建集群</span></span><br><span class="line">[root@192 conf]<span class="comment"># docker exec -it redis-1 /bin/sh</span></span><br><span class="line">/data <span class="comment"># redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.</span></span><br><span class="line">15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: 53e909311971cd81cdcfb956fdb0d27e0989bd7d 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: 47476b2a95d0a18094711b2e68ad7e42d51b8e8d 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: c032db751bc4b691ea4c09760db3183b80334b80 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 9cb7ed9bb4c334dc62633d6cddcd8814634ecdec 172.38.0.14:6379</span><br><span class="line">   replicates c032db751bc4b691ea4c09760db3183b80334b80</span><br><span class="line">S: 00fc04ad5ed598ce9a1b3c6ba12419920c245da4 172.38.0.15:6379</span><br><span class="line">   replicates 53e909311971cd81cdcfb956fdb0d27e0989bd7d</span><br><span class="line">S: d2a4bb22edca1c5ebb2eb02bfec300b06d6c7fc3 172.38.0.16:6379</span><br><span class="line">   replicates 47476b2a95d0a18094711b2e68ad7e42d51b8e8d</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">'yes'</span> to accept): yes</span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to join</span><br><span class="line">.....</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span><br><span class="line">M: 53e909311971cd81cdcfb956fdb0d27e0989bd7d 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: 47476b2a95d0a18094711b2e68ad7e42d51b8e8d 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 9cb7ed9bb4c334dc62633d6cddcd8814634ecdec 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates c032db751bc4b691ea4c09760db3183b80334b80</span><br><span class="line">S: 00fc04ad5ed598ce9a1b3c6ba12419920c245da4 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 53e909311971cd81cdcfb956fdb0d27e0989bd7d</span><br><span class="line">S: d2a4bb22edca1c5ebb2eb02bfec300b06d6c7fc3 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 47476b2a95d0a18094711b2e68ad7e42d51b8e8d</span><br><span class="line">M: c032db751bc4b691ea4c09760db3183b80334b80 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br></pre></td></tr></table></figure>
<p><strong>进入集群</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入集群</span></span><br><span class="line">/data <span class="comment"># redis-cli -c</span></span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:184</span><br><span class="line">cluster_stats_messages_pong_sent:186</span><br><span class="line">cluster_stats_messages_sent:370</span><br><span class="line">cluster_stats_messages_ping_received:181</span><br><span class="line">cluster_stats_messages_pong_received:184</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:370</span><br><span class="line"><span class="comment"># 查看节点</span></span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">47476b2a95d0a18094711b2e68ad7e42d51b8e8d 172.38.0.12:6379@16379 master - 0 1627787793259 2 connected 5461-10922</span><br><span class="line">9cb7ed9bb4c334dc62633d6cddcd8814634ecdec 172.38.0.14:6379@16379 slave c032db751bc4b691ea4c09760db3183b80334b80 0 1627787792248 4 connected</span><br><span class="line">53e909311971cd81cdcfb956fdb0d27e0989bd7d 172.38.0.11:6379@16379 myself,master - 0 1627787790000 1 connected 0-5460</span><br><span class="line">00fc04ad5ed598ce9a1b3c6ba12419920c245da4 172.38.0.15:6379@16379 slave 53e909311971cd81cdcfb956fdb0d27e0989bd7d 0 1627787792000 5 connected</span><br><span class="line">d2a4bb22edca1c5ebb2eb02bfec300b06d6c7fc3 172.38.0.16:6379@16379 slave 47476b2a95d0a18094711b2e68ad7e42d51b8e8d 0 1627787792000 6 connected</span><br><span class="line">c032db751bc4b691ea4c09760db3183b80334b80 172.38.0.13:6379@16379 master - 0 1627787793000 3 connected 10923-16383</span><br><span class="line"><span class="comment"># 设一个值进去</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> a b</span><br><span class="line">-&gt; Redirected to slot [15495] located at 172.38.0.13:6379</span><br><span class="line">OK</span><br><span class="line">172.38.0.13:6379&gt; get a</span><br><span class="line"><span class="string">"b"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭redis-3容器，关闭一个服务 </span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker stop redis-3</span></span><br><span class="line">redis-3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次进行查看	发现在14查询到了</span></span><br><span class="line">/data <span class="comment"># redis-cli -c</span></span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line">-&gt; Redirected to slot [15495] located at 172.38.0.14:6379</span><br><span class="line"><span class="string">"b"</span></span><br></pre></td></tr></table></figure>
<p><strong>集群搭建成功</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看节点</span></span><br><span class="line">8.0.14:6379&gt; cluster nodes</span><br><span class="line">9cb7ed9bb4c334dc62633d6cddcd8814634ecdec 172.38.0.14:6379@16379 myself,master - 0 1627788309000 7 connected 10923-16383</span><br><span class="line">53e909311971cd81cdcfb956fdb0d27e0989bd7d 172.38.0.11:6379@16379 master - 0 1627788309000 1 connected 0-5460</span><br><span class="line">c032db751bc4b691ea4c09760db3183b80334b80 172.38.0.13:6379@16379 master,fail - 1627788017568 1627788016000 3 connected</span><br><span class="line">d2a4bb22edca1c5ebb2eb02bfec300b06d6c7fc3 172.38.0.16:6379@16379 slave 47476b2a95d0a18094711b2e68ad7e42d51b8e8d 0 1627788309284 6 connected</span><br><span class="line">00fc04ad5ed598ce9a1b3c6ba12419920c245da4 172.38.0.15:6379@16379 slave 53e909311971cd81cdcfb956fdb0d27e0989bd7d 0 1627788309789 5 connected</span><br><span class="line">47476b2a95d0a18094711b2e68ad7e42d51b8e8d 172.38.0.12:6379@16379 master - 0 1627788310092 2 connected 5461-10922</span><br><span class="line">172.38.0.14:6379&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">#  c032db751bc4b691ea4c09760db3183b80334b80 172.38.0.13:6379@16379 master,fail - 1627788017568 1627788016000 3 connected   故障转移</span></span><br><span class="line"><span class="comment">#  9cb7ed9bb4c334dc62633d6cddcd8814634ecdec 172.38.0.14:6379@16379 myself,master - 0 1627788309000 7 connected 10923-16383	转移到 14</span></span><br></pre></td></tr></table></figure>
<h2 id="SpringBoot微服务打包Docker镜像"><a href="#SpringBoot微服务打包Docker镜像" class="headerlink" title="SpringBoot微服务打包Docker镜像"></a>SpringBoot微服务打包Docker镜像</h2><ol>
<li>构建springBoot项目</li>
<li>打包应用</li>
<li>编写dockerfile</li>
<li>构建镜像</li>
<li>发布运行</li>
</ol>
<blockquote>
<p>构建项目</p>
</blockquote>
<p><img src="../../../AppData/Roaming/Typora/typora-user-images/image-20210801135436745.png" alt="image-20210801135436745"></p>
<blockquote>
<p>打包应用</p>
</blockquote>
<p><img src="../../../AppData/Roaming/Typora/typora-user-images/image-20210801135515715.png" alt="image-20210801135515715"></p>
<blockquote>
<p>编写Dockerfile（名字为这个，之后运行就不必指定Dockerfile文件了，自动运行当前文件夹下的Dockerfile，最好是唯一的一个Dockerfile文件）</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line">CMD [<span class="string">"--server.port=8080"</span>]</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"/app.jar"</span>]</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210801135535959.png" alt="image-20210801135535959"></p>
<blockquote>
<p>构建镜像</p>
</blockquote>
<p>将jar包和Dockerfile一起上传到linux中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@192 idea]<span class="comment"># cp /home/eternal/Documents/demo-0.0.1-SNAPSHOT.jar /home/idea</span></span><br><span class="line">[root@192 idea]<span class="comment"># ls</span></span><br><span class="line">demo-0.0.1-SNAPSHOT.jar</span><br><span class="line">[root@192 idea]<span class="comment"># cp /home/eternal/Documents/Dockerfile /home/idea</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行Dockerfile文件</span></span><br><span class="line">[root@192 idea]<span class="comment"># docker build -t demo .</span></span><br><span class="line">Sending build context to Docker daemon  17.34MB</span><br><span class="line">Step 1/5 : FROM java:8</span><br><span class="line">8: Pulling from library/java</span><br><span class="line">5040bd298390: Pull complete </span><br><span class="line">fce5728aad85: Pull complete </span><br><span class="line">76610ec20bf5: Pull complete </span><br><span class="line">60170fec2151: Pull complete </span><br><span class="line">e98f73de8f0d: Pull complete </span><br><span class="line">11f7af24ed9c: Pull complete </span><br><span class="line">49e2d6393f32: Pull complete </span><br><span class="line">bb9cdec9c7f3: Pull complete </span><br><span class="line">Digest: sha256:c1ff613e8ba25833d2e1940da0940c3824f03f802c449f3d1815a66b7f8c0e9d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> java:8</span><br><span class="line"> ---&gt; d23bdf5b1b1b</span><br><span class="line">Step 2/5 : COPY *.jar /app.jar</span><br><span class="line"> ---&gt; 4e315ff5fafe</span><br><span class="line">Step 3/5 : CMD [<span class="string">"--server.port=8080"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 0f026855b5b7</span><br><span class="line">Removing intermediate container 0f026855b5b7</span><br><span class="line"> ---&gt; d2bc2013ea6e</span><br><span class="line">Step 4/5 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> a628214474c1</span><br><span class="line">Removing intermediate container a628214474c1</span><br><span class="line"> ---&gt; 97470c00f558</span><br><span class="line">Step 5/5 : ENTRYPOINT [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"/app.jar"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> f111095e5a49</span><br><span class="line">Removing intermediate container f111095e5a49</span><br><span class="line"> ---&gt; eb0f1f2d5c40</span><br><span class="line">Successfully built eb0f1f2d5c40</span><br><span class="line">Successfully tagged demo:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看构建好的镜像</span></span><br><span class="line">[root@192 idea]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG                IMAGE ID       CREATED         SIZE</span><br><span class="line">demo         latest             eb0f1f2d5c40   2 minutes ago   661MB</span><br><span class="line">tomcat       9.0.50             46cfbf1293b1   8 days ago      668MB</span><br><span class="line">redis        5.0.9-alpine3.11   3661c84ee9d0   15 months ago   29.8MB</span><br><span class="line">java         8                  d23bdf5b1b1b   4 years ago     643MB</span><br></pre></td></tr></table></figure>
<blockquote>
<p>发布运行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发布镜像 指定端口</span></span><br><span class="line">docker run -d --privileged=<span class="literal">true</span> --restart=always -p 80:8080 --name eternal-springboot-hello demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机端口</span></span><br><span class="line">[root@192 idea]<span class="comment"># docker run -d -P --name eternal-springboot-hello demo</span></span><br><span class="line">ea3c99f97963d47d4aeefa523a7a907b45bbecd5d9527ea28f2d1fba32e2427c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看发布的随机端口 49153</span></span><br><span class="line">[root@192 idea]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS              PORTS                                         NAMES</span><br><span class="line">ea3c99f97963   demo      <span class="string">"java -jar /app.jar …"</span>   About a minute ago   Up About a minute   0.0.0.0:49153-&gt;8080/tcp, :::49153-&gt;8080/tcp   eternal-springboot-hello</span><br></pre></td></tr></table></figure>
<p>windows下进行访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210801141120103.png" alt="image-20210801141120103"></p>
<p>发送请求</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210801141143085.png" alt="image-20210801141143085"></p>
<h1 id="10-DockerCompose"><a href="#10-DockerCompose" class="headerlink" title="10.DockerCompose"></a>10.DockerCompose</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a><strong>简介</strong></h2><p>Docker </p>
<p>DockerFile build run 手动操作，单个容器！ </p>
<p>微服务。100个微服务！依赖关系。 </p>
<p>Docker Compose 来轻松高效的管理容器。定义运行多个容器。</p>
<blockquote>
<p>官方介绍</p>
</blockquote>
<p>Compose是一个用于定义和运行多容器Docker应用程序的工具。 使用Compose，您可以使用一个YAML文件来配置应用程序的服务。 然后，通过一个命令，您可以创建并启动配置中的所有服务。  </p>
<p>Compose适用于所有环境:生产、登台、开发、测试以及CI工作流。 </p>
<p>使用Compose基本上有三个步骤:  </p>
<ol>
<li>用<code>Dockerfile</code>定义你的应用程序环境，这样它就可以在任何地方运行。  </li>
<li>在<code>docker-compose.yml</code>中定义组成应用程序的服务。 以便它们可以在一个独立的环境中一起运行。  <ul>
<li>services 什么是服务</li>
<li>docker-compose.yml 这个文件怎么写！</li>
</ul>
</li>
<li>运行<code>docker compose up</code>, docker compose命令会启动并运行整个应用程序。你也可以使用docker-compose二进制文件运行<code>docker-compose up</code>。<ul>
<li>启动项目</li>
</ul>
</li>
</ol>
<p>作用：批量容器编排</p>
<blockquote>
<p>理解</p>
</blockquote>
<p>Compose 是Docker官方的开源项目。需要安装！ </p>
<p>Dockerfile 让程序在任何地方运行。 web服务。 redis、mysql、nginx … 多个容器。 </p>
<p>run Compose</p>
<p>A <code>docker-compose.yml</code> looks like this:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.9"</span>  <span class="comment"># optional since v1.27.0</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"5000:5000"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/code</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">logvolume01:/var/log</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">logvolume01:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>docker-compose up 100 个服务。</p>
<p>Compose ：重要的概念。 </p>
<ul>
<li>服务services， 容器。应用。（web、redis、mysql….） </li>
<li>项目project。 一组关联的容器。 博客。web、mysql。</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>1.下载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 官网下载地址</span></span><br><span class="line">sudo curl -L <span class="string">"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="variable">$(uname -s)</span>-<span class="variable">$(uname -m)</span>"</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载较快</span></span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>
<p>2.授权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>
<p>3.查看版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>
<h2 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h2><blockquote>
<p>官网步骤</p>
</blockquote>
<h3 id="Step1：设置"><a href="#Step1：设置" class="headerlink" title="Step1：设置"></a>Step1：设置</h3><p><strong>1.为项目创建一个目录:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir composetest</span><br><span class="line"><span class="built_in">cd</span> composetest</span><br></pre></td></tr></table></figure>
<p><strong>2.在你的项目目录中创建一个名为app.py的文件</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=<span class="string">'redis'</span>, port=<span class="number">6379</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_hit_count</span><span class="params">()</span>:</span></span><br><span class="line">    retries = <span class="number">5</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> cache.incr(<span class="string">'hits'</span>)</span><br><span class="line">        <span class="keyword">except</span> redis.exceptions.ConnectionError <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="keyword">if</span> retries == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> exc</span><br><span class="line">            retries -= <span class="number">1</span></span><br><span class="line">            time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World! I have been seen &#123;&#125; times.\n'</span>.format(count)</span><br></pre></td></tr></table></figure>
<p>在这个例子中，redis是应用程序网络上redis容器的主机名。 我们使用Redis的默认端口6379。</p>
<p><strong>3.在你的项目目录中创建另一个名为requirements.txt的文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br><span class="line">redis</span><br></pre></td></tr></table></figure>
<h3 id="Step-2-创建一个Dockerfile文件"><a href="#Step-2-创建一个Dockerfile文件" class="headerlink" title="Step 2: 创建一个Dockerfile文件"></a>Step 2: 创建一个Dockerfile文件</h3><p>在这个步骤中，你写一个Dockerfile来构建一个Docker映像。 该映像包含Python应用程序所需的所有依赖项，包括Python本身。</p>
<p>在项目目录中，创建一个名为Dockerfile的文件  ：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span>-alpine</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /code</span></span><br><span class="line"><span class="keyword">ENV</span> FLASK_APP=app.py</span><br><span class="line"><span class="keyword">ENV</span> FLASK_RUN_HOST=<span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk add --no-cache gcc musl-dev linux-headers</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> requirements.txt requirements.txt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install -r requirements.txt</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">5000</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"flask"</span>, <span class="string">"run"</span>]</span></span><br></pre></td></tr></table></figure>
<p>这告诉Docker:</p>
<ul>
<li>从Python 3.7映像开始构建映像。</li>
<li>将工作目录设置为/code。</li>
<li>设置flask命令使用的环境变量。</li>
<li>安装gcc和其他依赖项</li>
<li>复制requirements.txt并安装Python依赖项。</li>
<li>向映像添加元数据，以说明容器正在监听端口5000</li>
<li>为容器设置运行flask的默认命令。</li>
</ul>
<h3 id="Step-3-在Compose文件中定义服务"><a href="#Step-3-在Compose文件中定义服务" class="headerlink" title="Step 3:在Compose文件中定义服务"></a>Step 3:在Compose文件中定义服务</h3><p>创建一个名为docker-compose.yml的文件在项目目录中</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"5000:5000"</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">"redis:alpine"</span></span><br></pre></td></tr></table></figure>
<p>这个Compose文件定义了两个服务:web和redis</p>
<p><strong>Web service</strong></p>
<p>web服务使用从当前目录中的Dockerfile构建的映像。 然后它将容器和主机绑定到公开的端口5000,这个示例服务使用Flask web服务器的默认端口5000.</p>
<p><strong>Redis service</strong></p>
<p>redis服务使用从Docker Hub注册表拉出的公共redis镜像.</p>
<h3 id="Step-4-使用Compose构建并运行应用程序"><a href="#Step-4-使用Compose构建并运行应用程序" class="headerlink" title="Step 4:使用Compose构建并运行应用程序"></a>Step 4:使用Compose构建并运行应用程序</h3><p><strong>1.从您的项目目录，通过运行docker-compose up启动您的应用程序:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">[root@192 composetest]<span class="comment"># docker-compose up </span></span><br><span class="line">Building web</span><br><span class="line">Step 1/10 : FROM python:3.7-alpine</span><br><span class="line">3.7-alpine: Pulling from library/python</span><br><span class="line">5843afab3874: Pull complete</span><br><span class="line">1174600ee52d: Pull complete</span><br><span class="line">437edbe431b9: Pull complete</span><br><span class="line">1416265535ec: Pull complete</span><br><span class="line">2ef7f525363f: Pull complete</span><br><span class="line">Digest: sha256:0357dd472fd9e5717caeee37c335e23f118e81a368662e815423a778bb26e45d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> python:3.7-alpine</span><br><span class="line"> ---&gt; dc24f57a9e79</span><br><span class="line">Step 2/10 : WORKDIR /code</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 511de5bb7f16</span><br><span class="line">Removing intermediate container 511de5bb7f16</span><br><span class="line"> ---&gt; b460f6990ffb</span><br><span class="line">Step 3/10 : ENV FLASK_APP=app.py</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> d7a243444613</span><br><span class="line">Removing intermediate container d7a243444613</span><br><span class="line"> ---&gt; 81182dbed6ab</span><br><span class="line">Step 4/10 : ENV FLASK_RUN_HOST=0.0.0.0</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 4247dd6cab4f</span><br><span class="line">Removing intermediate container 4247dd6cab4f</span><br><span class="line"> ---&gt; b7c8a4364c2e</span><br><span class="line">Step 5/10 : RUN apk add --no-cache gcc musl-dev linux-headers</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> d717409c59a5</span><br><span class="line">fetch https://dl-cdn.alpinelinux.org/alpine/v3.14/main/x86_64/APKINDEX.tar.gz</span><br><span class="line">fetch https://dl-cdn.alpinelinux.org/alpine/v3.14/community/x86_64/APKINDEX.tar.gz</span><br><span class="line">(1/13) Installing libgcc (10.3.1_git20210424-r2)</span><br><span class="line">(2/13) Installing libstdc++ (10.3.1_git20210424-r2)</span><br><span class="line">(3/13) Installing binutils (2.35.2-r2)</span><br><span class="line">(4/13) Installing libgomp (10.3.1_git20210424-r2)</span><br><span class="line">(5/13) Installing libatomic (10.3.1_git20210424-r2)</span><br><span class="line">(6/13) Installing libgphobos (10.3.1_git20210424-r2)</span><br><span class="line">(7/13) Installing gmp (6.2.1-r0)</span><br><span class="line">(8/13) Installing isl22 (0.22-r0)</span><br><span class="line">(9/13) Installing mpfr4 (4.1.0-r0)</span><br><span class="line">(10/13) Installing mpc1 (1.2.1-r0)</span><br><span class="line">(11/13) Installing gcc (10.3.1_git20210424-r2)</span><br><span class="line">(12/13) Installing linux-headers (5.10.41-r0)</span><br><span class="line">(13/13) Installing musl-dev (1.2.2-r3)</span><br><span class="line">Executing busybox-1.33.1-r2.trigger</span><br><span class="line">OK: 140 MiB <span class="keyword">in</span> 48 packages</span><br><span class="line">Removing intermediate container d717409c59a5</span><br><span class="line"> ---&gt; 468eaf2fbf1a</span><br><span class="line">Step 6/10 : COPY requirements.txt requirements.txt</span><br><span class="line"> ---&gt; af34409b2eed</span><br><span class="line">Step 7/10 : RUN pip install -r requirements.txt</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 505c6f2cd293</span><br><span class="line">Collecting flask</span><br><span class="line">  Downloading Flask-2.0.1-py3-none-any.whl (94 kB)</span><br><span class="line">Collecting redis</span><br><span class="line">  Downloading redis-3.5.3-py2.py3-none-any.whl (72 kB)</span><br><span class="line">Collecting Werkzeug&gt;=2.0</span><br><span class="line">  Downloading Werkzeug-2.0.1-py3-none-any.whl (288 kB)</span><br><span class="line">Collecting click&gt;=7.1.2</span><br><span class="line">  Downloading click-8.0.1-py3-none-any.whl (97 kB)</span><br><span class="line">Collecting Jinja2&gt;=3.0</span><br><span class="line">  Downloading Jinja2-3.0.1-py3-none-any.whl (133 kB)</span><br><span class="line">Collecting itsdangerous&gt;=2.0</span><br><span class="line">  Downloading itsdangerous-2.0.1-py3-none-any.whl (18 kB)</span><br><span class="line">Collecting importlib-metadata</span><br><span class="line">  Downloading importlib_metadata-4.6.3-py3-none-any.whl (17 kB)</span><br><span class="line">Collecting MarkupSafe&gt;=2.0</span><br><span class="line">  Downloading MarkupSafe-2.0.1.tar.gz (18 kB)</span><br><span class="line">Collecting typing-extensions&gt;=3.6.4</span><br><span class="line">  Downloading typing_extensions-3.10.0.0-py3-none-any.whl (26 kB)</span><br><span class="line">Collecting zipp&gt;=0.5</span><br><span class="line">  Downloading zipp-3.5.0-py3-none-any.whl (5.7 kB)</span><br><span class="line">Building wheels <span class="keyword">for</span> collected packages: MarkupSafe</span><br><span class="line">  Building wheel <span class="keyword">for</span> MarkupSafe (setup.py): started</span><br><span class="line">  Building wheel <span class="keyword">for</span> MarkupSafe (setup.py): finished with status <span class="string">'done'</span></span><br><span class="line">  Created wheel <span class="keyword">for</span> MarkupSafe: filename=MarkupSafe-2.0.1-cp37-cp37m-linux_x86_64.whl size=14614 sha256=38b0cb4d087af4d7bd978f636652f6edb6b64b8d434683ec6d1e2067016af412</span><br><span class="line">  Stored <span class="keyword">in</span> directory: /root/.cache/pip/wheels/1a/18/04/e3b5bd888f000c2716bccc94a565239f9defc47ef93d9e7bea</span><br><span class="line">Successfully built MarkupSafe</span><br><span class="line">Installing collected packages: zipp, typing-extensions, MarkupSafe, importlib-metadata, Werkzeug, Jinja2, itsdangerous, click, redis, flask</span><br><span class="line">Successfully installed Jinja2-3.0.1 MarkupSafe-2.0.1 Werkzeug-2.0.1 click-8.0.1 flask-2.0.1 importlib-metadata-4.6.3 itsdangerous-2.0.1 redis-3.5.3 typing-extensions-3.10.0.0 zipp-3.5.0</span><br><span class="line">WARNING: Running pip as the <span class="string">'root'</span> user can result <span class="keyword">in</span> broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv</span><br><span class="line">WARNING: You are using pip version 21.2.1; however, version 21.2.2 is available.</span><br><span class="line">You should consider upgrading via the <span class="string">'/usr/local/bin/python -m pip install --upgrade pip'</span> <span class="built_in">command</span>.</span><br><span class="line">Removing intermediate container 505c6f2cd293</span><br><span class="line"> ---&gt; 85cdffa0ae04</span><br><span class="line">Step 8/10 : EXPOSE 5000</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> c003d36bc149</span><br><span class="line">Removing intermediate container c003d36bc149</span><br><span class="line"> ---&gt; c84787e55520</span><br><span class="line">Step 9/10 : COPY . .</span><br><span class="line"> ---&gt; a92b59fa4169</span><br><span class="line">Step 10/10 : CMD [<span class="string">"flask"</span>, <span class="string">"run"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> fd46230dc075</span><br><span class="line">Removing intermediate container fd46230dc075</span><br><span class="line"> ---&gt; 64a309d2e06b</span><br><span class="line"></span><br><span class="line">Successfully built 64a309d2e06b</span><br><span class="line">Successfully tagged composetest_web:latest</span><br><span class="line">WARNING: Image <span class="keyword">for</span> service web was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.</span><br><span class="line">Pulling redis (redis:alpine)...</span><br><span class="line">alpine: Pulling from library/redis</span><br><span class="line">5843afab3874: Already exists</span><br><span class="line">9db2305878ef: Pull complete</span><br><span class="line">3558750a1d54: Pull complete</span><br><span class="line">425b6ad3558b: Pull complete</span><br><span class="line">638bf2557b6e: Pull complete</span><br><span class="line">c3553f307e8f: Pull complete</span><br><span class="line">Digest: sha256:3ff6fbaa2896f825bbb93f0cf82716b6cdcd700ee066de4f9178c2028fe56c52</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> redis:alpine</span><br><span class="line">Creating composetest_web_1   ... <span class="keyword">done</span></span><br><span class="line">Creating composetest_redis_1 ... <span class="keyword">done</span></span><br><span class="line">Attaching to composetest_redis_1, composetest_web_1</span><br><span class="line">redis_1  | 1:C 02 Aug 2021 12:02:06.449 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">redis_1  | 1:C 02 Aug 2021 12:02:06.449 <span class="comment"># Redis version=6.2.5, bits=64, commit=00000000, modified=0, pid=1, just started</span></span><br><span class="line">redis_1  | 1:C 02 Aug 2021 12:02:06.449 <span class="comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span></span><br><span class="line">redis_1  | 1:M 02 Aug 2021 12:02:06.450 * monotonic clock: POSIX clock_gettime</span><br><span class="line">redis_1  | 1:M 02 Aug 2021 12:02:06.451 * Running mode=standalone, port=6379.</span><br><span class="line">redis_1  | 1:M 02 Aug 2021 12:02:06.451 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">redis_1  | 1:M 02 Aug 2021 12:02:06.451 <span class="comment"># Server initialized</span></span><br><span class="line">redis_1  | 1:M 02 Aug 2021 12:02:06.451 <span class="comment"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.</span></span><br><span class="line">redis_1  | 1:M 02 Aug 2021 12:02:06.451 * Ready to accept connections</span><br><span class="line">web_1    |  * Serving Flask app <span class="string">'app.py'</span> (lazy loading)</span><br><span class="line">web_1    |  * Environment: production</span><br><span class="line">web_1    |    WARNING: This is a development server. Do not use it <span class="keyword">in</span> a production deployment.</span><br><span class="line">web_1    |    Use a production WSGI server instead.</span><br><span class="line">web_1    |  * Debug mode: off</span><br><span class="line">web_1    |  * Running on all addresses.</span><br><span class="line">web_1    |    WARNING: This is a development server. Do not use it <span class="keyword">in</span> a production deployment.</span><br><span class="line">web_1    |  * Running on http://172.18.0.2:5000/ (Press CTRL+C to quit)</span><br><span class="line">web_1    | 172.18.0.1 - - [02/Aug/2021 12:04:01] <span class="string">"GET / HTTP/1.1"</span> 200 -</span><br><span class="line">web_1    | 172.18.0.1 - - [02/Aug/2021 12:04:01] <span class="string">"GET /favicon.ico HTTP/1.1"</span> 404 -</span><br></pre></td></tr></table></figure>
<p>Compose生成一个Redis镜像，为你的代码构建一个镜像，然后启动你定义的服务。 在本例中，代码在构建时静态地复制到映像中。</p>
<p><strong>2.在浏览器中输入<a href="http://localhost:5000/以查看应用程序的运行情况" target="_blank" rel="noopener">http://localhost:5000/以查看应用程序的运行情况</a></strong></p>
<p>如果你在Linux、Mac或Windows上使用Docker，那么web应用程序现在应该在Docker守护主机的5000端口上监听。 将浏览器指向<a href="http://localhost:5000以找到Hello">http://localhost:5000以找到Hello</a> World消息。 如果这还不能解决，你也可以试试<a href="http://127.0.0.1:5000。">http://127.0.0.1:5000。</a></p>
<p> 如果你在Mac或Windows上使用Docker Machine，使用Docker - Machine ip MACHINE_VM来获取Docker主机的ip地址。 然后，在浏览器中打开<a href="http://MACHINE_VM_IP:5000。">http://MACHINE_VM_IP:5000。</a></p>
<p> 你应该在浏览器中看到一条消息:</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210802200654370.png" alt="image-20210802200654370"></p>
<p><strong>3.刷新页面</strong></p>
<p>这个数字应该增加。  </p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210802200543213.png" alt="image-20210802200543213"></p>
<p><strong>4.切换到另一个终端窗口，并键入docker image ls以列出本地映像。</strong>  </p>
<p>此时列出图像应该返回redis和web。  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前运行容器</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS          PORTS                                       NAMES</span><br><span class="line">55f0a13fad54   redis:alpine      <span class="string">"docker-entrypoint.s…"</span>   10 minutes ago   Up 10 minutes   6379/tcp                                    composetest_redis_1</span><br><span class="line">5e57452f7f0e   composetest_web   <span class="string">"flask run"</span>              10 minutes ago   Up 10 minutes   0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   composetest_web_1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 镜像文件查看</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY        TAG          IMAGE ID       CREATED          SIZE</span><br><span class="line">composetest_web   latest       64a309d2e06b   29 minutes ago   184MB</span><br><span class="line">python            3.7-alpine   dc24f57a9e79   6 days ago       41.9MB</span><br><span class="line">redis             alpine       eb705d309426   10 days ago      32.3MB</span><br></pre></td></tr></table></figure>
<p>您可以使用docker inspect 检查镜像</p>
<p>停止应用程序，要么在第二个终端的项目目录下运行<code>docker-compose down</code>，要么在启动应用程序的原始终端上按CTRL+C。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">^CGracefully stopping... (press Ctrl+C again to force)</span><br><span class="line">Stopping composetest_redis_1 ... <span class="keyword">done</span></span><br><span class="line">Stopping composetest_web_1   ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># docker service ls</span></span><br><span class="line">Error response from daemon: This node is not a swarm manager. Use <span class="string">"docker swarm init"</span> or <span class="string">"docker swarm join"</span> to connect this node to swarm and try again.</span><br></pre></td></tr></table></figure>
<p>默认的服务名 文件名<em>服务名 </em> num    <code>composetest_web_1</code>和<code>composetest_redis_1</code></p>
<p>多个服务器。集群。A B _num 副本数量 </p>
<p>服务redis服务 =&gt; 4个副本。 </p>
<p>集群状态。服务都不可能只有一个运行实例。 弹性、10 HA 高并发。</p>
<p>kubectl service 负载均衡。</p>
<p><strong>5.网络规则</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@192 eternal]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME                  DRIVER    SCOPE</span><br><span class="line">b81aff79717b   bridge                bridge    <span class="built_in">local</span></span><br><span class="line">9c8ba9bfc2ef   composetest_default   bridge    <span class="built_in">local</span></span><br><span class="line">ef30316d2f16   host                  host      <span class="built_in">local</span></span><br><span class="line">54415741bbbb   none                  null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<p>10个服务 =&gt; 项目 （项目中的内容都在同个网络下。域名访问）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect composetest_default</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210802204536182.png" alt="image-20210802204536182"></p>
<p>发现<code>composetest_web_1</code>和<code>composetest_redis_1</code>两个服务都在同一网络中</p>
<p>如果在同一个网络下，我们可以直接通过域名访问。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>docker-compose 以前都是单个 docker run 启动容器。 </p>
<p>docker-compose。 通过 docker-compose 编写 yaml配置文件、可以通过 compose 一键启动所有服 务，停止。！</p>
<p><strong>Docker小结：</strong> </p>
<ul>
<li>1、Docker 镜像。 run =&gt; 容器 </li>
<li>2、DockerFile 构建镜像（服务打包） </li>
<li>3、docker-compose 启动项目（编排、多个微服务/环境） </li>
<li>4、Docker 网络</li>
</ul>
<h2 id="yaml规则"><a href="#yaml规则" class="headerlink" title="yaml规则"></a>yaml规则</h2><p>docker-compose.yaml 核心。</p>
<p>常用命令：<a href="https://docs.docker.com/compose/compose-file/compose-file-v3/" target="_blank" rel="noopener">https://docs.docker.com/compose/compose-file/compose-file-v3/</a></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3层！</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">''</span> <span class="comment"># 版本</span></span><br><span class="line"><span class="attr">services:</span> <span class="comment"># 服务</span></span><br><span class="line">	<span class="string">服务1:</span> <span class="string">web</span></span><br><span class="line">		<span class="comment"># 服务配置</span></span><br><span class="line">		<span class="string">images</span></span><br><span class="line">		<span class="string">build</span></span><br><span class="line">		<span class="string">network</span></span><br><span class="line">		<span class="string">.....</span></span><br><span class="line">	<span class="string">服务2:</span> <span class="string">redis</span></span><br><span class="line">		<span class="string">....</span></span><br><span class="line">	<span class="string">服务3:</span> <span class="string">redis</span></span><br><span class="line"><span class="comment"># 其他配置 网络/卷、全局规则</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">configs:</span></span><br></pre></td></tr></table></figure>
<h2 id="开源项目"><a href="#开源项目" class="headerlink" title="开源项目"></a>开源项目</h2><h3 id="博客"><a href="#博客" class="headerlink" title="博客"></a><strong>博客</strong></h3><p>下载程序、安装数据库、配置…..  </p>
<p>compose 应用。=&gt; 一键启动！ </p>
<ul>
<li>1、下载项目（docker-compose.yaml） </li>
<li>2、如果需要文件。Dcokerfile </li>
<li>3、文件准备齐全（直接一键启动项目！）</li>
</ul>
<p>去官网查看</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210802211517463.png" alt="image-20210802211517463"></p>
<p>前台启动</p>
<p>docker -d </p>
<p>docker-compose up -d</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210802215253767.png" alt="image-20210802215253767"></p>
<h3 id="Demo上线"><a href="#Demo上线" class="headerlink" title="Demo上线"></a>Demo上线</h3><p>1.写一个小demo</p>
<p>2.编写Dockerfile，构建镜像</p>
<p>3.编写docker-compose.yml文件，编排项目</p>
<p>4.发布到服务器</p>
<p><strong>Dockerfile文件</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> *.jar /app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">"--server.port=8111"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8111</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"/app.jar"</span>]</span></span><br></pre></td></tr></table></figure>
<p><strong>docker-compose.yml文件</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">eternal:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">eternal</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">"8111:8111"</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">"library/redis:alpine"</span></span><br></pre></td></tr></table></figure>
<p><strong>发布到linux中</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过命令进行重构启动（项目重新部署打包）</span></span><br><span class="line">[root@192 eternal]<span class="comment"># docker-compose up --build</span></span><br><span class="line">Building eternal</span><br><span class="line">Step 1/5 : FROM java:8</span><br><span class="line"> ---&gt; d23bdf5b1b1b</span><br><span class="line">Step 2/5 : COPY *.jar /app.jar</span><br><span class="line"> ---&gt; 948e956cd6ad</span><br><span class="line">Step 3/5 : CMD [<span class="string">"--server.port=8111"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 8fa5c24dfa81</span><br><span class="line">Removing intermediate container 8fa5c24dfa81</span><br><span class="line"> ---&gt; b5b542c8c3f3</span><br><span class="line">Step 4/5 : EXPOSE 8111</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> a958f2a181fd</span><br><span class="line">Removing intermediate container a958f2a181fd</span><br><span class="line"> ---&gt; e84098b8047f</span><br><span class="line">Step 5/5 : ENTRYPOINT [<span class="string">"java"</span>,<span class="string">"-jar"</span>,<span class="string">"/app.jar"</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 2e83b321cc84</span><br><span class="line">Removing intermediate container 2e83b321cc84</span><br><span class="line"> ---&gt; 1eeb5e2dd12b</span><br><span class="line"></span><br><span class="line">Successfully built 1eeb5e2dd12b</span><br><span class="line">Successfully tagged eternal:latest</span><br></pre></td></tr></table></figure>
<h1 id="11-Docker-Swarm"><a href="#11-Docker-Swarm" class="headerlink" title="11.Docker Swarm"></a>11.Docker Swarm</h1><h2 id="集群搭建"><a href="#集群搭建" class="headerlink" title="集群搭建"></a>集群搭建</h2><h3 id="购买服务器"><a href="#购买服务器" class="headerlink" title="购买服务器"></a>购买服务器</h3><p>1.阿里云购买四个服务器</p>
<p>2.通过Xshell连接四个服务器（这里是四个一摸一样的虚拟机）</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210803212011465.png" alt="image-20210803212011465"></p>
<p>3.统一安装相同的环境</p>
<h3 id="工作模式"><a href="#工作模式" class="headerlink" title="工作模式"></a>工作模式</h3><p>Docker Engine 1.12引入了集群模式，可以让你创建一个或多个Docker引擎的集群，称为集群。 集群由一个或多个节点组成:在集群模式下运行Docker Engine 1.12或更高版本的物理或虚拟机。</p>
<p> 有两种类型的节点:管理节点和工人节点。</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210803210146413.png" alt="image-20210803210146413"></p>
<p><strong>查看网络</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br></pre></td></tr></table></figure>
<p><strong>查看swarm帮助</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker swarm --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  ca          Display and rotate the root CA</span><br><span class="line">  init        Initialize a swarm</span><br><span class="line">  join        Join a swarm as a node and/or manager</span><br><span class="line">  join-token  Manage join tokens</span><br><span class="line">  leave       Leave the swarm</span><br><span class="line">  unlock      Unlock swarm</span><br><span class="line">  unlock-key  Manage the unlock key</span><br><span class="line">  update      Update the swarm</span><br></pre></td></tr></table></figure>
<p><strong>docker swarm 删除节点 (解散集群)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">在Swarm manager 机器上查看节点ID</span><br><span class="line"><span class="comment"># docker node ls</span></span><br><span class="line"></span><br><span class="line">排空节点上的集群容器 </span><br><span class="line"><span class="comment"># docker node update --availability drain xej6qh39mrj9v3u8v1seuk07c</span></span><br><span class="line"></span><br><span class="line">主动离开集群，让节点处于down状态，才能删除（在节点机上执行）</span><br><span class="line"><span class="comment"># docker swarm leave</span></span><br><span class="line"></span><br><span class="line">删除指定节点 （Swarm manager机器上操作）</span><br><span class="line"><span class="comment"># docker node rm xej6qh39mrj9v3u8v1seuk07c</span></span><br><span class="line"></span><br><span class="line">管理节点，解散集群</span><br><span class="line">docker swarm leave --force</span><br></pre></td></tr></table></figure>
<p>设置 1 号服务器为manager</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置管理者 docker swarm init --advertise-addr ip地址</span></span><br><span class="line"></span><br><span class="line">[root@192 ~]<span class="comment"># docker swarm init --advertise-addr 192.168.158.137</span></span><br><span class="line">Swarm initialized: current node (bsidch07oqm8ykuivarc2o0ul) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-1xevwy1s63g50kwj64o4jo0fc0n315zo07ah2sx0nzco4g85ij-836eru2hvie5etwcduguloz2m 192.168.158.137:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run <span class="string">'docker swarm join-token manager'</span> and follow the instructions.</span><br></pre></td></tr></table></figure>
<p>初始化节点 <code>docker swarm init</code></p>
<p>docker swarm join 加入一个节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取令牌</span></span><br><span class="line"><span class="comment"># 生成管理节点</span></span><br><span class="line">docker swarm join-token manager</span><br><span class="line"><span class="comment"># 生成工作节点</span></span><br><span class="line">docker swarm join-token worker</span><br></pre></td></tr></table></figure>
<p>设置 2 号服务器加入节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment">#  docker swarm join --token SWMTKN-1-1xevwy1s63g50kwj64o4jo0fc0n315zo07ah2sx0nzco4g85ij-836eru2hvie5etwcduguloz2m 192.168.158.137:2377</span></span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210803214617320.png" alt="image-20210803214617320"></p>
<p>在 1 号服务器上查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker node ls</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210803214732382.png" alt="image-20210803214732382"></p>
<p>在 1 号服务器生成工作节点令牌</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># docker swarm join-token worker</span></span><br><span class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-1xevwy1s63g50kwj64o4jo0fc0n315zo07ah2sx0nzco4g85ij-836eru2hvie5etwcduguloz2m 192.168.158.137:2377</span><br></pre></td></tr></table></figure>
<p>将剩下两个服务器同样的方式加入到manager中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 1 号服务器中所加入的节点</span></span><br><span class="line">docker node ls</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210803215435423.png" alt="image-20210803215435423"></p>
<p>后期：搭建100台服务器</p>
<ul>
<li>生成节点 init</li>
<li>加入（manager，worker）</li>
</ul>
<p>目标：双主双从</p>
<h2 id="Raft一致性协议"><a href="#Raft一致性协议" class="headerlink" title="Raft一致性协议"></a>Raft一致性协议</h2><p>双主双从：假设一个节点挂了，其他节点是否可以用！</p>
<p>Raft协议：保证大多数节点u才能活才可以用。只要&gt;1,集群至少大于3台</p>
<p>例：</p>
<p>将 1 号服务器关闭（宕机）      双主，另外一个主节点也不能使用了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm leave</span><br></pre></td></tr></table></figure>
<p>在 2 号服务器中进行节点查看（报错）</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804112038670.png" alt="image-20210804112038670"></p>
<p>在 3、4 号服务器中进行节点查看（报错）</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804112315692.png" alt="image-20210804112315692"></p>
<p>错误信息：没有一个 swarm manager（管理节点）</p>
<p>再次将 1 号服务器开启</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804112530585.png" alt="image-20210804112530585"></p>
<p>发现，位置已被 2 号服务器替代，且 2 号服务器原本的已经宕机（换了身份）</p>
<p>将 3 号服务器离开节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm leave</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804120255839.png" alt="image-20210804120255839"></p>
<p>将 3 号服务器设为manager节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在管理节点下生成一个管理令牌</span></span><br><span class="line">docker swarm join-token manager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 3 号服务器执行</span></span><br><span class="line">docker swarm join --token SWMTKN-1-57r2d8yvj5fpb7ivkild5oeyx080zhrin5v8a3z257p9qgniv9-46qee76j01teyxb34bti4rd3a 192.168.158.138:2377</span><br></pre></td></tr></table></figure>
<p>在 3 号服务器 查看当前节点</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804120542618.png" alt="image-20210804120542618"></p>
<p>这个时候挂掉一个manager，其他的正常使用</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804120704865.png" alt="image-20210804120704865"></p>
<p>这个时候再挂掉一个manager，则无法正常使用</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804120852132.png" alt="image-20210804120852132"></p>
<p><strong>注意：</strong></p>
<ul>
<li>确保有三个及以上的manager，否则两个manager，其中一个挂掉，则整个集群就无法使用了</li>
<li>十分简单：集群，可用！ 3个主节点。 （两个及以上个主节点）大于1 台管理节点存活！ </li>
<li>Raft协议： 保证大多数节点存活，才可以使用，高可用</li>
</ul>
<h2 id="集群弹性创建服务"><a href="#集群弹性创建服务" class="headerlink" title="集群弹性创建服务"></a>集群弹性创建服务</h2><p>弹性、扩缩容！集群！ 以后告别 docker run！ </p>
<p>docker-compose up！ 启动一个项目。单机！ </p>
<p>集群： swarm<code>docker serivce</code>  </p>
<p>容器 =&gt; 服务！ </p>
<p>容器 =&gt; 服务！=&gt; 副本！ </p>
<p>redis 服务 =&gt; 10个副本！（同时开启10个redis容器） </p>
<p>体验：创建服务、动态扩展服务、动态更新服务。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># docker service </span></span><br><span class="line"></span><br><span class="line">Usage:  docker service COMMAND</span><br><span class="line">Manage services</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      创建一个新服务</span><br><span class="line">  inspect     显示一个或多个服务的详细信息</span><br><span class="line">  logs        获取服务或任务的日志</span><br><span class="line">  ls          服务列表</span><br><span class="line">  ps          列出一个或多个服务的任务</span><br><span class="line">  rm          删除一个或多个服务</span><br><span class="line">  rollback    恢复对服务配置的更改</span><br><span class="line">  scale       扩展一个或多个复制的服务</span><br><span class="line">  update      更新服务</span><br></pre></td></tr></table></figure>
<p>灰度发布：直接升级更新，无需停止活动再更新</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run 容器启动，不具备扩缩容器</span><br><span class="line">docker service 服务，具有扩缩容，滚动更新</span><br></pre></td></tr></table></figure>
<p>启动服务</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804131220199.png" alt="image-20210804131220199"></p>
<p>在 1 号服务器中执行开启服务命令，发现在 3 号服务器中开启（docker ps）随机分布在主节点（manager节点）</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804131603560.png" alt="image-20210804131603560"></p>
<p>查看服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># docker service ls</span></span><br><span class="line">ID             NAME       MODE         REPLICAS   IMAGE          PORTS</span><br><span class="line">lm74rvezj8bc   my-nginx   replicated   1/1        nginx:latest   *:8888-&gt;80/tcp</span><br></pre></td></tr></table></figure>
<p>开启多个服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@192 ~]<span class="comment"># docker service update --replicas 3 my-nginx</span></span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 3 out of 3 tasks </span><br><span class="line">1/3: running   </span><br><span class="line">2/3: running   </span><br><span class="line">3/3: running   </span><br><span class="line">verify: Service converged</span><br></pre></td></tr></table></figure>
<p>再次查看服务开启，发现 1，3，4号服务器开启了服务（随机分布）</p>
<p>从137-140四个ip都可访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804132141212.png" alt="image-20210804132141212"></p>
<p><img src="https://cdn.jsdelivr.net/gh/eternal0918/mdimages.github.io/img/image-20210804132222025.png" alt="image-20210804132222025"></p>
<p>集群就是个整体，可随时动态扩所容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启10个服务</span></span><br><span class="line">[root@192 ~]<span class="comment"># docker service update --replicas 10 my-nginx</span></span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 10 out of 10 tasks </span><br><span class="line">1/10: running   </span><br><span class="line">2/10: running   </span><br><span class="line">3/10: running   </span><br><span class="line">4/10: running   </span><br><span class="line">5/10: running   </span><br><span class="line">6/10: running   </span><br><span class="line">7/10: running   </span><br><span class="line">8/10: running   </span><br><span class="line">9/10: running   </span><br><span class="line">10/10: running   </span><br><span class="line">verify: Service converged </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 四个机子上每个多跑了几个服务</span></span><br><span class="line">[root@192 ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">1266d8f420d1   nginx:latest   <span class="string">"/docker-entrypoint.…"</span>   48 seconds ago   Up 38 seconds   80/tcp    my-nginx.4.e289j7yp21tkwlofuop6b6g9i</span><br><span class="line">baefd4cab9a2   nginx:latest   <span class="string">"/docker-entrypoint.…"</span>   48 seconds ago   Up 38 seconds   80/tcp    my-nginx.9.n7lequwe1dx29unbu2ni8f68d</span><br><span class="line">aff860e9ba12   nginx:latest   <span class="string">"/docker-entrypoint.…"</span>   48 seconds ago   Up 38 seconds   80/tcp    my-nginx.5.i0jeca3chwrh7wqav7zpz82q5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到1个服务</span></span><br><span class="line">[root@192 ~]<span class="comment"># docker service update --replicas 1 my-nginx</span></span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 1 out of 1 tasks </span><br><span class="line">1/1: running   </span><br><span class="line">verify: Service converged </span><br><span class="line"></span><br><span class="line"><span class="comment"># 其他几个机子上的服务就停掉了，只会在一个机子中开启一个服务</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开启5个服务</span></span><br><span class="line">[root@192 ~]<span class="comment"># docker service scale my-nginx=5</span></span><br><span class="line">my-nginx scaled to 5</span><br><span class="line">overall progress: 5 out of 5 tasks </span><br><span class="line">1/5: running   </span><br><span class="line">2/5: running   </span><br><span class="line">3/5: running   </span><br><span class="line">4/5: running   </span><br><span class="line">5/5: running   </span><br><span class="line">verify: Service converged </span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除服务</span></span><br><span class="line">[root@192 ~]<span class="comment"># docker service rm my-nginx</span></span><br><span class="line">my-nginx</span><br></pre></td></tr></table></figure>

                
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2021/08/11/RabbitMQ-学习/" data-toggle="tooltip" data-placement="top" title="RabbitMQ 学习">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2021/07/19/Java-面向对象/" data-toggle="tooltip" data-placement="top" title="Java 面向对象">Next Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- tip start -->
                

                
                <div class="comment_notes">
                    <p>
                        This is copyright.
                    </p>
                </div>
                
                <!-- tip end -->

                <!-- Music start-->
                
                
<link rel="stylesheet" href="/css/music-player/fonts/iconfont.css">


<link rel="stylesheet" href="/css/music-player/css/reset.css">


<link rel="stylesheet" href="/css/music-player/css/player.css">


<div class="music-player">
    <audio class="music-player__audio" ></audio>
    <div class="music-player__main">
        <div class="music-player__blur"></div>
        <div class="music-player__disc">
            <div class="music-player__image">
                <img width="100%" src="" alt="">
            </div>
            <div class="music-player__pointer"><img width="100%" src="/img/cd_tou.png" alt=""></div>
        </div>
        <div class="music-player__controls">
            <div class="music__info">
                <h3 class="music__info--title">...</h3>
                <p class="music__info--singer">...</p>
            </div>
            <div class="player-control">
                <div class="player-control__content">
                    <div class="player-control__btns">
                        <div class="player-control__btn player-control__btn--prev"><i class="iconfont icon-prev"></i></div>
                        <div class="player-control__btn player-control__btn--play"><i class="iconfont icon-play"></i></div>
                        <div class="player-control__btn player-control__btn--next"><i class="iconfont icon-next"></i></div>
                        <div class="player-control__btn player-control__btn--mode"><i class="iconfont icon-loop"></i></div>
                    </div>
                    <div class="player-control__volume">
                        <div class="control__volume--icon player-control__btn"><i class="iconfont icon-volume"></i></div>
                        <div class="control__volume--progress player_progress"></div>
                    </div>
                </div>
                <div class="player-control__content">
                    <div class="player__song--progress player_progress"></div>
                    <div class="player__song--timeProgess nowTime">00:00</div>
                    <div class="player__song--timeProgess totalTime">00:00</div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="/js/music-player/utill.js"></script>


<script src="/js/music-player/jquery.min.js"></script>

<!-- netease; qqkg -->
<!--
<script src="/js/music-player/player.js?library=config.music.library.js"></script>
-->
<script src="../../../../js/music-player/player.js?library=netease&music=https://music.163.com/#/playlist?id=5380610670&userid=340389419"></script>
                
                <!-- Music end -->

                <!-- Sharing -->
                
                <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                <!--  css & js -->
                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!-- Sharing -->

                <!-- gitment start -->
                
                <!-- gitment end -->

                <!-- 来必力City版安装代码 -->
                
                <!-- City版安装代码已完成 -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      
        <aside id="sidebar">
          <div id="toc" class="toc-article">
          <strong class="toc-title">Contents</strong>
          
            
              <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Docker-学习"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Docker 学习</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#1-Docker-概述"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">1.Docker 概述</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Docker为什么出现？"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">Docker为什么出现？</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Docker的基本组成"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">Docker的基本组成</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#2-安装Docker"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">2.安装Docker</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#可视化界面安装"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">可视化界面安装</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Docker安装"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">Docker安装</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#阿里云镜像加速"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">阿里云镜像加速</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#3-Docker原理"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">3.Docker原理</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#run的执行流程"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">run的执行流程</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#底层原理"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">底层原理</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#4-Docker常用命令"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">4.Docker常用命令</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#帮助命令"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">帮助命令</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#镜像命令"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">镜像命令</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#容器命令"><span class="toc-nav-number">5.3.</span> <span class="toc-nav-text">容器命令</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#常用其他命令"><span class="toc-nav-number">5.4.</span> <span class="toc-nav-text">常用其他命令</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#小结"><span class="toc-nav-number">5.5.</span> <span class="toc-nav-text">小结</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#作业练习"><span class="toc-nav-number">5.6.</span> <span class="toc-nav-text">作业练习</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Nginx"><span class="toc-nav-number">5.6.1.</span> <span class="toc-nav-text">Nginx</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Tomcat"><span class="toc-nav-number">5.6.2.</span> <span class="toc-nav-text">Tomcat</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#es-kibana"><span class="toc-nav-number">5.6.3.</span> <span class="toc-nav-text">es+kibana</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#可视化"><span class="toc-nav-number">5.7.</span> <span class="toc-nav-text">可视化</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#5-Docker镜像"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">5.Docker镜像</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#镜像是什么"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">镜像是什么</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Docker镜像加载原理"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">Docker镜像加载原理</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#分层理解"><span class="toc-nav-number">6.3.</span> <span class="toc-nav-text">分层理解</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#commit镜像"><span class="toc-nav-number">6.4.</span> <span class="toc-nav-text">commit镜像</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#6-容器数据卷"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">6.容器数据卷</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#什么是容器数据卷"><span class="toc-nav-number">7.1.</span> <span class="toc-nav-text">什么是容器数据卷</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#使用数据卷"><span class="toc-nav-number">7.2.</span> <span class="toc-nav-text">使用数据卷</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#实战-安装Mysql"><span class="toc-nav-number">7.3.</span> <span class="toc-nav-text">实战: 安装Mysql</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#测试链接"><span class="toc-nav-number">7.3.1.</span> <span class="toc-nav-text">测试链接</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#创建数据库"><span class="toc-nav-number">7.3.2.</span> <span class="toc-nav-text">创建数据库</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#mysql容器删除"><span class="toc-nav-number">7.3.3.</span> <span class="toc-nav-text">mysql容器删除</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#具名和匿名挂载"><span class="toc-nav-number">7.4.</span> <span class="toc-nav-text">具名和匿名挂载</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#7-Dockerfile"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">7.Dockerfile</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#初始DockerFile"><span class="toc-nav-number">8.1.</span> <span class="toc-nav-text">初始DockerFile</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#数据卷容器"><span class="toc-nav-number">8.2.</span> <span class="toc-nav-text">数据卷容器</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#DockerFile"><span class="toc-nav-number">8.3.</span> <span class="toc-nav-text">DockerFile</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Dockerfile构建过程"><span class="toc-nav-number">8.4.</span> <span class="toc-nav-text">Dockerfile构建过程</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#DockerFile指令"><span class="toc-nav-number">8.5.</span> <span class="toc-nav-text">DockerFile指令</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#实战测试"><span class="toc-nav-number">8.6.</span> <span class="toc-nav-text">实战测试</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#DIY-centos"><span class="toc-nav-number">8.6.1.</span> <span class="toc-nav-text">DIY centos</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#进程创建过程"><span class="toc-nav-number">8.6.2.</span> <span class="toc-nav-text">进程创建过程</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#CMD-和ENTRYPOINT"><span class="toc-nav-number">8.6.3.</span> <span class="toc-nav-text">CMD 和ENTRYPOINT</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Tomcat镜像"><span class="toc-nav-number">8.6.4.</span> <span class="toc-nav-text">Tomcat镜像</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#发布自己的镜像"><span class="toc-nav-number">8.6.5.</span> <span class="toc-nav-text">发布自己的镜像</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#DockerHub"><span class="toc-nav-number">8.6.5.1.</span> <span class="toc-nav-text">DockerHub</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#阿里云"><span class="toc-nav-number">8.6.5.2.</span> <span class="toc-nav-text">阿里云</span></a></li></ol></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#8-Docker网络"><span class="toc-nav-number">9.</span> <span class="toc-nav-text">8.Docker网络</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#理解Docker"><span class="toc-nav-number">9.1.</span> <span class="toc-nav-text">理解Docker</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#—link"><span class="toc-nav-number">9.2.</span> <span class="toc-nav-text">—link</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#自定义网络"><span class="toc-nav-number">9.3.</span> <span class="toc-nav-text">自定义网络</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#网络连通"><span class="toc-nav-number">9.4.</span> <span class="toc-nav-text">网络连通</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#9-实战"><span class="toc-nav-number">10.</span> <span class="toc-nav-text">9.实战</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Redis集群搭建"><span class="toc-nav-number">10.1.</span> <span class="toc-nav-text">Redis集群搭建</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#SpringBoot微服务打包Docker镜像"><span class="toc-nav-number">10.2.</span> <span class="toc-nav-text">SpringBoot微服务打包Docker镜像</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#10-DockerCompose"><span class="toc-nav-number">11.</span> <span class="toc-nav-text">10.DockerCompose</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#简介"><span class="toc-nav-number">11.1.</span> <span class="toc-nav-text">简介</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#安装"><span class="toc-nav-number">11.2.</span> <span class="toc-nav-text">安装</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#体验"><span class="toc-nav-number">11.3.</span> <span class="toc-nav-text">体验</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Step1：设置"><span class="toc-nav-number">11.3.1.</span> <span class="toc-nav-text">Step1：设置</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Step-2-创建一个Dockerfile文件"><span class="toc-nav-number">11.3.2.</span> <span class="toc-nav-text">Step 2: 创建一个Dockerfile文件</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Step-3-在Compose文件中定义服务"><span class="toc-nav-number">11.3.3.</span> <span class="toc-nav-text">Step 3:在Compose文件中定义服务</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Step-4-使用Compose构建并运行应用程序"><span class="toc-nav-number">11.3.4.</span> <span class="toc-nav-text">Step 4:使用Compose构建并运行应用程序</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#总结"><span class="toc-nav-number">11.3.5.</span> <span class="toc-nav-text">总结</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#yaml规则"><span class="toc-nav-number">11.4.</span> <span class="toc-nav-text">yaml规则</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#开源项目"><span class="toc-nav-number">11.5.</span> <span class="toc-nav-text">开源项目</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#博客"><span class="toc-nav-number">11.5.1.</span> <span class="toc-nav-text">博客</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Demo上线"><span class="toc-nav-number">11.5.2.</span> <span class="toc-nav-text">Demo上线</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#11-Docker-Swarm"><span class="toc-nav-number">12.</span> <span class="toc-nav-text">11.Docker Swarm</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#集群搭建"><span class="toc-nav-number">12.1.</span> <span class="toc-nav-text">集群搭建</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#购买服务器"><span class="toc-nav-number">12.1.1.</span> <span class="toc-nav-text">购买服务器</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#工作模式"><span class="toc-nav-number">12.1.2.</span> <span class="toc-nav-text">工作模式</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Raft一致性协议"><span class="toc-nav-number">12.2.</span> <span class="toc-nav-text">Raft一致性协议</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#集群弹性创建服务"><span class="toc-nav-number">12.3.</span> <span class="toc-nav-text">集群弹性创建服务</span></a></li></ol></li></ol>
            
          
          </div>
        </aside>
      
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Dcoker" title="Dcoker">Dcoker</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://blog.csdn.net/d_Nail" target="_blank">Dusign&#39;s Blog</a></li>
                    
                        <li><a href="https://github.com/eternal0918" target="_blank">Eternal&#39;s Github</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>


<style  type="text/css">
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">

                
                    <li>
                        <a target="_blank"  href="https://github.com/eternal0918">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://gitee.com/dont-leave-the-old/eternal">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-git fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/Gang Du">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/hong-yan-76-83">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                

                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Eternal 2021 
                    <br>
                    Powered by 
                    <a href="https://github.com/eternal0918/eternal0918.github.io" target="_blank" rel="noopener">
                        <i>eternal.github.io</i>
                    </a> | 
                    <iframe name="star" style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0"
                        width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=eternal0918&repo=eternal0918.github.io&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>

</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>


<!-- Search -->

<script src="/js/search.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://dusign.net/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->


<!-- Search -->

    <script type="text/javascript">      
        var search_path = "search.xml";
        if (search_path.length == 0) {
            search_path = "search.xml";
        }
    var path = "/" + search_path;
    searchFunc(path, 'local-search-input', 'local-search-result');
    </script>


<!-- busuanzi -->
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>

    
        <!-- background effects line -->
        

        
            <script type="text/javascript" src="/js/mouse-click.js" content='[&quot;🌱&quot;,&quot;just do it&quot;,&quot;🍀&quot;]' color='[&quot;rgb(121,93,179)&quot; ,&quot;rgb(76,180,231)&quot; ,&quot;rgb(184,90,154)&quot;]'></script>
        

        <!-- background effects end -->
    

    <!--<script size="50" alpha='0.3' zIndex="-999" src="/js/ribbonStatic.js"></script>-->
    
        <script src="/js/ribbonDynamic.js"></script>
    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>

</html>
